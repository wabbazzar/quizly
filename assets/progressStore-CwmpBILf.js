import{h as e,p as t,d as s}from"./index-CoElTYbf.js";import{u as r}from"./cardMasteryStore-DLoKfaPt.js";const a={overall:0,byMode:{flashcards:0,learn:0,match:0,test:0},lastStudied:void 0,totalCardsStudied:0,streakDays:0,masteredCards:0,totalCards:0},d=e()(t((e,t)=>({progress:{},updateDeckProgress:(t,d,o,l,n)=>{e(e=>{const d=e.progress[t]||{...a},l=s.getState().decks.find(e=>e.id===t),g=l?.content?.length||n,i=r.getState(),c=i.getMasteredCards(t),u=i.getDeckMasteryPercentage(t,g),S={...d.byMode,flashcards:u,learn:u,match:u,test:u},p=u,h=d.lastStudied?new Date(d.lastStudied):null,y=new Date;y.setHours(0,0,0,0);let D=d.streakDays||0;if(h){const e=new Date(h);e.setHours(0,0,0,0);const t=Math.floor((y.getTime()-e.getTime())/864e5);D=0===t?d.streakDays:1===t?d.streakDays+1:1}else D=1;return{progress:{...e.progress,[t]:{overall:p,byMode:S,lastStudied:new Date,totalCardsStudied:d.totalCardsStudied+o,streakDays:D,masteredCards:c.length,totalCards:n}}}})},getDeckProgress:e=>{const d=t().progress[e],o=s.getState().decks.find(t=>t.id===e),l=o?.content?.length||0,n=r.getState(),g=n.getMasteredCards(e),i=n.getDeckMasteryPercentage(e,l);if(!d)return{...a,masteredCards:g.length,overall:i,byMode:{flashcards:i,learn:i,match:i,test:i}};const c=i,u={flashcards:i,learn:i,match:i,test:i};return{...d,overall:c,byMode:u,masteredCards:g.length,lastStudied:d.lastStudied?new Date(d.lastStudied):void 0}},resetDeckProgress:t=>{e(e=>{const s={...e.progress};return delete s[t],{progress:s}})},clearAllProgress:()=>{e({progress:{}})}}),{name:"progress-store",partialize:e=>({progress:Object.entries(e.progress).reduce((e,[t,s])=>({...e,[t]:{...s,lastStudied:s.lastStudied?s.lastStudied.toISOString():void 0}}),{})}),onRehydrateStorage:()=>e=>{e&&e.progress&&Object.keys(e.progress).forEach(t=>{const s=e.progress[t];s.lastStudied&&"string"==typeof s.lastStudied&&(s.lastStudied=new Date(s.lastStudied))})}}));export{d as u};
