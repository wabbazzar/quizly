import{r as e,g as t,j as s,A as n,m as r}from"./index-K5uqA-3n.js";import{u as i}from"./cardMasteryStore-z-5vmz49.js";import{S as a}from"./SharedModeHeader-DRg3hh5Z.js";class o{static generateQuestions(e,t,s,n){const r=[],i=new Set;return e.forEach(a=>{if(t.excludeCards?.has(a.idx))return;"multiple_choice"===(t.forceMultipleChoice?"multiple_choice":this.selectQuestionType(t.questionTypes,t.questionTypeMix))?r.push(this.generateMultipleChoice(a,n||e,{front:t.frontSides,back:t.backSides},a.idx,s)):r.push(this.generateFreeText(a,{front:t.frontSides,back:t.backSides},a.idx)),i.add(a.idx)}),this.shuffleQuestions(r,t.difficulty)}static generateMultipleChoice(e,t,s,n,r){const i=this.buildQuestionText(e,s.front),a=this.buildAnswerText(e,s.back),o=this.generateDistractors(a,t,s.back,n,r);return{id:`mc_${e.idx}_${Date.now()}`,type:"multiple_choice",cardIndex:n,questionText:i,questionSides:s.front,correctAnswer:a,options:this.shuffleOptions([a,...o]),difficulty:e.level||1}}static generateFreeText(e,t,s){const n=this.buildQuestionText(e,t.front),r=this.buildAnswerText(e,t.back),i=this.generateAcceptedAnswers(r);return{id:`ft_${e.idx}_${Date.now()}`,type:"free_text",cardIndex:s,questionText:n,questionSides:t.front,correctAnswer:r,acceptedAnswers:i,difficulty:e.level||1}}static generateDistractors(e,t,s,n,r){const i=[],a=[],o=[],c=new Set(r||[]);t.forEach(t=>{if(t.idx===n)return;const r=this.buildAnswerText(t,s);r&&r!==e&&(c.has(t.idx)?o.includes(r)||o.push(r):a.includes(r)||a.push(r))});const l=a.length>0?a:[],d=o,u=(t,s)=>{const n=[];if(0===t.length)return n;const r=t.map(t=>({text:t,similarity:this.calculateSimilarity(e,t)}));if(r.sort((e,t)=>t.similarity-e.similarity),r.length>=s){[0,Math.floor(r.length/2),r.length-1].forEach(e=>{if(e<r.length&&n.length<s){const t=r[e].text;n.includes(t)||n.push(t)}})}for(;n.length<s&&n.length<t.length;){const e=t[Math.floor(Math.random()*t.length)];n.includes(e)||n.push(e)}return n};if(i.push(...u(l,3)),i.length<3){const e=3-i.length;i.push(...u(d,e))}for(;i.length<3;)i.push(`Option ${i.length+2}`);return i.slice(0,3)}static calculateSimilarity(e,t){const s=e.toLowerCase().split(/\s+/),n=t.toLowerCase().split(/\s+/),r=new Set(s),i=new Set(n),a=new Set([...r].filter(e=>i.has(e))),o=new Set([...r,...i]);return a.size/o.size}static buildQuestionText(e,t){const s=[];return t.forEach(t=>{const n=e[t];"string"==typeof n&&n&&s.push(n)}),s.join(" - ")||"Question"}static buildAnswerText(e,t){const s=[];return t.forEach(t=>{const n=e[t];"string"==typeof n&&n&&s.push(n)}),s.join(" - ")||"Answer"}static generateAcceptedAnswers(e){const t=[e];t.push(e.toLowerCase()),t.push(e.toUpperCase());const s=e.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");s!==e&&(t.push(s),t.push(s.toLowerCase()));const n=e.trim();return n!==e&&t.push(n),[...new Set(t)]}static selectQuestionType(e,t){if("multiple_choice"===t)return"multiple_choice";if("free_text"===t)return"free_text";if(1===e.length)return e[0];let s=.8;return"mixed"===t&&(s=.5),Math.random()<s?"multiple_choice":"free_text"}static shuffleQuestions(e,t){const s=[...[...e].sort((e,t)=>e.difficulty-t.difficulty)],n=1-.2*t;for(let r=s.length-1;r>0;r--)if(Math.random()<n){const e=Math.floor(Math.random()*(r+1));[s[r],s[e]]=[s[e],s[r]]}return s}static shuffleOptions(e){const t=[...e];for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}return t}}class c{name="Smart Spaced Reinforcement";description="Adaptive spacing based on performance with anti-clustering";schedule(e,t,s){const n=e.map(e=>({card:e,position:this.calculatePosition(e,t.length,s)}));return n.sort((e,t)=>t.card.difficulty-e.card.difficulty),this.mergeWithAntiClustering(n,t,s)}calculatePosition(e,t,s){const n=s.minSpacing,r=s.maxSpacing-n,i=1-e.difficulty*s.difficultyWeight,a=Math.min(1,e.missCount/3),o=Math.min(1,(Date.now()-e.lastSeen)/6e4),c=n+Math.floor(r*i*(1-a)*Math.max(.5,o)),l=Math.floor(3*Math.random())-1;return Math.max(n,Math.min(t-1,c+l))}mergeWithAntiClustering(e,t,s){const n=[...t],r=new Set;let i=0;for(const{card:a,position:o}of e){let e=o;for(i>=s.clusterLimit&&(e+=s.clusterLimit,i=0);r.has(e);)e+=s.minSpacing;const c=this.convertMissedToCard(a,t);c&&(n.splice(e,0,c),r.add(e),i++)}return t.length/n.length<s.progressRatio?this.redistributeForProgress(n,t,s.progressRatio):n}convertMissedToCard(e,t){const s=t.find(t=>t.idx===e.cardIndex);return s?{...s}:{idx:e.cardIndex,name:`Card ${e.cardIndex}`,side_a:"",side_b:"",level:1}}redistributeForProgress(e,t,s){const n=e.length,r=Math.floor(n*s);if(t.filter(t=>e.includes(t)).length>=r)return e;const i=[],a=[];e.forEach(e=>{t.includes(e)?i.push(e):a.push(e)});const o=Math.floor((i.length+a.length)/a.length);let c=o;return a.forEach(e=>{i.splice(Math.min(c,i.length),0,e),c+=o}),i}}class l{name="Leitner Box System";description="Classic spaced repetition with exponential intervals";boxes=[2,4,8,16,32];schedule(e,t,s){const n=[...t];return this.groupByBox(e).forEach((e,r)=>{const i=this.getBoxInterval(r,s);e.forEach((e,r)=>{const a=Math.min(i+r*s.minSpacing,n.length),o=this.convertMissedToCard(e,t);o&&n.splice(a,0,o)})}),n}groupByBox(e){const t=new Map;return e.forEach(e=>{const s=Math.max(0,5-e.missCount);t.has(s)||t.set(s,[]),t.get(s).push(e)}),t}getBoxInterval(e,t){const s=this.boxes[Math.min(e,this.boxes.length-1)],n={gentle:1.5,balanced:1,intensive:.5}[t.aggressiveness];return Math.round(s*n)}convertMissedToCard(e,t){const s=t.find(t=>t.idx===e.cardIndex);return s?{...s}:{idx:e.cardIndex,name:`Card ${e.cardIndex}`,side_a:"",side_b:"",level:1}}}class d{static schedulers=new Map([["smart_spaced",new c],["leitner_box",new l]]);static getScheduler(e){const t=this.schedulers.get(e);if(!t)throw new Error(`Unknown scheduling algorithm: ${e}`);return t}static registerScheduler(e,t){this.schedulers.set(e,t)}static getAvailableAlgorithms(){return Array.from(this.schedulers.entries()).map(([e,t])=>({key:e,name:t.name,description:t.description}))}}const u={currentQuestion:null,questionIndex:0,roundCards:[],correctCards:new Set,incorrectCards:new Set,currentStreak:0,maxStreak:0,startTime:Date.now(),responseStartTime:Date.now(),responseTimes:[]};var h,m,p={exports:{}};
/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/const _=t((h||(h=1,m=p,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=n(e,s(r)))}return e}function s(s){if("string"==typeof s||"number"==typeof s)return s;if("object"!=typeof s)return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var r="";for(var i in s)e.call(s,i)&&s[i]&&(r=n(r,i));return r}function n(e,t){return t?e?e+" "+t:e+t:e}m.exports?(t.default=t,m.exports=t):window.classNames=t}()),p.exports)),f="_multipleChoice_1w4p6_1",x="_option_1w4p6_7",g="_disabled_1w4p6_22",w="_selected_1w4p6_22",b="_correct_1w4p6_38",y="_incorrect_1w4p6_44",C="_optionLetter_1w4p6_55",S="_optionText_1w4p6_84",v="_statusIcon_1w4p6_91",k="_keyboardHint_1w4p6_166",j="_hintIcon_1w4p6_185",N=e.memo(({options:t,correctAnswer:n,onSelect:r,showFeedback:i,feedback:a,disabled:o,resetKey:c})=>{const[l,d]=e.useState(null);e.useEffect(()=>{d(null)},[c]);const u=e.useCallback(e=>{if(o||l)return;d(e);r(e,e===n)},[n,r,o,l]);e.useEffect(()=>{const e=e=>{if(o||l)return;const s=e.target;if("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable)return;const n={1:0,2:1,3:2,4:3};if(e.key in n){const s=n[e.key];s<t.length&&(e.preventDefault(),u(t[s]))}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,l,t,u]);return s.jsxs("div",{className:f,role:"radiogroup","aria-label":"Answer options","aria-describedby":"keyboard-hint",children:[t.map((e,t)=>{const r=(e=>i?e===n?"correct":l===e&&e!==n?"incorrect":null:null)(e),a=l===e;return s.jsxs("button",{className:_(x,a&&w,"correct"===r&&b,"incorrect"===r&&y,o&&g),onClick:()=>u(e),disabled:o||null!==l,role:"radio","aria-checked":a,"aria-label":`Option ${t+1}: ${e}`,"data-testid":`option-${t}`,title:`Press ${t+1} to select`,children:[s.jsx("span",{className:C,children:t+1}),s.jsx("span",{className:S,children:e}),i&&r&&s.jsx("span",{className:v,"aria-hidden":"true",children:"correct"===r?"✓":"✗"})]},`${e}-${t}`)}),!o&&!l&&s.jsxs("div",{id:"keyboard-hint",className:k,children:[s.jsx("span",{className:j,children:"⌨️"}),s.jsxs("span",{children:["Press 1-",Math.min(t.length,4)," to select"]})]})]})});N.displayName="MultipleChoiceOptions";const T={caseSensitive:!1,allowTypos:!0,maxEditDistance:2,synonyms:new Map};class M{static isMatch(e,t,s=T){const n=this.normalizeText(e,s.caseSensitive);for(const r of t){const e=this.normalizeText(r,s.caseSensitive);if(n===e)return!0;if(s.allowTypos){if(this.levenshteinDistance(n,e)<=s.maxEditDistance)return!0}if(s.synonyms&&s.synonyms.size>0&&this.matchesSynonym(n,e,s.synonyms))return!0}return!1}static calculateSimilarity(e,t){const s=this.normalizeText(e,!1),n=this.normalizeText(t,!1);if(s===n)return 1;const r=this.levenshteinDistance(s,n),i=Math.max(s.length,n.length);return 0===i?0:1-r/i}static normalizeText(e,t=!1){let s=e.trim();return s=s.replace(/\s+/g," "),s=s.replace(/[.,;:!?()[\]{}"""''`]/g,""),s=this.normalizePinyinTones(s),t||(s=s.toLowerCase()),s}static normalizePinyinTones(e){const t={"ā":"a","á":"a","ǎ":"a","à":"a","ē":"e","é":"e","ě":"e","è":"e","ī":"i","í":"i","ǐ":"i","ì":"i","ō":"o","ó":"o","ǒ":"o","ò":"o","ū":"u","ú":"u","ǔ":"u","ù":"u","ǖ":"ü","ǘ":"ü","ǚ":"ü","ǜ":"ü","ü":"u","Ā":"A","Á":"A","Ǎ":"A","À":"A","Ē":"E","É":"E","Ě":"E","È":"E","Ī":"I","Í":"I","Ǐ":"I","Ì":"I","Ō":"O","Ó":"O","Ǒ":"O","Ò":"O","Ū":"U","Ú":"U","Ǔ":"U","Ù":"U","Ǖ":"Ü","Ǘ":"Ü","Ǚ":"Ü","Ǜ":"Ü","Ü":"U"};let s=e;for(const[n,r]of Object.entries(t))s=s.replace(new RegExp(n,"g"),r);return s}static levenshteinDistance(e,t){const s=[];for(let n=0;n<=t.length;n++)s[n]=[n];for(let n=0;n<=e.length;n++)s[0][n]=n;for(let n=1;n<=t.length;n++)for(let r=1;r<=e.length;r++)t.charAt(n-1)===e.charAt(r-1)?s[n][r]=s[n-1][r-1]:s[n][r]=Math.min(s[n-1][r-1]+1,s[n][r-1]+1,s[n-1][r]+1);return s[t.length][e.length]}static matchesSynonym(e,t,s){const n=s.get(t);if(n&&n.includes(e))return!0;const r=s.get(e);if(r&&r.includes(t))return!0;for(const[,i]of s.entries())if(i.includes(e)&&i.includes(t))return!0;return!1}static generateCommonTypos(e){const t=[];for(let s=0;s<e.length-1;s++){const n=e.split("");[n[s],n[s+1]]=[n[s+1],n[s]],t.push(n.join(""))}for(let s=0;s<e.length;s++)t.push(e.slice(0,s)+e.slice(s+1));for(let s=0;s<e.length;s++)t.push(e.slice(0,s+1)+e[s]+e.slice(s+1));return[...new Set(t)]}static extractKeywords(e){const t=this.normalizeText(e,!1).split(/\s+/),s=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","as","is","was","are","were","be","been","being","have","has","had","do","does","did","will","would","should","could","may","might","must","can","shall","this","that","these","those","it","its","he","she","they","we","you","i","me","him","her","us","them","my","your","his","her","our","their","what","which","who","whom","whose","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","just","now","also"]);return t.filter(e=>e.length>2&&!s.has(e))}}const A="_freeTextForm_edl55_1",I="_inputGroup_edl55_7",E="_textInput_edl55_13",D="_correct_edl55_38",q="_incorrect_edl55_43",z="_disabled_edl55_48",Q="_submitButton_edl55_55",F="_feedbackWrapper_edl55_94",L="_overrideSection_edl55_124",B="_overrideText_edl55_134",P="_overrideButton_edl55_140",$=e.memo(({correctAnswer:t,acceptedAnswers:n,onSubmit:r,showFeedback:i,feedback:a,disabled:o,resetKey:c})=>{const[l,d]=e.useState(""),[u,h]=e.useState(!1);e.useEffect(()=>{d(""),h(!1)},[c]);const m=e.useCallback(e=>{if(e.preventDefault(),!l.trim()||u||o)return;const s=[t,...n||[]],i=M.isMatch(l,s);h(!0),r(l,i)},[l,t,n,r,u,o]),p=e.useCallback(()=>{r(l,!0)},[l,r]);e.useEffect(()=>{if(!i||!1!==a?.isCorrect)return;const e=e=>{"1"===e.key&&"INPUT"!==document.activeElement?.tagName&&"TEXTAREA"!==document.activeElement?.tagName&&(e.preventDefault(),p())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i,a?.isCorrect,p]);const f=e.useCallback(e=>{e.stopPropagation(),"Enter"!==e.key||e.shiftKey||u||o||m(e)},[m,u,o]);return s.jsxs("form",{className:A,onSubmit:m,children:[s.jsxs("div",{className:I,children:[s.jsx("input",{type:"text",value:l,onChange:e=>d(e.target.value),onKeyDown:f,className:_(E,i&&!0===a?.isCorrect&&D,i&&!1===a?.isCorrect&&q,o&&z),placeholder:"Type your answer...",disabled:o||u,"aria-label":"Your answer","aria-invalid":i&&!a?.isCorrect,"aria-describedby":i?"feedback-message":void 0,autoComplete:"off",autoFocus:!0,"data-testid":"text-input"}),s.jsx("button",{type:"submit",className:_(Q,(!l.trim()||o||u)&&z),disabled:!l.trim()||o||u,"aria-label":"Submit answer","data-testid":"submit-button",children:u?"Submitted":"Submit"})]}),i&&!1===a?.isCorrect&&s.jsx("div",{id:"feedback-message",className:F,children:s.jsxs("div",{className:L,children:[s.jsx("p",{className:B,children:"Think your answer was correct?"}),s.jsx("button",{type:"button",className:P,onClick:p,"aria-label":"Mark my answer as correct","data-testid":"override-button",children:"Actually, I was correct"})]})})]})});$.displayName="FreeTextInput";const U="_feedbackSection_z79ui_1",R="_correct_z79ui_10",O="_incorrect_z79ui_15",W="_feedbackHeader_z79ui_20",K="_feedbackIcon_z79ui_27",H="_feedbackTitle_z79ui_48",G="_feedbackContent_z79ui_63",X="_correctAnswerWrapper_z79ui_67",Y="_clickable_z79ui_77",J="_viewDetailsHint_z79ui_98",V="_correctAnswerLabel_z79ui_114",Z="_correctAnswerText_z79ui_124",ee="_explanationWrapper_z79ui_132",te="_explanationText_z79ui_136",se=e.memo(({isCorrect:e,correctAnswer:t,explanation:n,isMastered:r,onShowCardDetails:i})=>s.jsxs("div",{className:_(U,e?R:O),role:"alert","aria-live":"polite","data-testid":"feedback-section",children:[s.jsxs("div",{className:W,children:[s.jsx("span",{className:K,"aria-hidden":"true",children:e?"✓":"✗"}),s.jsx("h3",{className:H,children:e?r?"Card Mastered! 🎯":"Correct!":"Not quite right"})]}),s.jsxs("div",{className:G,children:[!e&&t&&s.jsxs("div",{className:_(X,i&&Y),onClick:i,role:i?"button":void 0,tabIndex:i?0:void 0,onKeyDown:i?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i())}:void 0,"aria-label":i?"Click to view full card details":void 0,children:[s.jsx("span",{className:V,children:"Correct answer:"}),s.jsx("span",{className:Z,children:t}),i&&s.jsx("span",{className:J,"aria-hidden":"true",children:"Click to view card details"})]}),n&&s.jsx("div",{className:ee,children:s.jsx("p",{className:te,children:n})})]})]}));se.displayName="FeedbackSection";const ne="_questionCard_b197b_1",re="_questionHeader_b197b_19",ie="_questionText_b197b_23",ae="_difficultyIndicator_b197b_31",oe="_difficultyBar_b197b_39",ce="_questionContent_b197b_46",le=e.memo(({question:e,card:t,onAnswer:n,showFeedback:r,feedback:i,disabled:a=!1,onShowCardDetails:o})=>s.jsxs("article",{className:ne,role:"region","aria-labelledby":"question-text","data-testid":"question-card","data-question-type":e.type,children:[s.jsxs("header",{className:re,children:[s.jsx("h2",{id:"question-text",className:ie,children:e.questionText}),e.difficulty&&s.jsx("div",{className:ae,"aria-label":`Difficulty: ${Math.round(100*e.difficulty)}%`,children:s.jsx("div",{className:oe,style:{width:100*e.difficulty+"%"}})})]}),s.jsx("div",{className:ce,children:"multiple_choice"===e.type?s.jsx(N,{options:e.options,correctAnswer:e.correctAnswer,onSelect:n,showFeedback:r,feedback:i,disabled:a,resetKey:e.id}):s.jsx($,{correctAnswer:e.correctAnswer,acceptedAnswers:e.acceptedAnswers,onSubmit:n,showFeedback:r,feedback:i,disabled:a||r,resetKey:e.id})}),r&&i&&s.jsx(se,{isCorrect:i.isCorrect,correctAnswer:i.correctAnswer,explanation:i.explanation,isMastered:i.isMastered,onShowCardDetails:o})]}));le.displayName="QuestionCard";const de="_questionFlowContainer_7vbm1_1",ue="_questionWrapper_7vbm1_20",he="_noQuestion_7vbm1_44",me="_continueSection_7vbm1_123",pe="_continueButton_7vbm1_129",_e=e.memo(({currentCard:t,currentQuestion:i,showFeedback:a,feedback:o,onAnswerSubmit:c,onQuestionComplete:l,onShowCardDetails:d})=>{const u=e.useCallback((e,s)=>{t&&c(e,s,t.idx)},[t,c]),h=e.useCallback(()=>{t&&d(t)},[t,d]);return e.useEffect(()=>{const e=e=>{if(!a||"Enter"!==e.key)return;const t=e.target;!!t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.getAttribute("contenteditable"))||(e.preventDefault(),l())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,l]),i?s.jsx("div",{className:de,"data-testid":"question-flow",children:s.jsx(n,{mode:"wait",children:s.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:ue,children:[s.jsx(le,{question:i,card:t||void 0,onAnswer:u,showFeedback:a,feedback:o,onShowCardDetails:h}),a&&s.jsx("div",{className:me,children:s.jsx("button",{onClick:l,className:pe,autoFocus:!0,"data-testid":"continue-button",children:"Continue (Enter)"})})]},i?.id||"no-question")})}):s.jsx("div",{className:he,children:s.jsx("p",{children:"No questions available"})})}),fe="_backdrop_1iynh_1",xe="_modal_1iynh_12",ge="_modalContent_1iynh_29",we="_modalHeader_1iynh_35",be="_modalTitle_1iynh_44",ye="_closeButton_1iynh_51",Ce="_modalBody_1iynh_71",Se="_configuredContent_1iynh_77",ve="_sideGroup_1iynh_84",ke="_sideGroupTitle_1iynh_91",je="_sideItem_1iynh_100",Ne="_sideLabel_1iynh_108",Te="_sideContent_1iynh_118",Me="_allSides_1iynh_125",Ae="_allSidesTitle_1iynh_130",Ie="_sidesGrid_1iynh_139",Ee="_sideCard_1iynh_145",De="_sideCardHeader_1iynh_152",qe="_sideCardLabel_1iynh_158",ze="_sideCardContent_1iynh_166",Qe="_metadata_1iynh_174",Fe="_metadataItems_1iynh_180",Le="_metadataItem_1iynh_180",Be="_modalFooter_1iynh_197",Pe="_actionButton_1iynh_205",$e=({card:t,visible:i,onClose:a,frontSides:o=["side_a"],backSides:c=["side_b"]})=>{if(e.useEffect(()=>{const e=e=>{"Escape"===e.key&&i&&a()};return i&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[i,a]),!t)return null;const l=e=>e.filter(e=>t[e]).map(e=>({label:e.replace("side_","Side ").toUpperCase(),content:t[e]})),d=l(o),u=l(c),h=["side_a","side_b","side_c","side_d","side_e","side_f"].filter(e=>t[e]).map(e=>({label:e.replace("side_","Side ").toUpperCase(),content:t[e]}));return s.jsx(n,{children:i&&s.jsxs(s.Fragment,{children:[s.jsx(r.div,{className:fe,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a}),s.jsx(r.div,{className:xe,initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,type:"spring",stiffness:300,damping:30},children:s.jsxs("div",{className:ge,children:[s.jsxs("header",{className:we,children:[s.jsx("h2",{className:be,children:"Card Details"}),s.jsx("button",{className:ye,onClick:a,"aria-label":"Close modal",children:"×"})]}),s.jsxs("div",{className:Ce,children:[s.jsxs("section",{className:Se,children:[s.jsxs("div",{className:ve,children:[s.jsxs("h3",{className:ke,children:["Front Side",d.length>1?"s":""]}),d.map((e,t)=>s.jsxs("div",{className:je,children:[s.jsxs("span",{className:Ne,children:[e.label,":"]}),s.jsx("p",{className:Te,children:e.content})]},t))]}),s.jsxs("div",{className:ve,children:[s.jsxs("h3",{className:ke,children:["Back Side",u.length>1?"s":""]}),u.map((e,t)=>s.jsxs("div",{className:je,children:[s.jsxs("span",{className:Ne,children:[e.label,":"]}),s.jsx("p",{className:Te,children:e.content})]},t))]})]}),h.length>d.length+u.length&&s.jsxs("section",{className:Me,children:[s.jsx("h3",{className:Ae,children:"All Available Sides"}),s.jsx("div",{className:Ie,children:h.map((e,t)=>s.jsxs("div",{className:Ee,children:[s.jsx("div",{className:De,children:s.jsx("span",{className:qe,children:e.label})}),s.jsx("p",{className:ze,children:e.content})]},t))})]}),(void 0!==t.level||void 0!==t.idx)&&s.jsx("section",{className:Qe,children:s.jsxs("div",{className:Fe,children:[void 0!==t.level&&s.jsxs("span",{className:Le,children:[s.jsx("strong",{children:"Level:"})," ",t.level]}),void 0!==t.idx&&s.jsxs("span",{className:Le,children:[s.jsx("strong",{children:"Index:"})," ",t.idx+1]})]})})]}),s.jsx("footer",{className:Be,children:s.jsx("button",{className:Pe,onClick:a,children:"Close"})})]})})]})})},Ue={container:"_container_ew6j2_1",loading:"_loading_ew6j2_15",emptyState:"_emptyState_ew6j2_25"},Re=e.memo(({deck:t,settings:n,strugglingCardIndices:r,onComplete:c,onExit:l,onOpenSettings:h,deckId:m,allDeckCards:p})=>{const{sessionState:_,updateSessionState:f,handleAnswer:x,nextQuestion:g,cardTracking:w}=(t=>{const[s,n]=e.useState(u),[r,i]=e.useState(new Set),[a,o]=e.useState(new Set),[c,l]=e.useState(new Set),d=e.useCallback(e=>{n(t=>({...t,...e}))},[]),h=e.useCallback(()=>{n({...u,startTime:Date.now(),responseStartTime:Date.now(),responseTimes:[]}),i(new Set),o(new Set),l(new Set)},[]),m=e.useCallback((e,t,s)=>{n(e=>{const n=Date.now()-e.responseStartTime,r=[...e.responseTimes,n],a=new Set(e.correctCards),c=new Set(e.incorrectCards);t?(a.add(s),c.delete(s),i(e=>{const t=new Set(e);return t.add(s),t}),o(e=>{const t=new Set(e);return t.delete(s),t})):(c.add(s),o(e=>{const t=new Set(e);return t.add(s),t}));const l=t?e.currentStreak+1:0,d=Math.max(l,e.maxStreak);return{...e,correctCards:a,incorrectCards:c,currentStreak:l,maxStreak:d,responseTimes:r}})},[]),p=e.useCallback(()=>{n(e=>({...e,questionIndex:e.questionIndex+1,responseStartTime:Date.now()}))},[]),_=e.useMemo(()=>{const e=s.roundCards.length||t.content.length,n=s.correctCards.size,i=s.incorrectCards.size,a=e>0?(n+i)/e*100:0,o=Date.now()-s.startTime;return{correctCount:n,incorrectCount:i,currentStreak:s.currentStreak,maxStreak:s.maxStreak,timeElapsed:o,progressPercentage:a,totalCards:e,masteredCount:r.size}},[s.correctCards,s.incorrectCards,s.currentStreak,s.maxStreak,s.startTime,s.roundCards,t.content.length,r.size]);return{sessionState:s,updateSessionState:d,resetSession:h,handleAnswer:m,nextQuestion:p,metrics:_,cardTracking:{masteredCardIndices:r,strugglingCardIndices:a,newlyMasteredCards:c}}})(t),[b,y]=e.useState(!0),[C,S]=e.useState(!1),[v,k]=e.useState(void 0),[j,N]=e.useState(!1),[T,M]=e.useState(null),[A,I]=e.useState(_.currentQuestion),[E,D]=e.useState(0),{generateRound:q,currentQuestion:z,nextQuestion:Q}=((t,s)=>{const{getMasteredCards:n}=i(),[r,a]=e.useState([]),[c,l]=e.useState(0),[d,u]=e.useState(new Set),[h,m]=e.useState(new Map),p=e.useCallback((e,r)=>{const i=n(t.id),c=o.generateQuestions(e,{questionTypes:s.questionTypes||["multiple_choice"],frontSides:s.questionSides||s.frontSides||["side_a"],backSides:s.answerSides||s.backSides||["side_b"],difficulty:1,excludeCards:new Set,forceMultipleChoice:!1,questionTypeMix:s.questionTypeMix||"auto"},i,r||e);a(c),l(0),u(new Set),m(new Map)},[s,t.id,n]),_=e.useCallback((e,t)=>{if(!s.questionTypes?.includes("free_text"))return;const n=r.filter(t=>t.cardIndex===e).map(t=>({idx:e,name:"",side_a:t.questionText,side_b:t.correctAnswer,level:1}));if(n.length>0){const r=o.generateFreeText(n[0],{front:s.frontSides||["side_a"],back:s.backSides||["side_b"]},e),i={...r,id:`ft_followup_${t}_${Date.now()}`,isFollowUp:!0,parentQuestionId:t,questionText:`Now type the answer: ${r.questionText}`};a(e=>{const t=[...e];return t.splice(c+1,0,i),t})}},[r,c,s]),f=e.useCallback(e=>{if(!s.questionTypes?.includes("free_text"))return!1;const t=s.progressiveLearning??"spaced",n=s.progressiveLearningSpacing??3;if("disabled"===t)return!1;if("immediate"===t){const t=h.get(e)||0;if(n>1){const s=c-r.slice(0,c).reverse().findIndex(t=>t.cardIndex===e);return t<2&&s>=n}return t<2}if("spaced"===t){let t=-1;for(let s=c;s>=0;s--)if(r[s].cardIndex===e&&!r[s].isFollowUp){t=s;break}return t!==c&&c-t>=n}return"random"===t&&Math.random()<.3},[s,h,r,c]),x=e.useCallback(()=>{const e=r[c];e&&m(t=>{const s=new Map(t);return s.set(e.cardIndex,(t.get(e.cardIndex)||0)+1),s}),e&&"multiple_choice"===e.type&&!e.isFollowUp&&d.has(e.cardIndex)&&!r[c+1]?.isFollowUp&&c<r.length-1&&f(e.cardIndex)&&_(e.cardIndex,e.id),l(e=>Math.min(e+1,r.length-1))},[r,c,d,_,f]),g=e.useCallback(()=>{a([]),l(0),u(new Set),m(new Map)},[]),w=e.useMemo(()=>r[c]||null,[r,c]),b=e.useMemo(()=>c<r.length-1,[c,r.length]),y=e.useCallback(e=>{u(t=>new Set(t).add(e))},[]);return{questions:r,currentQuestion:w,currentQuestionIndex:c,hasNext:b,nextQuestion:x,generateRound:p,reset:g,addFollowUpQuestion:_,markMCCorrect:y}})(t,n),F=(t=>{const[s,n]=e.useState(new Map),r=e=>"leitner_box"===e?"leitner_box":"smart_spaced",[i,a]=e.useState(r(t.schedulingAlgorithm));e.useEffect(()=>{const e=r(t.schedulingAlgorithm);e!==i&&a(e)},[t.schedulingAlgorithm,i]);const o=e.useMemo(()=>d.getScheduler(i),[i]),c=e.useMemo(()=>({algorithm:i,aggressiveness:t.aggressiveness||"balanced",minSpacing:t.minSpacing||2,maxSpacing:t.maxSpacing||8,clusterLimit:t.clusterLimit||2,progressRatio:t.progressRatio||.3,difficultyWeight:t.difficultyWeight||.5}),[t,i]),l=e.useCallback((e,t,s)=>{n(n=>{const r=new Map(n),i=r.get(e),a=i?{...i,missCount:i.missCount+1,lastSeen:Date.now(),responseTime:s,difficulty:Math.min(1,i.difficulty+.1)}:{cardId:e,cardIndex:t,missCount:1,lastSeen:Date.now(),difficulty:.5,responseTime:s};return a.difficulty=Math.min(1,.2*a.missCount+(s>1e4?.3:0)),r.set(e,a),r})},[]),u=e.useCallback(e=>{n(t=>{const s=new Map(t),n=s.get(e);return n?(1===n.missCount?s.delete(e):s.set(e,{...n,difficulty:.7*n.difficulty,missCount:Math.max(0,n.missCount-1)}),s):t})},[]),h=e.useCallback(e=>{if(0===s.size)return e;const t=Array.from(s.values());return o.schedule(t,e,c)},[s,o,c]),m=e.useCallback(e=>{a(e)},[]),p=e.useCallback(()=>{n(new Map)},[]),_=e.useMemo(()=>d.getAvailableAlgorithms(),[]);return{missedCards:s,trackMissedCard:l,markCardCorrect:u,scheduleCards:h,changeAlgorithm:m,availableAlgorithms:_,currentAlgorithm:i,resetScheduler:p}})(n),{isCardMastered:L}=i();e.useEffect(()=>{if(z){I(z),f({currentQuestion:z});const e=z.cardIndex,t=_.roundCards.find(t=>t.idx===e);t&&M(t)}},[z,_.roundCards]),e.useEffect(()=>{(async()=>{if(y(!0),!t.content||0===t.content.length)return void y(!1);const e=[];if(r&&r.length>0){const s=r.map(e=>t.content.find(t=>t.idx===e)).filter(e=>void 0!==e);e.push(...s)}if(e.length<n.cardsPerRound){const s=new Set(r||[]),i=t.content.filter(e=>!s.has(e.idx)),a=F.scheduleCards(i),o=n.cardsPerRound-e.length;e.push(...a.slice(0,o))}if(0===e.length)return void y(!1);const s=e.slice(0,n.cardsPerRound);q(s,p||t.content),f({roundCards:s,responseStartTime:Date.now()}),D(0),y(!1)})()},[t,n,r]);const B=e.useCallback((e,t,s)=>{x(e,t,s);const n=!!m&&L(m,s);k({isCorrect:t,correctAnswer:_.currentQuestion?.correctAnswer||"",explanation:_.currentQuestion?.explanation,isMastered:n}),S(!0)},[x,m,L,_.currentQuestion]),P=e.useCallback(()=>{const e=_.roundCards.length||0;if(E+1>=e){const e=_.correctCards.size+_.incorrectCards.size,t=e>0?_.correctCards.size/e*100:0,s={deckId:m||"",totalQuestions:e,correctAnswers:_.correctCards.size,incorrectAnswers:_.incorrectCards.size,accuracy:t,averageResponseTime:_.responseTimes.length>0?_.responseTimes.reduce((e,t)=>e+t,0)/_.responseTimes.length:0,maxStreak:_.maxStreak,duration:Date.now()-_.startTime,passedCards:Array.from(_.correctCards),strugglingCards:Array.from(w.strugglingCardIndices),masteredCards:Array.from(w.masteredCardIndices)};return void c(s)}S(!1),k(void 0),Q(),g(),D(e=>e+1)},[_,w,m,Q,g,c,E]),$=e.useCallback(e=>{M(e),N(!0)},[]),U=e.useCallback(()=>{h()},[h]);return b?s.jsx("div",{className:Ue.container,children:s.jsx("div",{className:Ue.loading,children:"Loading questions..."})}):0===_.roundCards.length?s.jsx("div",{className:Ue.container,children:s.jsxs("div",{className:Ue.emptyState,children:[s.jsx("h2",{children:"No cards available"}),s.jsx("p",{children:"Adjust your settings to include more cards."}),s.jsx("button",{onClick:h,className:Ue.settingsButton,children:"Open Settings"})]})}):s.jsxs("div",{className:Ue.container,children:[s.jsx(a,{deckName:t.metadata.deck_name,currentCard:E+1,totalCards:_.roundCards.length,onBackClick:l,onSettingsClick:U,showSettings:!0}),s.jsx(_e,{sessionState:_,deck:t,settings:n,currentCard:T,currentQuestion:A,showFeedback:C,feedback:v,onAnswerSubmit:B,onQuestionComplete:P,onShowCardDetails:$}),j&&T&&s.jsx($e,{card:T,visible:j,onClose:()=>N(!1),frontSides:n.frontSides,backSides:n.backSides})]})}),Oe={learnPage:"_learnPage_12mgr_1",errorContainer:"_errorContainer_12mgr_10",backButton:"_backButton_12mgr_32"};export{Re as L,le as Q,_ as c,Oe as s};
