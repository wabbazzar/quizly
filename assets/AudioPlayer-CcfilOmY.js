import{u as e,s,r as a,j as n,q as t,t as r,v as c,w as l,N as i,x as d,y as o}from"./index-CoElTYbf.js";const u="_container_sn8d7_1",_="_header_sn8d7_10",m="_backButton_sn8d7_20",h="_title_sn8d7_39",p="_headerSpacer_sn8d7_46",x="_content_sn8d7_50",j="_nowPlaying_sn8d7_58",k="_trackInfo_sn8d7_64",v="_trackChapter_sn8d7_72",N="_trackType_sn8d7_78",b="_progressContainer_sn8d7_85",y="_progressBar_sn8d7_92",f="_time_sn8d7_125",g="_controls_sn8d7_134",E="_controlButton_sn8d7_142",L="_playButton_sn8d7_166",C="_speedControl_sn8d7_191",T="_speedBtn_sn8d7_201",P="_speedLabel_sn8d7_228",$="_speedSlider_sn8d7_237",w="_trackList_sn8d7_266",R="_trackListTitle_sn8d7_273",I="_tracks_sn8d7_282",S="_trackItem_sn8d7_291",z="_activeTrack_sn8d7_309",B="_trackIndex_sn8d7_313",D="_trackName_sn8d7_326",A="_playingBars_sn8d7_341",F="_loading_sn8d7_376",M="_empty_sn8d7_377",q="/quizly/",G=()=>{const G=e(),{tracks:V,setTracks:H,currentTrackIndex:J,isPlaying:K,currentTime:O,duration:Q,playbackRate:U,setIsPlaying:W,setCurrentTime:X,setDuration:Y,setPlaybackRate:Z,playTrack:ee,nextTrack:se,previousTrack:ae,togglePlay:ne}=s(),te=a.useRef(null),re=a.useRef(null),[ce,le]=a.useState(!0),ie=a.useRef(!1);a.useEffect(()=>{0===V.length?(async()=>{try{const e=await fetch(`${q}data/transcripts/manifest.json`),s=await e.json(),a=d(s.transcripts),n=o(a);H(n)}catch(e){}finally{le(!1)}})():le(!1)},[H,V.length]),a.useEffect(()=>{const e=te.current;if(!e)return;const s=()=>X(e.currentTime),a=()=>Y(e.duration||0),n=()=>{ie.current=!0,se(),setTimeout(()=>{ie.current=!1},100)},t=()=>W(!0),r=()=>{ie.current||W(!1)},c=()=>{e.playbackRate=U/100};return e.addEventListener("timeupdate",s),e.addEventListener("durationchange",a),e.addEventListener("ended",n),e.addEventListener("play",t),e.addEventListener("pause",r),e.addEventListener("loadedmetadata",c),()=>{e.removeEventListener("timeupdate",s),e.removeEventListener("durationchange",a),e.removeEventListener("ended",n),e.removeEventListener("play",t),e.removeEventListener("pause",r),e.removeEventListener("loadedmetadata",c)}},[X,Y,W,se,U]),a.useEffect(()=>{const e=te.current;e&&(K?e.play().catch(()=>{W(!1)}):e.pause())},[K,W]),a.useEffect(()=>{const e=te.current;if(!e||0===V.length)return;const s=V[J];if(s){const a=`${q}data/audio/${s.audioFile}`;e.src!==a&&(e.src=a,e.load(),e.playbackRate=U/100,K&&e.play().catch(()=>W(!1)))}},[J,V,K,W,U]),a.useEffect(()=>{if(re.current){const e=re.current.querySelector(`.${z}`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}},[J]),a.useEffect(()=>{te.current&&(te.current.playbackRate=U/100)},[U]),a.useEffect(()=>{const e=e=>{" "===e.key&&e.target===document.body?(e.preventDefault(),ne()):"ArrowLeft"===e.key?ae():"ArrowRight"===e.key&&se()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ne,ae,se]);const de=a.useCallback(e=>{const s=parseFloat(e.target.value);X(s),te.current&&(te.current.currentTime=s)},[X]),oe=a.useCallback(()=>{Z(Math.max(50,U-5))},[U,Z]),ue=a.useCallback(()=>{Z(Math.min(150,U+5))},[U,Z]),_e=e=>{if(!isFinite(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},me=e=>`Ch ${e.chapterNumber}.${e.partNumber} - ${"phrases"===e.type?"Phrases":"Dialogue"}`,he=V[J];return n.jsxs("div",{className:u,children:[n.jsxs("header",{className:_,children:[n.jsx("button",{className:m,onClick:()=>G(-1),"aria-label":"Go back",children:n.jsx(t,{size:24})}),n.jsx("h1",{className:h,children:"Audio Player"}),n.jsx("div",{className:p})]}),n.jsxs("div",{className:x,children:[n.jsxs("div",{className:j,children:[n.jsx("div",{className:k,children:he?n.jsxs(n.Fragment,{children:[n.jsxs("span",{className:v,children:["Chapter ",he.chapterNumber,".",he.partNumber]}),n.jsx("span",{className:N,children:"phrases"===he.type?"Phrases":"Dialogue"})]}):n.jsx("span",{className:v,children:"No track selected"})}),n.jsxs("div",{className:b,children:[n.jsx("span",{className:f,children:_e(O)}),n.jsx("input",{type:"range",className:y,min:0,max:Q||100,value:O,onChange:de,"aria-label":"Seek"}),n.jsx("span",{className:f,children:_e(Q)})]}),n.jsxs("div",{className:g,children:[n.jsx("button",{className:E,onClick:ae,disabled:0===J&&O<3,"aria-label":"Previous track",children:n.jsx(r,{size:28})}),n.jsx("button",{className:L,onClick:ne,"aria-label":K?"Pause":"Play",children:K?n.jsx(c,{size:32}):n.jsx(l,{size:32})}),n.jsx("button",{className:E,onClick:se,disabled:J>=V.length-1,"aria-label":"Next track",children:n.jsx(i,{size:28})})]}),n.jsxs("div",{className:C,children:[n.jsx("button",{onClick:oe,className:T,"aria-label":"Decrease speed",disabled:U<=50,children:"-"}),n.jsxs("span",{className:P,children:[U,"%"]}),n.jsx("input",{type:"range",min:"50",max:"150",step:"5",value:U,onChange:e=>Z(Number(e.target.value)),className:$,"aria-label":"Playback speed"}),n.jsx("button",{onClick:ue,className:T,"aria-label":"Increase speed",disabled:U>=150,children:"+"})]})]}),n.jsxs("div",{className:w,ref:re,children:[n.jsxs("h2",{className:R,children:["All Tracks (",V.length,")"]}),ce?n.jsx("div",{className:F,children:"Loading tracks..."}):0===V.length?n.jsx("div",{className:M,children:"No audio tracks available"}):n.jsx("ul",{className:I,children:V.map((e,s)=>n.jsx("li",{children:n.jsxs("button",{className:`${S} ${s===J?z:""}`,onClick:()=>ee(s),children:[n.jsx("span",{className:B,children:s+1}),n.jsx("span",{className:D,children:me(e)}),s===J&&K&&n.jsxs("span",{className:A,children:[n.jsx("span",{}),n.jsx("span",{}),n.jsx("span",{})]})]})},e.id))})]})]}),n.jsx("audio",{ref:te,preload:"metadata"})]})};export{G as default};
