import{h as e,p as s,r as n,j as t,B as i,k as r,l as a,P as l,n as o,o as c,f as d,u,d as h}from"./index-CoElTYbf.js";import{P as _}from"./PageHeader-DBfiEiyF.js";import{l as m,g as p,h as x}from"./transcriptService-BCIO_PIi.js";import{M as g}from"./Modal-BFeOgvFJ.js";import{U as v}from"./UnifiedSettings-T8dbAibN.js";import{S as f}from"./SettingsIcon-CGtfF6CW.js";const j={answerType:"free_text",checkMode:"wait",translationDirection:{from:"b",to:"c"},optionsCount:4,showPinyinDefault:!1,multipleChoiceDifficulty:"medium",unit:"character",translationMode:"sentence",accuracyThreshold:70,showWordHints:!0},k=e()(s((e,s)=>({progress:{},session:null,settings:j,initSession:(s,n)=>{e(e=>({session:{deckId:s,currentDialogueId:n,currentLineIndex:0,currentTokenIndex:0,showPinyin:e.settings.showPinyinDefault,showTranslation:!1,correctCount:0,incorrectCount:0,startTime:Date.now(),responseStartTime:Date.now(),responseTimes:[]}}))},setCurrentDialogue:s=>{e(e=>{if(!e.session)return e;const n=e.session.deckId,t=e.progress[n]||{dialogueId:s,lineIndex:0,tokenIndex:0,completedTokens:new Set,masteredTokens:new Set};return{progress:{...e.progress,[n]:{...t,dialogueId:s}},session:{...e.session,currentDialogueId:s,currentLineIndex:0,currentTokenIndex:0}}})},setCurrentLine:s=>{e(e=>{if(!e.session)return e;const n=e.session.deckId,t=e.session.currentDialogueId||"",i=e.progress[n]||{dialogueId:t,lineIndex:0,tokenIndex:0,completedTokens:new Set,masteredTokens:new Set};return{progress:{...e.progress,[n]:{...i,lineIndex:s}},session:{...e.session,currentLineIndex:s,currentTokenIndex:0}}})},setCurrentToken:s=>{e(e=>{if(!e.session)return e;const n=e.session.deckId,t=e.session.currentDialogueId||"",i=e.session.currentLineIndex,r=e.progress[n]||{dialogueId:t,lineIndex:i,tokenIndex:0,completedTokens:new Set,masteredTokens:new Set};return{progress:{...e.progress,[n]:{...r,tokenIndex:s}},session:{...e.session,currentTokenIndex:s,responseStartTime:Date.now()}}})},markTokenComplete:(s,n,t)=>{e(e=>{if(!e.session)return e;const i=e.session.deckId,r=`${s}:${n}:${t}`,a=e.progress[i]||{dialogueId:s,lineIndex:0,tokenIndex:0,completedTokens:new Set,masteredTokens:new Set},l=new Set(a.completedTokens);return l.add(r),{progress:{...e.progress,[i]:{...a,completedTokens:l}}}})},markTokenMastered:(s,n,t)=>{e(e=>{if(!e.session)return e;const i=e.session.deckId,r=`${s}:${n}:${t}`,a=e.progress[i]||{dialogueId:s,lineIndex:0,tokenIndex:0,completedTokens:new Set,masteredTokens:new Set},l=new Set(a.masteredTokens);l.add(r);const o=new Set(a.completedTokens);return o.add(r),{progress:{...e.progress,[i]:{...a,completedTokens:o,masteredTokens:l}}}})},togglePinyin:()=>{e(e=>e.session?{session:{...e.session,showPinyin:!e.session.showPinyin}}:e)},toggleTranslation:()=>{e(e=>e.session?{session:{...e.session,showTranslation:!e.session.showTranslation}}:e)},updateSettings:s=>{e(e=>({settings:{...e.settings,...s},session:e.session&&void 0!==s.showPinyinDefault?{...e.session,showPinyin:s.showPinyinDefault}:e.session}))},recordAnswer:(s,n)=>{e(e=>e.session?{session:{...e.session,correctCount:e.session.correctCount+(s?1:0),incorrectCount:e.session.incorrectCount+(s?0:1),responseTimes:[...e.session.responseTimes,n]}}:e)},clearSession:()=>{e({session:null})},resetProgress:s=>{e(e=>{const n={...e.progress};return delete n[s],{progress:n}})},getProgress:e=>s().progress[e]||null}),{name:"read-store",version:3,partialize:e=>({progress:e.progress,settings:e.settings}),migrate:(e,s)=>{if(s<2&&(e={...e,settings:{...j,...e.settings,translationMode:e.settings?.translationMode||"sentence",accuracyThreshold:e.settings?.accuracyThreshold||70,showWordHints:!1!==e.settings?.showWordHints}}),s<3){const s=e.settings?.translationDirection?.from,n=e.settings?.translationDirection?.to;"a"===s&&"c"===n&&(e={...e,settings:{...e.settings,translationDirection:{from:"b",to:"c"}}})}return e}})),y="_container_15iu2_1",N="_title_15iu2_7",C="_dialogueList_15iu2_14",w="_dialogueButton_15iu2_20",b="_selected_15iu2_33",T="_dialogueContent_15iu2_44",S="_dialogueHeader_15iu2_51",L="_dialogueName_15iu2_57",M="_completeIcon_15iu2_78",I="_dialogueInfo_15iu2_82",z="_lineCount_15iu2_91",D="_progress_15iu2_96",P="_progressBar_15iu2_119",A="_progressFill_15iu2_128",$=({deck:e,selectedDialogueId:s,onSelectDialogue:r,progress:a})=>{const l=n.useMemo(()=>{if(!e.reading)return{};const s={};return Object.entries(e.reading.dialogues).forEach(([e,n])=>{const t=n.lines.reduce((e,s)=>{let n=0;return s.a&&n++,s.b&&n++,s.c&&n++,e+n},0),i=a?.completedTokens?Array.from(a.completedTokens).filter(s=>s.startsWith(`${e}:`)).length:0;s[e]={completed:i,total:t}}),s},[e,a]);if(!e.reading)return null;const o=Object.entries(e.reading.dialogues);return t.jsxs("div",{className:y,children:[t.jsx("h3",{className:N,children:"Practice"}),t.jsx("div",{className:C,children:o.map(([e,n])=>{const a=s===e,o=l[e],c=o?o.completed/o.total*100:0,d=e.replace(/dialogue(\d+)/,"Dialogue $1").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return t.jsx(i,{variant:a?"primary":"secondary",className:`${w} ${a?b:""}`,onClick:()=>r(e),children:t.jsxs("div",{className:T,children:[t.jsxs("div",{className:S,children:[t.jsx("span",{className:L,children:d}),100===c&&t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:M,children:t.jsx("path",{d:"M20 6L9 17L4 12"})})]}),t.jsxs("div",{className:I,children:[t.jsxs("span",{className:z,children:[n.lines.length," lines"]}),o&&o.completed>0&&t.jsxs("span",{className:D,children:[o.completed,"/",o.total," tokens"]})]}),c>0&&c<100&&t.jsx("div",{className:P,children:t.jsx("div",{className:A,style:{width:`${c}%`}})})]})},e)})})]})},E={availableTranscripts:[],selectedTranscript:null,transcriptContent:null,isLoading:!1,isLoadingContent:!1,error:null,isModalOpen:!1},B=e(e=>({...E,loadTranscriptsForDeck:async s=>{e({isLoading:!0,error:null});try{const n=await p(s);e({availableTranscripts:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load transcripts",isLoading:!1,availableTranscripts:[]})}},selectTranscript:async s=>{e({selectedTranscript:s,isLoadingContent:!0,error:null,isModalOpen:!0,transcriptContent:null});try{const n=await m(s.filename);e({transcriptContent:n,isLoadingContent:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load transcript content",isLoadingContent:!1})}},closeModal:()=>{e({isModalOpen:!1,selectedTranscript:null,transcriptContent:null,error:null})},clearError:()=>e({error:null}),reset:()=>e(E)})),H="_container_15xcv_1",W="_title_15xcv_7",F="_subtitle_15xcv_14",q="_loading_15xcv_21",R="_transcriptList_15xcv_28",O="_transcriptButton_15xcv_34",U="_transcriptContent_15xcv_50",G="_transcriptName_15xcv_57",K="_icon_15xcv_62",V=({deckId:e})=>{const{availableTranscripts:s,isLoading:r,loadTranscriptsForDeck:a,selectTranscript:l}=B();return n.useEffect(()=>{a(e)},[e,a]),r?t.jsxs("div",{className:H,children:[t.jsx("h3",{className:W,children:"Transcripts"}),t.jsx("div",{className:q,children:"Loading..."})]}):0===s.length?null:t.jsxs("div",{className:H,children:[t.jsx("h3",{className:W,children:"Transcripts"}),t.jsx("p",{className:F,children:"Raw text for external readers"}),t.jsx("div",{className:R,children:s.map(e=>t.jsx(i,{variant:"secondary",className:O,onClick:()=>l(e),children:t.jsxs("div",{className:U,children:[t.jsx("span",{className:G,children:e.displayName}),t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:K,"aria-hidden":"true",children:[t.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),t.jsx("polyline",{points:"15,3 21,3 21,9"}),t.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})},e.id))})]})},X="_sidebar_1h4om_1",J="_divider_1h4om_7",Y=({deck:e,selectedDialogueId:s,onSelectDialogue:n,progress:i})=>{const r=e.reading&&Object.keys(e.reading.dialogues).length>0;return t.jsxs("div",{className:X,children:[r&&t.jsx($,{deck:e,selectedDialogueId:s,onSelectDialogue:n,progress:i}),t.jsx("div",{className:J}),t.jsx(V,{deckId:e.id})]})},Q=({size:e=24,color:s="currentColor",className:n=""})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t.jsx("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})]}),Z="_transcriptModal_y0hl9_1",ee="_modalContent_y0hl9_6",se="_audioPlayer_y0hl9_13",ne="_progressContainer_y0hl9_29",te="_time_y0hl9_36",ie="_progressBar_y0hl9_43",re="_controls_y0hl9_90",ae="_controlBtn_y0hl9_100",le="_skipBtn_y0hl9_127",oe="_playBtn_y0hl9_152",ce="_copyContainer_y0hl9_177",de="_copiedText_y0hl9_185",ue="_copyBtn_y0hl9_200",he="_speedControl_y0hl9_225",_e="_speedLabel_y0hl9_232",me="_speedBtn_y0hl9_240",pe="_speedSlider_y0hl9_266",xe="_textToolbar_y0hl9_303",ge="_contentContainer_y0hl9_321",ve="_transcriptText_y0hl9_335",fe="_loading_y0hl9_346",je="_spinner_y0hl9_356",ke="_error_y0hl9_371",ye="_errorDetail_y0hl9_377",Ne="_empty_y0hl9_383",Ce=()=>{const{isModalOpen:e,selectedTranscript:s,transcriptContent:i,isLoadingContent:d,error:u,closeModal:h}=B(),[_,m]=n.useState(!1),[p,x]=n.useState(!1),[v,f]=n.useState(100),[j,k]=n.useState(0),[y,N]=n.useState(0),C=n.useRef(null),w=s?.audioFile,b=w?`/quizly/data/audio/${w}`:null;n.useEffect(()=>{!e&&C.current&&(C.current.pause(),C.current.currentTime=0,x(!1),k(0))},[e]),n.useEffect(()=>{const e=C.current;if(!e)return;const s=()=>x(!1),n=()=>k(e.currentTime),t=()=>N(e.duration);return e.addEventListener("ended",s),e.addEventListener("timeupdate",n),e.addEventListener("loadedmetadata",t),()=>{e.removeEventListener("ended",s),e.removeEventListener("timeupdate",n),e.removeEventListener("loadedmetadata",t)}},[b]),n.useEffect(()=>{C.current&&(C.current.playbackRate=v/100)},[v]);const T=n.useCallback(()=>{C.current&&(p?(C.current.pause(),x(!1)):(C.current.play(),x(!0)))},[p]),S=n.useCallback(()=>{C.current&&(C.current.currentTime=Math.max(0,C.current.currentTime-10))},[]),L=n.useCallback(()=>{C.current&&(C.current.currentTime=Math.min(y,C.current.currentTime+10))},[y]),M=n.useCallback(()=>{C.current&&(C.current.currentTime=0,p||(C.current.play(),x(!0)))},[p]),I=n.useCallback(e=>{if(!C.current)return;const s=Number(e.target.value);C.current.currentTime=s,k(s)},[]),z=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,D=n.useCallback(()=>{f(e=>Math.max(75,e-5))},[]),P=n.useCallback(()=>{f(e=>Math.min(100,e+5))},[]),A=n.useCallback(async()=>{if(i)try{await navigator.clipboard.writeText(i),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){try{const e=document.createElement("textarea");e.value=i,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),m(!0),setTimeout(()=>m(!1),2e3)}catch(s){}}},[i]),$=s?`${s.displayName} Transcript`:"Transcript";return t.jsx(g,{isOpen:e,onClose:h,title:$,size:"large",className:Z,children:t.jsxs("div",{className:ee,children:[b?t.jsxs(t.Fragment,{children:[t.jsx("audio",{ref:C,src:b,preload:"metadata"}),t.jsxs("div",{className:se,children:[t.jsxs("div",{className:ne,children:[t.jsx("span",{className:te,children:z(j)}),t.jsx("input",{type:"range",min:"0",max:y||100,value:j,onChange:I,className:ie,"aria-label":"Seek"}),t.jsx("span",{className:te,children:z(y)})]}),t.jsxs("div",{className:re,children:[t.jsx("button",{onClick:M,className:ae,"aria-label":"Restart",disabled:d,children:t.jsx(r,{size:26})}),t.jsx("button",{onClick:S,className:le,"aria-label":"Skip back 10 seconds",disabled:d,children:t.jsx(a,{size:36})}),t.jsx("button",{onClick:T,className:oe,"aria-label":p?"Pause":"Play",disabled:d,children:p?t.jsx(l,{size:32}):t.jsx(o,{size:32})}),t.jsx("button",{onClick:L,className:le,"aria-label":"Skip forward 10 seconds",disabled:d,children:t.jsx(c,{size:36})}),t.jsxs("div",{className:ce,children:[_&&t.jsx("span",{className:de,children:"Copied!"}),t.jsx("button",{onClick:A,className:ue,"aria-label":_?"Copied!":"Copy transcript",title:_?"Copied!":"Copy",disabled:!i||d,children:t.jsx(Q,{size:22})})]})]}),t.jsxs("div",{className:he,children:[t.jsx("button",{onClick:D,className:me,"aria-label":"Decrease speed",disabled:v<=75,children:"-"}),t.jsxs("span",{className:_e,children:[v,"%"]}),t.jsx("input",{type:"range",min:"75",max:"100",step:"5",value:v,onChange:e=>f(Number(e.target.value)),className:pe,"aria-label":"Playback speed"}),t.jsx("button",{onClick:P,className:me,"aria-label":"Increase speed",disabled:v>=100,children:"+"})]})]})]}):t.jsx("div",{className:xe,children:t.jsxs("div",{className:ce,children:[_&&t.jsx("span",{className:de,children:"Copied!"}),t.jsx("button",{onClick:A,className:ue,"aria-label":_?"Copied!":"Copy transcript",title:_?"Copied!":"Copy",disabled:!i||d,children:t.jsx(Q,{size:22})})]})}),t.jsx("div",{className:ge,children:d?t.jsxs("div",{className:fe,children:[t.jsx("div",{className:je}),t.jsx("span",{children:"Loading transcript..."})]}):u?t.jsxs("div",{className:ke,children:[t.jsx("p",{children:"Failed to load transcript content."}),t.jsx("p",{className:ye,children:u})]}):i?t.jsx("pre",{className:ve,children:i}):t.jsx("div",{className:Ne,children:"No content available."})})]})})};function we(e,s){const n=be(e),t=be(s);if(n===t)return 100;if(0===n.length&&0===t.length)return 100;if(0===n.length||0===t.length)return 0;const i=Math.max(n.length,t.length),r=function(e,s){const n=Array(s.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let t=0;t<=e.length;t+=1)n[0][t]=t;for(let t=0;t<=s.length;t+=1)n[t][0]=t;for(let t=1;t<=s.length;t+=1)for(let i=1;i<=e.length;i+=1){const r=e[i-1]===s[t-1]?0:1;n[t][i]=Math.min(n[t][i-1]+1,n[t-1][i]+1,n[t-1][i-1]+r)}return n[s.length][e.length]}(n,t);return Math.max(0,(i-r)/i*100)}function be(e){return e.toLowerCase().trim().replace(/[.,!?;:()\[\]{}"'`~@#$%^&*+=\-\/\\|<>]/g,"").replace(/\s+/g," ").trim()}function Te(e){return be(e).split(/\s+/).filter(e=>e.length>0)}function Se(e,s,n,t=70){const i=function(e,s){const n=[],t=e[s];if(t&&n.push(t),e.wordAlignments&&"c"===s){const s=e.wordAlignments.filter(e=>e.english.trim().length>0).map(e=>e.english.trim());s.length>0&&n.push(s.join(" "))}return[...new Set(n)]}(s,n),r=i[0]||"";if(!r)return{userAnswer:e,correctAnswer:"",accuracy:0,isCorrect:!1,suggestions:[]};let a=0,l=r;i.forEach(s=>{const n=we(e,s);n>a&&(a=n,l=s)});const o=function(e,s){const n=Te(e),t=Te(s),i=new Set;return n.map(e=>{let s=null,n=0;return t.forEach(t=>{if(i.has(t))return;const r=we(e,t);r>n&&r>=70&&(s=t,n=r)}),s?(i.add(s),{word:e,matched:!0,similarity:n}):{word:e,matched:!1}})}(e,l),c=a>=t;return{userAnswer:e,correctAnswer:l,accuracy:Math.round(a),isCorrect:c,wordMatches:o,suggestions:i.slice(1)}}function Le(e){return e.wordAlignments&&0!==e.wordAlignments.length?e.wordAlignments.map((e,s)=>({chinese:e.chinese,pinyin:e.pinyin,english:e.english,index:s})):[]}function Me(e){return Boolean(e.wordAlignments&&e.wordAlignments.length>0)}const Ie="_container_unlz3_1",ze="_sourceSection_unlz3_9",De="_sectionLabel_unlz3_15",Pe="_sourceText_unlz3_23",Ae="_staticSource_unlz3_38",$e="_interactiveSource_unlz3_55",Ee="_wordTokensContainer_unlz3_63",Be="_wordToken_unlz3_63",He="_clickable_unlz3_93",We="_revealed_unlz3_105",Fe="_static_unlz3_38",qe="_tokenHintPopup_unlz3_114",Re="_hintText_unlz3_143",Oe="_answerSection_unlz3_149",Ue="_freeTextSection_unlz3_155",Ge="_textInput_unlz3_161",Ke="_submitted_unlz3_182",Ve="_multipleChoiceSection_unlz3_191",Xe="_option_unlz3_197",Je="_selected_unlz3_219",Ye="_correct_unlz3_224",Qe="_incorrect_unlz3_229",Ze="_optionLetter_unlz3_239",es="_optionText_unlz3_261",ss="_actions_unlz3_271",ns="_submitButton_unlz3_278",ts="_skipButton_unlz3_282",is="_resultSection_unlz3_286",rs="_resultHeader_unlz3_300",as="_accuracyScore_unlz3_316",ls="_resultStatus_unlz3_321",os="_correctAnswer_unlz3_326",cs="_correctLabel_unlz3_336",ds="_correctText_unlz3_342",us="_wordAnalysis_unlz3_350",hs="_analysisLabel_unlz3_356",_s="_wordMatches_unlz3_362",ms="_wordMatch_unlz3_362",ps="_matched_unlz3_376",xs="_unmatched_unlz3_382",gs="_suggestions_unlz3_388",vs="_suggestionsLabel_unlz3_394",fs="_suggestionsList_unlz3_400",js="_suggestion_unlz3_388",ks=({line:e,allLines:s,settings:r,onAnswer:a,onSkip:l,showResult:o=!1,disabled:c=!1})=>{const[d,u]=n.useState(""),[h,_]=n.useState(null),[m,p]=n.useState(null),x=e[r.translationDirection.from]||"",g=n.useMemo(()=>"multiple_choice"===r.answerType?function(e,s,n,t=4,i="medium"){const r=e[s];if(!r)return[];const a=[r],l=new Set([be(r)]),o=[];"easy"===i&&Object.keys(e).forEach(n=>{if(n!==s&&"string"==typeof e[n]){const s=e[n];s&&!l.has(be(s))&&o.push(s)}}),n.forEach(n=>{if(n===e)return;const t=n[s];t&&!l.has(be(t))&&o.push(t)});const c=o.sort(()=>Math.random()-.5).slice(0,t-1);return a.push(...c),a.sort(()=>Math.random()-.5)}(e,r.translationDirection.to,s,r.optionsCount||4,r.multipleChoiceDifficulty||"medium"):[],[e,s,r]),v=n.useMemo(()=>Me(e),[e]),f=n.useMemo(()=>v?Le(e):[],[e,v]),j=n.useCallback(()=>{if(c||m)return;const s=Se("multiple_choice"===r.answerType?h||"":d,e,r.translationDirection.to,r.accuracyThreshold||70);p(s),a(s)},[d,h,r,e,a,c,m]),k=n.useCallback(s=>{c||m||(_(s),"live"===r.checkMode&&setTimeout(()=>{const n=Se(s,e,r.translationDirection.to,r.accuracyThreshold||70);p(n),a(n)},100))},[r,e,a,c,m]),y=n.useCallback(e=>{c||m||(u(e.target.value),"live"===r.checkMode&&e.target.value.trim())},[r,c,m]),N=n.useCallback(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())},[j]),[C,w]=n.useState(null),b=n.useRef(null);n.useEffect(()=>{if(null===C)return;const e=e=>{b.current&&!b.current.contains(e.target)&&w(null)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[C]);const T=n.useCallback(e=>{const s=r.translationDirection.from;return"b"===s?e.pinyin:"c"===s?e.english:e.chinese},[r.translationDirection.from]),S=n.useCallback(e=>{const s=r.translationDirection.from,n=[];return"a"!==s&&e.chinese&&n.push(e.chinese),"b"!==s&&e.pinyin&&n.push(e.pinyin),"c"!==s&&e.english&&n.push(e.english),n.join(" - ")},[r.translationDirection.from]),L=n.useCallback(e=>S(e).length>0,[S]),M=n.useCallback(e=>{r.showWordHints&&v&&w(s=>s===e?null:e)},[r.showWordHints,v]);n.useEffect(()=>{u(""),_(null),p(null),w(null)},[e]);const I="multiple_choice"===r.answerType?null!==h:d.trim().length>0;return t.jsxs("div",{className:Ie,children:[t.jsxs("div",{className:ze,children:[t.jsx("div",{className:De,children:"Translate this sentence:"}),t.jsx("div",{className:Pe,ref:b,children:v&&r.showWordHints?t.jsxs("div",{className:$e,children:[t.jsx("div",{className:Ee,children:f.map((e,s)=>{const n=S(e),i=L(e),r=C===s;return t.jsxs("span",{className:`${Be} ${i?He:Fe} ${r?We:""}`,onClick:()=>i&&M(s),children:[T(e),r&&n&&t.jsx("span",{className:qe,children:n})]},s)})}),t.jsx("div",{className:Re,children:"Tap words for hints"})]}):t.jsx("div",{className:Ae,children:x})})]}),t.jsxs("div",{className:Oe,children:[t.jsx("div",{className:De,children:"Your translation:"}),"free_text"===r.answerType?t.jsx("div",{className:Ue,children:t.jsx("textarea",{className:`${Ge} ${m?Ke:""}`,value:d,onChange:y,onKeyPress:N,placeholder:"Type your translation here...",disabled:c||!!m,rows:3})}):t.jsx("div",{className:Ve,children:g.map((e,s)=>t.jsxs("button",{className:`${Xe} ${h===e?Je:""} ${m?e===m.correctAnswer?Ye:h===e?Qe:"":""}`,onClick:()=>k(e),disabled:c||!!m,children:[t.jsx("span",{className:Ze,children:String.fromCharCode(65+s)}),t.jsx("span",{className:es,children:e})]},s))})]}),!m&&t.jsxs("div",{className:ss,children:["wait"===r.checkMode&&t.jsx(i,{variant:"primary",onClick:j,disabled:!I||c,className:ns,children:"Check Answer"}),l&&t.jsx(i,{variant:"secondary",onClick:l,disabled:c,className:ts,children:"Skip"})]}),m&&o&&t.jsxs("div",{className:is,children:[t.jsxs("div",{className:`${rs} ${m.isCorrect?Ye:Qe}`,children:[t.jsxs("div",{className:as,children:[m.accuracy,"% accuracy"]}),t.jsx("div",{className:ls,children:m.isCorrect?"Correct!":"Needs improvement"})]}),!m.isCorrect&&t.jsxs("div",{className:os,children:[t.jsx("div",{className:cs,children:"Correct answer:"}),t.jsx("div",{className:ds,children:m.correctAnswer})]}),m.wordMatches&&m.wordMatches.length>0&&t.jsxs("div",{className:us,children:[t.jsx("div",{className:hs,children:"Word analysis:"}),t.jsx("div",{className:_s,children:m.wordMatches.map((e,s)=>t.jsx("span",{className:`${ms} ${e.matched?ps:xs}`,title:e.similarity?`${Math.round(e.similarity)}% match`:void 0,children:e.word},s))})]}),m.suggestions&&m.suggestions.length>0&&t.jsxs("div",{className:gs,children:[t.jsx("div",{className:vs,children:"Alternative answers:"}),t.jsx("div",{className:fs,children:m.suggestions.map((e,s)=>t.jsx("div",{className:js,children:e},s))})]})]})]})},ys={unit:{a:"character",b:"space",c:"space",d:void 0,e:void 0,f:void 0},preservePunctuation:!0},Ns=e=>{const s=e.charCodeAt(0);return s>=19968&&s<=40959||s>=13312&&s<=19903||s>=131072&&s<=173791||s>=173824&&s<=177983||s>=177984&&s<=178207||s>=12352&&s<=12447||s>=12448&&s<=12543||s>=44032&&s<=55215},Cs=(e,s)=>{const n=[];for(let t=0;t<e.length;t++){const i=e[t];!s&&/\s|[.,!?;:]/.test(i)||(/\s/.test(i)||n.push({text:i,start:t,end:t+1}))}return n},ws=(e,s)=>{const n=[];let t="",i=0;for(let r=0;r<=e.length;r++){const a=e[r];if(r===e.length||/\s/.test(a)){if(t){let e=t;s||(e=e.replace(/[.,!?;:]+$/,"")),e&&n.push({text:e,start:i,end:i+e.length}),t=""}i=r+1}else""===t&&(i=r),t+=a}return n},bs=(e,s)=>ws(e,s),Ts=(e,s)=>{const n=e.replace(/\s/g,"").length,t=Array.from(e).filter(Ns).length;return t>0&&t/n>.3?Cs(e,s):ws(e,s)},Ss=e=>{const s={a:[],b:[],c:[]};let n=0,t=0,i=0;return e.forEach(e=>{s.a.push({text:e.chinese,start:n,end:n+e.chinese.length}),n+=e.chinese.length,s.b.push({text:e.pinyin,start:t,end:t+e.pinyin.length}),t+=e.pinyin.length+1,s.c.push({text:e.english,start:i,end:i+e.english.length}),i+=e.english.length+1}),s},Ls=(e,s)=>{let n=e;const t={caseSensitive:!1,removeSpaces:!1,removePunctuation:!0,...s};return t.caseSensitive||(n=n.toLowerCase()),t.removePunctuation&&(n=n.replace(/[.,!?;:'"]/g,"")),n=t.removeSpaces?n.replace(/\s+/g,""):n.replace(/\s+/g," ").trim(),n},Ms=(e,s)=>{const n=e.length,t=s.length;if(0===n)return t;if(0===t)return n;const i=Array(n+1).fill(null).map(()=>Array(t+1).fill(0));for(let r=0;r<=n;r++)i[r][0]=r;for(let r=0;r<=t;r++)i[0][r]=r;for(let r=1;r<=n;r++)for(let n=1;n<=t;n++)e[r-1]===s[n-1]?i[r][n]=i[r-1][n-1]:i[r][n]=Math.min(i[r-1][n]+1,i[r][n-1]+1,i[r-1][n-1]+1);return i[n][t]},Is=e=>e.toLowerCase().replace(/[āáǎà]/g,"a").replace(/[ēéěè]/g,"e").replace(/[īíǐì]/g,"i").replace(/[ōóǒò]/g,"o").replace(/[ūúǔù]/g,"u").replace(/[ǖǘǚǜü]/g,"v").replace(/[ńňǹ]/g,"n").replace(/[ḿ]/g,"m").trim(),zs=(e,s,n=2,t="text")=>{if("pinyin"===t)return((e,s,n=1)=>{const t=Is(e),i=Is(s);return t===i||Ms(t,i)<=Math.min(n,Math.floor(.15*i.length))})(e,s,n);const i=Ls(e),r=Ls(s);if(i===r)return!0;return Ms(i,r)<=Math.min(n,Math.floor(.2*r.length))},Ds="_token_1oofa_1",Ps="_active_1oofa_17",As="_completed_1oofa_27",$s="_correct_1oofa_31",Es="_incorrect_1oofa_36",Bs="_tokenText_1oofa_41",Hs="_interactionArea_1oofa_46",Ws="_closeButton_1oofa_60",Fs="_freeTextInput_1oofa_92",qs="_textInput_1oofa_98",Rs="_multipleChoice_1oofa_114",Os="_mcOption_1oofa_120",Us="_answerDisplay_1oofa_130",Gs="_correctAnswer_1oofa_142",Ks="_feedbackCorrect_1oofa_147",Vs="_feedbackIncorrect_1oofa_152",Xs="_pinyinHint_1oofa_157",Js="_translationHint_1oofa_168",Ys=({isActive:e,isCompleted:s,onClick:r,onClose:a,onComplete:l,settings:o,sourceText:c,targetText:d,pinyinText:u,translationText:h})=>{const[_,m]=n.useState(""),[p,x]=n.useState(!1),[g,v]=n.useState(null),[f,j]=n.useState([]),[k,y]=n.useState({top:0,left:0}),N=n.useRef(null),C=e=>/^[.,!?;:()\[\]{}"'`~@#$%^&*+=\-\/\\|<>]+$/.test(e),w=(e,s)=>!(!C(e)||!C(s))||(!s||!s.trim());n.useEffect(()=>{if("multiple_choice"===o.answerType&&e&&d){if(w(c,d))return void(l&&setTimeout(()=>l(),500));const e=[d];let s=[];const n=o.translationDirection.to;if(/^\d+$/.test(d)){const e=parseInt(d);s=[(e-1).toString(),(e+1).toString(),(2*e).toString(),(e+10).toString(),Math.floor(e/2).toString()].filter(e=>e!==d&&parseInt(e)>=0)}else if("b"===n){const e=["ma","wo","ni","ta","de","shi","zai","you","ge","le","dao","shang","xia","lai","qu","hao","hen","dou","bu","mei","kan","shuo","zuo","chi","he","zou","pao","fei","kai","guan","da","xiao","gao","ai","pang","shou","kuai","man","xin","jiu","duo","shao","chang","duan","yuan","jin","li","wai","zhong","bian","qian","hou","zuo","you","dong","xi","nan","bei","bai","hei","hong","lu","huang","lan","zi","fen","hui","zong","cheng","qing"],n=[...e];e.forEach(e=>{e.includes("a")&&n.push(e.replace("a","ā"),e.replace("a","á"),e.replace("a","ǎ"),e.replace("a","à")),e.includes("e")&&n.push(e.replace("e","ē"),e.replace("e","é"),e.replace("e","ě"),e.replace("e","è")),e.includes("i")&&n.push(e.replace("i","ī"),e.replace("i","í"),e.replace("i","ǐ"),e.replace("i","ì")),e.includes("o")&&n.push(e.replace("o","ō"),e.replace("o","ó"),e.replace("o","ǒ"),e.replace("o","ò")),e.includes("u")&&n.push(e.replace("u","ū"),e.replace("u","ú"),e.replace("u","ǔ"),e.replace("u","ù"))}),s=n}else if("a"===n)s=["我","你","他","她","的","是","在","有","个","了","到","上","下","来","去","好","很","都","不","没","看","说","做","吃","喝","走","跑","飞","开","关","大","小","高","矮","胖","瘦","快","慢","新","旧","多","少","长","短","远","近","里","外","中","边","前","后","左","右","东","西","南","北","白","黑","红","绿","黄","蓝","紫","粉","灰","棕","橙","青"];else if(d.length<=2)s=["a","I","it","is","to","be","of","in","on","at","or","an","as","by","we","he","me","my","up","so"];else{const e=["I","you","he","she","it","we","they","me","him","her","us","them"],n=["is","are","was","were","have","has","had","do","does","did","will","can","could","would","should","make","take","give","get","go","come","see","know","think","want"],t=["good","bad","big","small","new","old","happy","sad","fast","slow","hot","cold","easy","hard","beautiful","ugly"],i=["the","a","an","this","that","these","those"],r=["in","on","at","to","for","with","from","by","about","into","through","during","before","after"],a=["very","really","quite","too","so","just","still","already","yet","even","only","also","never","always","sometimes"];s=e.includes(d.toLowerCase())?e:n.includes(d.toLowerCase())?n:t.includes(d.toLowerCase())?t:i.includes(d.toLowerCase())?i:r.includes(d.toLowerCase())?r:a.includes(d.toLowerCase())?a:[...n.slice(0,5),...t.slice(0,5),...e.slice(0,5)]}const t=s.filter(e=>e.toLowerCase()!==d.toLowerCase());for(;e.length<(o.optionsCount||4)&&t.length>0;){const s=Math.floor(Math.random()*t.length),n=t[s];e.includes(n)||(e.push(n),t.splice(s,1))}for(;e.length<(o.optionsCount||4);){let s;s="b"===n?["shénme","nǎlǐ","zěnme","shéi"]:"a"===n?["什么","哪里","怎么","谁"]:["something","nothing","anything","everything"];const t=s[e.length-1]||`option${e.length}`;e.includes(t)||e.push(t)}j(e.sort(()=>Math.random()-.5))}},[e,o,d,c,r]),n.useEffect(()=>{if(e&&N.current){const e=N.current.getBoundingClientRect(),s=window.innerHeight,n=window.innerWidth;let t=e.bottom+10,i=e.left+e.width/2;t+300>s&&(t=e.top-310);const r=250;i-r/2<10?i=r/2+10:i+r/2>n-10&&(i=n-r/2-10),y({top:t,left:i})}},[e]);const b=n.useCallback(e=>{if("live"===o.checkMode){const s="b"===o.translationDirection.to?"pinyin":"text",n=zs(e,d,2,s);v(n),x(!0)}else m(e)},[o,d,c]),T=n.useCallback(()=>{if(_){const e="b"===o.translationDirection.to?"pinyin":"text",s=zs(_,d,2,e);v(s),x(!0),s&&l&&setTimeout(()=>{l()},1e3)}else x(!0)},[_,d,o,l]),S=n.useCallback(e=>{const s="b"===o.translationDirection.to?"pinyin":"text",n=zs(e,d,2,s);v(n),x(!0),m(e),n&&l&&setTimeout(()=>{l()},1e3)},[d,o,l]);return t.jsxs("div",{ref:N,className:`\n        ${Ds}\n        ${e?Ps:""}\n        ${s?As:""}\n        ${!0===g?$s:""}\n        ${!1===g?Es:""}\n      `,onClick:r,children:[t.jsx("span",{className:Bs,children:c}),e&&!p&&!w(c,d)&&t.jsxs("div",{className:Hs,style:{position:"fixed",top:`${k.top}px`,left:`${k.left}px`,transform:"translateX(-50%)"},children:[t.jsx("button",{className:Ws,onClick:e=>{e.stopPropagation(),a&&a()},"aria-label":"Close input",title:"Close (to see translations below)",children:"✕"}),"free_text"===o.answerType?t.jsxs("div",{className:Fs,children:[t.jsx("input",{type:"text",value:_,onChange:e=>m(e.target.value),onKeyPress:e=>{"Enter"===e.key&&("live"===o.checkMode?b(_):T())},placeholder:"Type translation...",className:qs,autoFocus:!0}),"wait"===o.checkMode&&t.jsx(i,{size:"small",variant:"primary",onClick:T,disabled:!_,children:"Check"})]}):t.jsx("div",{className:Rs,children:f.map((e,s)=>t.jsx(i,{size:"small",variant:"secondary",onClick:()=>S(e),className:Os,children:e},s))})]}),p&&t.jsxs("div",{className:Us,children:[t.jsx("span",{className:Gs,children:d}),null!==g&&t.jsx("span",{className:g?Ks:Vs,children:g?"✓":"✗"})]}),u&&!e&&t.jsx("span",{className:Xs,children:u}),h&&!e&&t.jsx("span",{className:Js,children:h})]})},Qs="_container_14iex_3",Zs="_lineHeader_14iex_18",en="_lineNumber_14iex_28",sn="_translationDirection_14iex_42",nn="_alignmentBadge_14iex_48",tn="_lineContent_14iex_62",rn="_sideLabel_14iex_71",an="_sourceSide_14iex_106",ln="_tokens_14iex_110",on="_additionalSide_14iex_128",cn="_sideText_14iex_140",dn="_fullSentences_14iex_150",un="_fullSentence_14iex_150",hn=({line:e,deck:s,session:i,settings:r,onTokenClick:a,onTokenComplete:l})=>{const o=n.useMemo(()=>Me(e),[e]),c=n.useMemo(()=>o?function(e){return Le(e).map(e=>({...e,english:e.english.trim()||""}))}(e):[],[e,o]),d=n.useMemo(()=>{if(o)return null;const n=s.reading?.tokenization||{unit:{a:"character",b:"space",c:"space",d:void 0,e:void 0,f:void 0},preservePunctuation:!0};return((e,s)=>{const n=s||ys;if(e.wordAlignments&&e.wordAlignments.length>0)return Ss(e.wordAlignments);const t={},i=["a","b","c","d","e","f"];for(const r of i){const s=e[r];if(!s)continue;const i=n.unit[r];if(i)switch(i){case"character":t[r]=Cs(s,n.preservePunctuation);break;case"word":t[r]=ws(s,n.preservePunctuation);break;case"space":t[r]=bs(s,n.preservePunctuation);break;default:t[r]=Ts(s,n.preservePunctuation)}}return t})(e,n)},[e,s,o]),u=n.useMemo(()=>{if(o&&c.length>0){return c.map((e,s)=>({text:e.chinese,start:s,end:s+1}))}if(!d)return[];const e=r.translationDirection.from;return d[e]||[]},[o,c,d,r]),h=n.useMemo(()=>{if(o&&c.length>0){const e=r.translationDirection.to;return c.map((s,n)=>({text:"b"===e?s.pinyin:s.english,start:n,end:n+1}))}if(!d)return[];const e=r.translationDirection.to;return d[e]||[]},[o,c,d,r]),_=n.useMemo(()=>o&&c.length>0?c.map((e,s)=>({text:e.pinyin,start:s,end:s+1})):d&&d.b||[],[o,c,d]),m=n.useCallback(e=>{a(e)},[a]),p=n.useCallback(()=>{l()},[l]),x=n.useCallback(e=>{if(!h.length)return"";const s=h[e];return s?.text||""},[h]),g=n.useCallback(e=>{if(!_.length)return"";const s=_[e];return s?.text||""},[_]),v=n.useCallback(e=>{if(!s.reading?.sides){return{a:"Characters",b:"Pinyin",c:"English",d:"Side D",e:"Side E",f:"Side F"}[e]||e.toUpperCase()}return s.reading.sides[e]||e.toUpperCase()},[s]);return t.jsxs("div",{className:Qs,children:[t.jsxs("div",{className:Zs,children:[t.jsxs("span",{className:en,children:["Line ",i.currentLineIndex+1]}),t.jsxs("span",{className:sn,children:[v(r.translationDirection.from)," → ",v(r.translationDirection.to)]}),o&&t.jsx("span",{className:nn,children:"Word Aligned"})]}),t.jsxs("div",{className:tn,children:[t.jsxs("div",{className:an,children:[t.jsxs("div",{className:rn,children:[v(r.translationDirection.from),o&&t.jsx("span",{className:nn,children:"Word Aligned"})]}),t.jsx("div",{className:ln,children:u.map((e,s)=>t.jsx(Ys,{token:e,index:s,isActive:i.currentTokenIndex===s,isCompleted:!1,onClick:()=>m(s),onClose:()=>m(-1),onComplete:p,settings:r,sourceText:e.text,targetText:x(s),pinyinText:i.showPinyin?g(s):"",translationText:i.showTranslation?x(s):""},`${i.currentLineIndex}-${s}`))})]}),!o&&i.showPinyin&&e.b&&t.jsxs("div",{className:on,children:[t.jsx("div",{className:rn,children:"Pinyin"}),t.jsx("div",{className:cn,children:e.b})]}),!o&&i.showTranslation&&t.jsxs("div",{className:on,children:[t.jsx("div",{className:rn,children:v(r.translationDirection.to)}),t.jsx("div",{className:cn,children:e[r.translationDirection.to]||""})]}),o&&(i.showPinyin||i.showTranslation)&&t.jsxs("div",{className:dn,children:[i.showPinyin&&e.b&&t.jsxs("div",{className:un,children:[t.jsx("div",{className:rn,children:"Full Pinyin"}),t.jsx("div",{className:cn,children:e.b})]}),i.showTranslation&&e.c&&t.jsxs("div",{className:un,children:[t.jsx("div",{className:rn,children:"Full Translation"}),t.jsx("div",{className:cn,children:e.c})]})]})]})]})},_n="_container_u8uif_1",mn="_sentenceMode_u8uif_9",pn="_lineHeader_u8uif_15",xn="_lineNumber_u8uif_31",gn="_translationDirection_u8uif_40",vn="_additionalContent_u8uif_46",fn="_additionalSide_u8uif_53",jn="_sideLabel_u8uif_64",kn="_sideText_u8uif_73",yn=({line:e,deck:s,session:i,settings:r,allLines:a,onAnswer:l,onTokenClick:o,onTokenComplete:c,onNext:d})=>{const u=n.useCallback(e=>{if(!s.reading?.sides){return{a:"Characters",b:"Pinyin",c:"English",d:"Side D",e:"Side E",f:"Side F"}[e]||e.toUpperCase()}return s.reading.sides[e]||e.toUpperCase()},[s]),h=n.useCallback(e=>{l&&l(e)},[l]),_=n.useMemo(()=>"sentence"===r.translationMode?t.jsxs("div",{className:mn,children:[t.jsxs("div",{className:pn,children:[t.jsxs("span",{className:xn,children:["Line ",i.currentLineIndex+1]}),t.jsxs("span",{className:gn,children:[u(r.translationDirection.from)," → ",u(r.translationDirection.to)]})]}),t.jsx(ks,{line:e,allLines:a,settings:r,onAnswer:h,showResult:!0}),(i.showPinyin||i.showTranslation)&&t.jsxs("div",{className:vn,children:[i.showPinyin&&e.b&&t.jsxs("div",{className:fn,children:[t.jsx("div",{className:jn,children:"Pinyin"}),t.jsx("div",{className:kn,children:e.b})]}),i.showTranslation&&e[r.translationDirection.to]&&t.jsxs("div",{className:fn,children:[t.jsx("div",{className:jn,children:u(r.translationDirection.to)}),t.jsx("div",{className:kn,children:e[r.translationDirection.to]})]})]})]}):t.jsx(hn,{line:e,deck:s,session:i,settings:r,onTokenClick:o||(()=>{}),onTokenComplete:c||(()=>{})}),[r.translationMode,e,s,i,r,a,u,h,o,c]);return t.jsx("div",{className:_n,children:_})},Nn="_container_31tms_1",Cn="_navigationControls_31tms_15",wn="_navButton_31tms_21",bn="_toggleControls_31tms_29",Tn="_toggleButton_31tms_36",Sn="_shortcuts_31tms_42",Ln="_shortcutHint_31tms_48",Mn=({canGoPrevious:e,canGoNext:s,showPinyin:n,showTranslation:r,onPrevious:a,onNext:l,onTogglePinyin:o,onToggleTranslation:c})=>t.jsxs("div",{className:Nn,children:[t.jsxs("div",{className:Cn,children:[t.jsxs(i,{variant:"secondary",size:"medium",onClick:a,disabled:!e,className:wn,children:[t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M19 12H5M5 12L12 19M5 12L12 5"})}),"Previous"]}),t.jsxs(i,{variant:"secondary",size:"medium",onClick:l,disabled:!s,className:wn,children:["Next",t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M5 12H19M19 12L12 5M19 12L12 19"})})]})]}),t.jsxs("div",{className:bn,children:[t.jsxs(i,{variant:n?"primary":"secondary",size:"small",onClick:o,className:Tn,children:[n?t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),t.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),"Pinyin (R)"]}),t.jsxs(i,{variant:r?"primary":"secondary",size:"small",onClick:c,className:Tn,children:[r?t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),t.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),"Translation (T)"]})]}),t.jsx("div",{className:Sn,children:t.jsx("span",{className:Ln,children:"Use ↑/↓ or J/K to navigate • R for pinyin • T for translation"})})]}),In="_container_bnqvl_1",zn="_stats_bnqvl_15",Dn="_stat_bnqvl_15",Pn="_statLabel_bnqvl_35",An="_statValue_bnqvl_42",$n="_correct_bnqvl_48",En="_incorrect_bnqvl_52",Bn="_progressBar_bnqvl_56",Hn="_progressFill_bnqvl_64",Wn=({currentLineIndex:e,totalLines:s,correctCount:n,incorrectCount:i})=>{const r=(e+1)/s*100,a=n+i>0?n/(n+i)*100:0;return t.jsxs("div",{className:In,children:[t.jsxs("div",{className:zn,children:[t.jsxs("div",{className:Dn,children:[t.jsx("span",{className:Pn,children:"Line"}),t.jsxs("span",{className:An,children:[e+1," / ",s]})]}),(n>0||i>0)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:Dn,children:[t.jsx("span",{className:Pn,children:"Correct"}),t.jsx("span",{className:`${An} ${$n}`,children:n})]}),t.jsxs("div",{className:Dn,children:[t.jsx("span",{className:Pn,children:"Incorrect"}),t.jsx("span",{className:`${An} ${En}`,children:i})]}),t.jsxs("div",{className:Dn,children:[t.jsx("span",{className:Pn,children:"Accuracy"}),t.jsxs("span",{className:An,children:[a.toFixed(0),"%"]})]})]})]}),t.jsx("div",{className:Bn,children:t.jsx("div",{className:Hn,style:{width:`${r}%`}})})]})},Fn="_container_10v6r_1",qn="_leftPanel_10v6r_18",Rn="_mainPanel_10v6r_47",On="_settingsButton_10v6r_58",Un="_readPage_10v6r_64",Gn="_errorContainer_10v6r_70",Kn="_backButton_10v6r_91",Vn="_sentenceControls_10v6r_107",Xn="_navButton_10v6r_115",Jn="_transcriptOnlyMessage_10v6r_152",Yn=()=>{const{deckId:e}=d(),s=u(),{currentDeck:r,isLoading:a,error:l,loadDeck:o}=h(),{session:c,settings:m,initSession:p,setCurrentDialogue:g,setCurrentLine:j,setCurrentToken:y,togglePinyin:N,toggleTranslation:C,recordAnswer:w,getProgress:b}=k(),[T,S]=n.useState(!1),[L,M]=n.useState(null),[I,z]=n.useState(null);n.useEffect(()=>{e&&o(e)},[e,o]),n.useEffect(()=>{e&&x(e).then(z)},[e]),n.useEffect(()=>{if(r?.reading&&e){const s=Object.keys(r.reading.dialogues);if(s.length>0){const n=b(e),t=n?.dialogueId||s[0];M(t),c||p(e,t)}}},[r,e,p,b]),n.useEffect(()=>{if(c&&e&&0===c.currentLineIndex&&0===c.currentTokenIndex){const s=b(e);s&&s.lineIndex>0&&(j(s.lineIndex),y(s.tokenIndex))}},[c?.currentDialogueId]);const D=n.useMemo(()=>r?.reading&&L?r.reading.dialogues[L]:null,[r,L]),P=n.useMemo(()=>D&&c?D.lines[c.currentLineIndex]:null,[D,c]),A=n.useMemo(()=>D?D.lines:[],[D]),$=n.useCallback(e=>{M(e),g(e),j(0),y(0)},[g,j,y]),E=n.useCallback(()=>{c&&c.currentLineIndex>0&&(j(c.currentLineIndex-1),y(0))},[c,j,y]),B=n.useCallback(()=>{c&&D&&c.currentLineIndex<D.lines.length-1&&(j(c.currentLineIndex+1),y(0))},[c,D,j,y]),H=n.useCallback(e=>{if(!c)return;const s=Date.now()-c.responseStartTime;w(e.isCorrect,s)},[c,w]);if(n.useEffect(()=>{const e=e=>{const s=e.target;if(!s||"INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName&&!s.isContentEditable)switch(e.key){case"ArrowUp":case"k":e.preventDefault(),E();break;case"ArrowDown":case"j":e.preventDefault(),B();break;case"r":e.preventDefault(),N();break;case"t":e.preventDefault(),C()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[E,B,N,C]),n.useEffect(()=>()=>{},[c,e]),a)return null;if(l||!r)return t.jsxs("div",{className:Gn,children:[t.jsx("h2",{children:"Unable to load deck"}),t.jsx("p",{children:"The deck could not be loaded. Please try again."}),t.jsx("button",{onClick:()=>s("/"),className:Kn,children:"Back to Home"})]});const W=r.reading&&Object.keys(r.reading.dialogues).length>0;return null===I?null:W||I?t.jsxs("div",{className:Un,children:[t.jsx(_,{title:r.metadata.deck_name,subtitle:"Read Mode",onBackClick:()=>s(`/deck/${e}`),backLabel:"Back to Deck",rightContent:t.jsx(i,{variant:"secondary",size:"small",onClick:()=>S(!0),className:On,children:t.jsx(f,{size:20})})}),t.jsxs("div",{className:Fn,children:[t.jsx("div",{className:qn,children:t.jsx(Y,{deck:r,selectedDialogueId:L,onSelectDialogue:$,progress:b(e||"")})}),t.jsx("div",{className:Rn,children:c&&D&&P?t.jsxs(t.Fragment,{children:[t.jsx(Wn,{currentLineIndex:c.currentLineIndex,totalLines:D.lines.length,correctCount:c.correctCount,incorrectCount:c.incorrectCount}),t.jsx(yn,{line:P,deck:r,session:c,settings:m,allLines:A,onAnswer:H,onNext:B,onTokenClick:e=>{y(e)},onTokenComplete:()=>{if(!c||!D)return;const e=c.currentTokenIndex+1,s=D.lines[c.currentLineIndex];e<(s.wordAlignments?s.wordAlignments.length:s.a?.length||0)?y(e):c.currentLineIndex<D.lines.length-1&&B()}}),"token"===m.translationMode&&t.jsx(Mn,{canGoPrevious:c.currentLineIndex>0,canGoNext:c.currentLineIndex<D.lines.length-1,showPinyin:c.showPinyin,showTranslation:c.showTranslation,onPrevious:E,onNext:B,onTogglePinyin:N,onToggleTranslation:C}),"sentence"===m.translationMode&&t.jsxs("div",{className:Vn,children:[t.jsx("button",{onClick:E,disabled:0===c.currentLineIndex,className:Xn,children:"← Previous Sentence"}),t.jsx("button",{onClick:B,disabled:c.currentLineIndex>=D.lines.length-1,className:Xn,children:"Next Sentence →"})]})]}):I&&!W?t.jsxs("div",{className:Jn,children:[t.jsx("h3",{children:"Transcript Reader"}),t.jsx("p",{children:"This deck has transcripts available for external TTS readers."}),t.jsx("p",{children:"Select a transcript from the sidebar to view and copy."})]}):null})]}),T&&t.jsx(v,{visible:T,onClose:()=>S(!1),mode:"read",deck:r,settings:m,onUpdateSettings:e=>{k.getState().updateSettings(e)}}),t.jsx(Ce,{})]}):t.jsxs("div",{className:Gn,children:[t.jsx("h2",{children:"No reading content available"}),t.jsx("p",{children:"This deck doesn't have any reading dialogues or transcripts. Please choose a different deck."}),t.jsx("button",{onClick:()=>s(`/deck/${e}`),className:Kn,children:"Back to Deck"})]})};export{Yn as default};
