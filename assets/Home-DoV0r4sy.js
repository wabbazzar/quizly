import{r as e,u as s,a,F as t,L as i,M as r,R as n,j as l,C as c,b as d,c as o,m,A as _,d as h,e as g,S as p}from"./index-CoElTYbf.js";import{u}from"./progressStore-CwmpBILf.js";import{u as x}from"./deckVisibilityStore-mfeGq4eu.js";import{h as y}from"./transcriptService-BCIO_PIi.js";import{M as k}from"./Modal-BFeOgvFJ.js";import{I as j}from"./Input-niKVvsjZ.js";import"./cardMasteryStore-DLoKfaPt.js";const b={enhancedDeckCard:"_enhancedDeckCard_sp0yg_2",progressRing:"_progressRing_sp0yg_23",progressSvg:"_progressSvg_sp0yg_31",progressBackground:"_progressBackground_sp0yg_37",progressFill:"_progressFill_sp0yg_42",progressText:"_progressText_sp0yg_47",cardHeader:"_cardHeader_sp0yg_55",deckName:"_deckName_sp0yg_63",difficultyBadge:"_difficultyBadge_sp0yg_72",beginner:"_beginner_sp0yg_81",intermediate:"_intermediate_sp0yg_86",advanced:"_advanced_sp0yg_91","beginner-to-intermediate":"_beginner-to-intermediate_sp0yg_96",subtitle:"_subtitle_sp0yg_102",description:"_description_sp0yg_111",stats:"_stats_sp0yg_123",statItem:"_statItem_sp0yg_130",statIcon:"_statIcon_sp0yg_138",statValue:"_statValue_sp0yg_143",statLabel:"_statLabel_sp0yg_148",tags:"_tags_sp0yg_153",tag:"_tag_sp0yg_153",modeStrip:"_modeStrip_sp0yg_169",modeButton:"_modeButton_sp0yg_177",flashcards:"_flashcards_sp0yg_202",learn:"_learn_sp0yg_207",match:"_match_sp0yg_212",test:"_test_sp0yg_217",modeIcon:"_modeIcon_sp0yg_228",modeLabel:"_modeLabel_sp0yg_235",modeProgress:"_modeProgress_sp0yg_242"},f=e=>{if(!e)return"Never";const s=(new Date).getTime()-e.getTime(),a=Math.floor(s/864e5);return 0===a?"Today":1===a?"Yesterday":a<7?`${a} days ago`:a<30?`${Math.floor(a/7)} weeks ago`:`${Math.floor(a/30)} months ago`},N=e.memo(({value:e})=>{const s=2*Math.PI*16,a=s-e/100*s;return l.jsxs("svg",{viewBox:"0 0 40 40",className:b.progressSvg,children:[l.jsx("circle",{cx:"20",cy:"20",r:16,className:b.progressBackground,strokeWidth:"2.5",fill:"none"}),l.jsx("circle",{cx:"20",cy:"20",r:16,className:b.progressFill,strokeWidth:"2.5",fill:"none",strokeDasharray:s,strokeDashoffset:a,strokeLinecap:"round"}),l.jsxs("text",{x:"20",y:"20",className:b.progressText,textAnchor:"middle",dy:"0.3em",children:[Math.round(e),"%"]})]})});N.displayName="CircularProgress";const v=({level:e})=>e?l.jsx("span",{className:`${b.difficultyBadge} ${b[e.replace("_","-")]}`,children:e.replace("_"," ")}):null,w=e.memo(({deck:m,progress:_={overall:0,byMode:{},totalCardsStudied:0,streakDays:0,masteredCards:0,totalCards:m.content.length},onModeSelect:h})=>{const[g,p]=e.useState(!1),u=s(),{showNotification:x}=a(),{metadata:k}=m;e.useEffect(()=>{y(m.id).then(p)},[m.id]);const j=[{id:"flashcards",label:"Flashcards",icon:t,color:"primary",description:"Classic flip cards",route:`/flashcards/${m.id}`},{id:"learn",label:"Learn",icon:i,color:"secondary",description:"Interactive questions",route:`/learn/${m.id}`},{id:"match",label:"Match",icon:r,color:"purple",description:"Memory game",route:`/match/${m.id}`},{id:"read",label:"Read",icon:n,color:"orange",description:"Structured reading practice",route:`/read/${m.id}`}];return l.jsxs("article",{className:b.enhancedDeckCard,onClick:()=>{u(`/deck/${m.id}`)},children:[_.overall>0&&l.jsx("div",{className:b.progressRing,children:l.jsx(N,{value:_.overall})}),l.jsxs("header",{className:b.cardHeader,children:[l.jsx("h3",{className:b.deckName,children:k.deck_name}),l.jsx(v,{level:k.difficulty})]}),k.deck_subtitle&&l.jsx("p",{className:b.subtitle,children:k.deck_subtitle}),k.description&&l.jsx("p",{className:b.description,children:k.description}),l.jsxs("div",{className:b.stats,children:[l.jsxs("div",{className:b.statItem,children:[l.jsx(c,{className:b.statIcon,size:16}),l.jsx("span",{className:b.statValue,children:_.masteredCards>0?`${_.masteredCards}/${k.card_count||m.content.length}`:k.card_count||m.content.length}),l.jsx("span",{className:b.statLabel,children:_.masteredCards>0?"mastered":"cards"})]}),k.available_levels&&k.available_levels.length>0&&l.jsxs("div",{className:b.statItem,children:[l.jsx(d,{className:b.statIcon,size:16}),l.jsx("span",{className:b.statValue,children:k.available_levels.length}),l.jsx("span",{className:b.statLabel,children:"levels"})]}),(g||m.reading&&Object.keys(m.reading.dialogues).length>0)&&l.jsxs("div",{className:b.statItem,children:[l.jsx(n,{className:b.statIcon,size:16}),l.jsx("span",{className:b.statLabel,children:"reading"})]}),l.jsxs("div",{className:b.statItem,children:[l.jsx(o,{className:b.statIcon,size:16}),l.jsx("span",{className:b.statValue,children:f(_.lastStudied)})]})]}),k.tags&&k.tags.length>0&&l.jsxs("div",{className:b.tags,children:[k.tags.slice(0,3).map(e=>l.jsx("span",{className:b.tag,children:e},e)),k.tags.length>3&&l.jsxs("span",{className:b.tag,children:["+",k.tags.length-3]})]}),l.jsx("div",{className:b.modeStrip,children:j.map(e=>l.jsxs("button",{className:`${b.modeButton} ${b[e.id]}`,onClick:s=>((e,s)=>{if(e.stopPropagation(),"read"===s.id&&!(m.reading&&Object.keys(m.reading.dialogues).length>0||g))return void x({message:"No reading content available for this deck",type:"info",duration:3e3});h?.(m.id,s.id),u(s.route)})(s,e),"aria-label":`Study ${k.deck_name} with ${e.label} mode`,title:e.description,children:[l.jsx(e.icon,{className:b.modeIcon}),l.jsx("span",{className:b.modeLabel,children:e.label})]},e.id))})]})});w.displayName="EnhancedDeckCard";const C="_card_aosga_1",S="_title_aosga_35",I="_subtitle_aosga_45",D="_readingIndicator_aosga_56",z="_readingIcon_aosga_65",L="_stats_aosga_70",$=e.memo(({deck:s,onSelect:a})=>{const[t,i]=e.useState(!1),r=s.metadata.card_count,c=s.metadata.abbreviated_title||s.metadata.deck_name,d=s.metadata.deck_subtitle,o=t||s.reading&&Object.keys(s.reading.dialogues).length>0;e.useEffect(()=>{y(s.id).then(i)},[s.id]);return l.jsxs(m.div,{className:C,onClick:()=>{a(s.id)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),a(s.id))},tabIndex:0,role:"button","aria-label":`${s.metadata.deck_name}. ${r} cards.`,whileTap:{scale:.98},children:[l.jsx("div",{className:S,children:c}),l.jsx("div",{className:I,children:d}),o&&l.jsxs("div",{className:D,children:[l.jsx(n,{className:z,size:14}),l.jsx("span",{children:"Reading"})]}),l.jsx("div",{className:L,children:l.jsxs("span",{children:[r," cards"]})})]})});$.displayName="CompactDeckCard";const M="_grid_tsvxm_1",E="_empty_tsvxm_15",T={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},B={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.2}}},q=e.memo(({decks:e,onSelectDeck:s})=>0===e.length?l.jsx("div",{className:E,children:l.jsx("p",{children:"No decks available"})}):l.jsx(m.div,{className:M,variants:T,initial:"hidden",animate:"visible",children:l.jsx(_,{mode:"popLayout",children:e.map(e=>l.jsx(m.div,{variants:B,layout:!0,children:l.jsx($,{deck:e,onSelect:s})},e.id))})}));q.displayName="CompactDeckGrid";const F="_section_hqwki_1",R="_header_hqwki_9",P="_name_hqwki_18",O="_count_hqwki_25",H=e.memo(({family:e,deckCount:s,children:a})=>l.jsxs("section",{className:F,children:[l.jsxs("div",{className:R,style:{borderLeftColor:e.color},children:[l.jsx("h3",{className:P,children:e.name}),l.jsxs("span",{className:O,children:[s," decks"]})]}),a]}));H.displayName="FamilySection";const V="_familySection_hf47x_1",A="_familyHeader_hf47x_9",W="_familyInfo_hf47x_20",Q="_familyName_hf47x_27",U="_familyCount_hf47x_34",G="_toggleAll_hf47x_40",K="_deckList_hf47x_58",X="_deckRow_hf47x_64",Y="_deckInfo_hf47x_78",J="_deckTitle_hf47x_84",Z="_deckSubtitle_hf47x_93",ee="_toggle_hf47x_40",se="_toggleInput_hf47x_109",ae="_toggleSlider_hf47x_116",te={id:"__other__",name:"Other",description:"Uncategorized decks",color:"#6b7280",sortOrder:9999},ie=e.memo(({checked:e,onChange:s,label:a})=>l.jsxs("label",{className:ee,children:[l.jsx("input",{type:"checkbox",className:se,checked:e,onChange:s,"aria-label":a}),l.jsx("span",{className:ae})]}));ie.displayName="ToggleSwitch";const re=e.memo(({isOpen:s,onClose:a,decks:t})=>{const{hiddenDeckIds:i,families:r,toggleDeckVisibility:n,hideAllInFamily:c,showAllInFamily:d}=x(),o=e.useMemo(()=>{const e=new Map;t.forEach(s=>{const a=s.metadata.family_id||"__other__",t=e.get(a)||[];t.push(s),e.set(a,t)});const s=[];r.forEach(a=>{const t=e.get(a.id);t&&t.length>0&&(s.push({family:a,decks:t}),e.delete(a.id))});const a=e.get("__other__");return a&&a.length>0&&s.push({family:te,decks:a}),s},[t,r]),m=e.useCallback((e,s,a)=>{a?c(e,s):d(e,s)},[c,d]);return l.jsx(k,{isOpen:s,onClose:a,title:"Manage Decks",size:"large",children:o.map(e=>{const s=e.family||te,a=e.decks.map(e=>e.id),t=e.decks.filter(e=>!i.includes(e.id)).length,r=t===e.decks.length;return l.jsxs("div",{className:V,children:[l.jsxs("div",{className:A,style:{borderLeftColor:s.color},children:[l.jsxs("div",{className:W,children:[l.jsx("h3",{className:Q,children:s.name}),l.jsxs("span",{className:U,children:[t,"/",e.decks.length," visible"]})]}),l.jsx("button",{className:G,onClick:()=>m(s.id,a,r),children:r?"Hide all":"Show all"})]}),l.jsx("ul",{className:K,children:e.decks.map(e=>{const s=!i.includes(e.id);return l.jsxs("li",{className:X,children:[l.jsxs("div",{className:Y,children:[l.jsx("span",{className:J,children:e.metadata.abbreviated_title||e.metadata.deck_name}),e.metadata.deck_subtitle&&l.jsx("span",{className:Z,children:e.metadata.deck_subtitle})]}),l.jsx(ie,{checked:s,onChange:()=>n(e.id),label:`Toggle visibility for ${e.metadata.deck_name}`})]},e.id)})})]},s.id)})})});re.displayName="DeckVisibilityModal";const ne="_card_p8xbu_1",le="_deckBadge_p8xbu_22",ce="_sides_p8xbu_37",de="_sideRow_p8xbu_43",oe="_sideLabel_p8xbu_50",me="_sideValue_p8xbu_60",_e=["side_a","side_b","side_c","side_d","side_e","side_f"],he=["Side A","Side B","Side C","Side D","Side E","Side F"],ge=e.memo(({card:e,deckId:s,deckName:a,sideLabels:t,availableSides:i,onNavigateToDeck:r})=>l.jsxs("li",{className:ne,onClick:()=>r(s),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r(s))},tabIndex:0,role:"button","aria-label":`${e.name} from ${a}`,children:[l.jsx("span",{className:le,children:a}),l.jsx("div",{className:ce,children:_e.slice(0,i).map((s,a)=>{const i=e[s];if(!i)return null;const r=t?.[s]||he[a];return l.jsxs("div",{className:de,children:[l.jsx("span",{className:oe,children:r}),l.jsx("span",{className:me,children:i})]},s)})})]}));ge.displayName="SearchResultCard";const pe="_container_gaka1_1",ue="_resultCount_gaka1_7",xe="_list_gaka1_13",ye="_emptyState_gaka1_22",ke="_emptyText_gaka1_30",je="_emptyQuery_gaka1_36",be=({results:e,query:s,onNavigateToDeck:a})=>0===e.length?l.jsx("div",{className:ye,children:l.jsxs("p",{className:ke,children:['No cards match "',l.jsx("span",{className:je,children:s}),'"']})}):l.jsxs("div",{className:pe,children:[l.jsxs("p",{className:ue,children:[e.length," card",1!==e.length?"s":""," found"]}),l.jsx("ul",{className:xe,children:e.map(({card:e,deck:s})=>l.jsx(ge,{card:e,deckId:s.id,deckName:s.metadata.abbreviated_title||s.metadata.deck_name,sideLabels:s.metadata.side_labels,availableSides:s.metadata.available_sides,onNavigateToDeck:a},`${s.id}-${e.idx}`))})]}),fe=({className:e,size:s=24})=>l.jsxs("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,"aria-hidden":"true",children:[l.jsx("line",{x1:"4",y1:"8",x2:"20",y2:"8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("line",{x1:"4",y1:"16",x2:"20",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"currentColor"})]});const Ne="_container_bk4rm_1",ve="_header_bk4rm_6",we="_iosSafeTop_bk4rm_18",Ce="_title_bk4rm_31",Se="_taglineSvg_bk4rm_40",Ie="_mascot_bk4rm_45",De="_main_bk4rm_75",ze="_deckSection_bk4rm_81",Le="_sectionHeader_bk4rm_85",$e="_sectionTitle_bk4rm_92",Me="_manageButton_bk4rm_99",Ee="_searchBar_bk4rm_119",Te="_clearButton_bk4rm_123",Be="_deckGrid_bk4rm_139",qe="_emptyState_bk4rm_146",Fe="_emptyHint_bk4rm_160",Re="_errorContainer_bk4rm_165",Pe="_retryButton_bk4rm_186",Oe={id:"__other__",name:"Other",description:"Uncategorized decks",color:"#6b7280",sortOrder:9999},He=()=>{const a=s(),{decks:t,isLoading:i,error:r,loadDecks:n,selectDeck:c}=h(),{getDeckProgress:d}=u(),{hiddenDeckIds:o,families:_,loadFamilies:y}=x(),k=e.useRef(null),b=function(){const[s,a]=e.useState(()=>"undefined"!=typeof window&&window.innerWidth<768);return e.useEffect(()=>{const e=()=>{a(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s}(),[f,N]=e.useState(!1),[v,C]=e.useState("");e.useEffect(()=>{const e=k.current;if(!e)return;const s=e.querySelector("img."+Ie);if(!s)return;const a=()=>{try{const a=s.getBoundingClientRect(),t=e.getBoundingClientRect(),i=Math.max(0,a.right-t.left+8);e.style.setProperty("--grad-start",`${Math.round(i)}px`),e.style.setProperty("--left-color","#5b82b0"),e.style.setProperty("--right-color",getComputedStyle(document.documentElement).getPropertyValue("--primary-main")||"#5b82b0")}catch{}};a();const t=()=>a();window.addEventListener("resize",t);const i=()=>{const t=()=>{try{const t=document.createElement("canvas");t.width=1,t.height=1;const i=t.getContext("2d");if(!i)return;i.drawImage(s,0,0,1,1);const r=i.getImageData(0,0,1,1).data,n=e=>e.toString(16).padStart(2,"0"),l=`#${n(r[0])}${n(r[1])}${n(r[2])}`;e.style.setProperty("--header-start",l),a()}catch{}};"requestIdleCallback"in window?window.requestIdleCallback(t):setTimeout(t,0)};return s.complete?i():s.addEventListener("load",i,{once:!0}),()=>{window.removeEventListener("resize",t)}},[]),e.useEffect(()=>{n(),y()},[n,y]);const S=e.useCallback((e,s)=>{c(e)},[c]),I=e.useCallback(e=>{c(e),a(`/deck/${e}`)},[c,a]),D=e.useMemo(()=>t.filter(e=>!o.includes(e.id)),[t,o]),z=e.useMemo(()=>{const e=new Map;D.forEach(s=>{const a=s.metadata.family_id||"__other__",t=e.get(a)||[];t.push(s),e.set(a,t)});const s=[];_.forEach(a=>{const t=e.get(a.id);t&&t.length>0&&(s.push({family:a,decks:t}),e.delete(a.id))});const a=e.get("__other__");return a&&a.length>0&&s.push({family:Oe,decks:a}),s},[D,_]),L=["side_a","side_b","side_c","side_d","side_e","side_f"],$=v.trim().length>0,M=e.useMemo(()=>{const e=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),s=e(v.trim());if(!s)return[];const a=[];for(const t of D)if(t.content)for(const i of t.content){const r=!!i.name&&e(i.name).includes(s),n=L.some(a=>{const t=i[a];return"string"==typeof t&&e(t).includes(s)});(r||n)&&a.push({card:i,deck:t})}return a},[v,D]),E=z.length>1;return i?null:r?l.jsxs("div",{className:Re,children:[l.jsx("h2",{children:"Error Loading Decks"}),l.jsx("p",{children:r}),l.jsx("button",{onClick:n,className:Pe,children:"Retry"})]}):l.jsxs("div",{className:Ne,children:[l.jsxs("header",{className:ve,ref:k,children:[l.jsx("div",{className:we,"aria-hidden":"true"}),l.jsx("img",{src:"/quizly/icons/mrquizly.png",alt:"Mr. Quizly",className:Ie,decoding:"async",loading:"eager"}),l.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[l.jsx("h1",{className:Ce,children:"Quizly"}),l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1600 220",role:"img","aria-labelledby":"quizlyCursiveHeaderTitle",style:{width:"100%",height:"auto",maxHeight:120,transform:"rotate(-6deg) skewX(-6deg)",transformOrigin:"center center",marginTop:8},className:Se,children:[l.jsx("title",{id:"quizlyCursiveHeaderTitle",children:"it's not a test! -- cursive header"}),l.jsx("style",{children:'\n                  :root{\n                    --quizly-blue:#4A90E2;\n                    --quizly-white:#FFFFFF;\n                  }\n                  text {\n                    font-family: "Pacifico", "Lobster", "Brush Script MT", "Segoe Script",\n                                 "Snell Roundhand", "Dancing Script", cursive;\n                    font-size: 94px;\n                    font-weight: 700;\n                    fill: var(--quizly-white);\n                    letter-spacing: 3px;\n                    paint-order: stroke fill;\n                    stroke: var(--quizly-white);\n                    stroke-width: 1px;\n                    dominant-baseline: middle;\n                    text-anchor: middle;\n                  }\n                  .tg-center { display: block; }\n                  .tg-right { display: none; text-anchor: end; }\n                  @media (max-width: 768px) {\n                    .tg-center { display: none; }\n                    .tg-right { display: block; }\n                    text { font-size: 172px; stroke-width: 1.6px; }\n                  }\n                '}),l.jsx("text",{className:"tg-center",x:"50%",y:"120",children:"it's not a test!"}),l.jsx("text",{className:"tg-right",x:"100%",y:"120",children:"it's not a test!"})]})]})]}),l.jsx("main",{className:De,children:l.jsxs("section",{className:ze,children:[l.jsxs("div",{className:Le,children:[l.jsx("h2",{className:$e,children:"Available Decks"}),l.jsx("button",{className:Me,onClick:()=>N(!0),"aria-label":"Manage deck visibility",children:l.jsx(fe,{size:20})})]}),l.jsx("div",{className:Ee,children:l.jsx(j,{variant:"outlined",fullWidth:!0,placeholder:"Search cards...",value:v,onChange:e=>C(e.target.value),startIcon:l.jsx(p,{size:18}),endIcon:v?l.jsx("button",{className:Te,onClick:()=>C(""),"aria-label":"Clear search",type:"button",children:l.jsx(g,{size:16})}):void 0,"aria-label":"Search cards across all decks"})}),$?l.jsx(be,{results:M,query:v.trim(),onNavigateToDeck:I}):0===D.length?l.jsxs(m.div,{className:qe,initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[l.jsx("p",{children:"No decks available"}),l.jsx("p",{className:Fe,children:t.length>0?"All decks are hidden. Use the manage button to show them.":"Import a deck to get started"})]}):z.map(e=>{const s=b?l.jsx(q,{decks:e.decks,onSelectDeck:I}):l.jsx("div",{className:Be,children:e.decks.map(e=>l.jsx(w,{deck:e,progress:d(e.id),onModeSelect:S},e.id))});return E?l.jsx(H,{family:e.family,deckCount:e.decks.length,children:s},e.family.id):l.jsx("div",{children:s},e.family.id)})]})}),l.jsx(re,{isOpen:f,onClose:()=>N(!1),decks:t})]})};export{He as default};
