import{h as e,p as t,r as s,j as i,z as a,m as n,A as r,u as o,a as d}from"./index-CoElTYbf.js";import{u as c}from"./cardMasteryStore-DLoKfaPt.js";import{S as l}from"./SharedModeHeader-CqmUSN6k.js";import"./Modal-BFeOgvFJ.js";import"./Input-niKVvsjZ.js";import{U as u}from"./UnifiedSettings-T8dbAibN.js";const m={gridSize:{rows:3,cols:4},matchType:"two_way",cardSides:[{sides:["side_a"],label:"Front",count:6},{sides:["side_b"],label:"Back",count:6}],enableTimer:!0,includeMastered:!1,enableAudio:!1,timerSeconds:0},h=(e,t,s)=>`${e}-${t}-${s}`,_=e=>{const t=[...e];for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}return t},g=e()(t((e,t)=>({session:null,startSession:(t,s=m)=>{const i=Date.now();e({session:{deckId:t,currentRound:1,startTime:i,pausedTime:0,isPaused:!1,grid:[],selectedCards:[],matchedPairs:[],missedCardIndices:[],roundStartTime:i,bestTime:null,settings:s}})},pauseSession:()=>{const{session:s}=t();s&&!s.isPaused&&e({session:{...s,isPaused:!0,pausedTime:Date.now()}})},resumeSession:()=>{const{session:s}=t();if(s&&s.isPaused){const t=Date.now()-s.pausedTime;e({session:{...s,isPaused:!1,pausedTime:0,roundStartTime:s.roundStartTime+t}})}},endSession:()=>{e({session:null})},selectCard:s=>{const{session:i}=t();if(!i||i.isPaused)return;const a=i.grid.find(e=>e.id===s);if(!a||a.isMatched)return;let n,r=[...i.grid];i.selectedCards.includes(s)?(n=i.selectedCards.filter(e=>e!==s),r=r.map(e=>e.id===s?{...e,isSelected:!1}:e)):(n=[...i.selectedCards,s],r=r.map(e=>e.id===s?{...e,isSelected:!0}:e)),e({session:{...i,selectedCards:n,grid:r}})},clearSelection:()=>{const{session:s}=t();if(!s)return;const i=s.grid.map(e=>({...e,isSelected:!1}));e({session:{...s,selectedCards:[],grid:i}})},processMatch:()=>{const{session:s}=t();if(!s||0===s.selectedCards.length)return{isMatch:!1};const i=s.grid.filter(e=>s.selectedCards.includes(e.id)),a=((e,t)=>{if(e.length<2)return{isValid:!1,matchedCards:[],matchType:t};const s=e[0].groupId,i=e.every(e=>e.groupId===s);let a=!1;switch(t){case"two_way":a=2===e.length;break;case"three_way":a=3===e.length;break;case"custom":a=e.length>=2}const n=i&&a,r=n?e.map(e=>e.id):[];return{isValid:n,matchedCards:r,matchType:t}})(i,s.settings.matchType);if(a.isValid){const t=s.grid.map(e=>a.matchedCards.includes(e.id)?{...e,isMatched:!0,isSelected:!1}:{...e,isSelected:!1}),i=[...s.matchedPairs,a.matchedCards];return e({session:{...s,grid:t,selectedCards:[],matchedPairs:i}}),{isMatch:!0,matchedCards:a.matchedCards}}return t().clearSelection(),{isMatch:!1}},startNewRound:s=>{const{session:i}=t();i&&e({session:{...i,currentRound:i.currentRound+1,roundStartTime:Date.now(),grid:[],selectedCards:[],matchedPairs:[],missedCardIndices:s||[]}})},generateGrid:(s,i)=>{const{session:a}=t();if(!a)return[];const n=((e,t,s=!1,i=[])=>{const{gridSize:a,matchType:n}=t,r=a.rows*a.cols;let o=s?e.filter((e,t)=>!i.includes(t)):e,d=2;"three_way"===n&&(d=3);const c=Math.floor(r/d);if(o.length<c){const e=c-o.length,t=_(o).slice(0,e);o=[...o,...t]}const l=_(o).slice(0,c),u=[];l.forEach(e=>{const s=`group-${e.idx}`;"two_way"===n?(u.push({id:h(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:h(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})):"three_way"===n?(u.push({id:h(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:h(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:h(e.idx,"side_c",2),cardIndex:e.idx,displaySides:["side_c"],content:(e.side_c||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})):t.cardSides&&t.cardSides.length>0?t.cardSides.forEach((t,i)=>{const a=t.sides[0],n=e[a]||"";u.push({id:h(e.idx,a,i),cardIndex:e.idx,displaySides:[a],content:n.trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})}):(u.push({id:h(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:h(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}))});const m=_(u);return m.forEach((e,t)=>{const s=Math.floor(t/a.cols),i=t%a.cols;e.position={row:s,col:i}}),m.slice(0,r)})(s,i);return e({session:{...a,grid:n}}),n},saveSession:()=>{},loadSession:s=>{const{session:i}=t();return i&&i.deckId===s?Date.now()-i.startTime>6048e5?(e({session:null}),null):i:null}}),{name:"match-session-store",storage:{getItem:e=>{const t=localStorage.getItem(e);if(!t)return null;try{const{state:e}=JSON.parse(t);return{state:e}}catch(s){return null}},setItem:(e,t)=>{try{const{state:s}=t;localStorage.setItem(e,JSON.stringify({state:s}))}catch(s){}},removeItem:e=>localStorage.removeItem(e)},partialize:e=>({session:e.session})})),p=e=>{const t=Math.floor(e/1e3),s=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},y=e()(t((e,t)=>({bestTimes:{},updateBestTime:(s,i,a,n,r)=>{const o=t().bestTimes[s];return!(o&&!(i<o.bestTimeMs))&&(e(e=>({bestTimes:{...e.bestTimes,[s]:{deckId:s,bestTimeMs:i,achievedAt:new Date,gridSize:{...a},matchType:n,totalMatches:r}}})),!0)},getBestTime:e=>t().bestTimes[e]||null,hasBestTime:e=>e in t().bestTimes,clearBestTime:t=>{e(e=>{const s={...e.bestTimes};return delete s[t],{bestTimes:s}})},clearAllBestTimes:()=>{e({bestTimes:{}})},getAllBestTimes:()=>Object.values(t().bestTimes),getDeckStats:e=>{const s=t().bestTimes[e]||null;return{bestTime:s,formattedTime:s?p(s.bestTimeMs):"--:--",hasRecord:!!s}}}),{name:"match-best-times-store",storage:{getItem:e=>{const t=localStorage.getItem(e);if(!t)return null;const s=JSON.parse(t);return s.state&&s.state.bestTimes&&Object.keys(s.state.bestTimes).forEach(e=>{const t=s.state.bestTimes[e];t.achievedAt&&(t.achievedAt=new Date(t.achievedAt))}),s},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{localStorage.removeItem(e)}}})),b={container:"_container_giqme_1",track:"_track_giqme_8",small:"_small_giqme_17",medium:"_medium_giqme_21",large:"_large_giqme_25",bar:"_bar_giqme_30",animated:"_animated_giqme_39","progress-animation":"_progress-animation_giqme_1",default:"_default_giqme_70",success:"_success_giqme_74",warning:"_warning_giqme_78",error:"_error_giqme_82",label:"_label_giqme_87"},x=s.memo(({value:e,max:t=100,variant:s="default",size:a="medium",showLabel:n=!1,animated:r=!0})=>{const o=Math.min(Math.max(e/t*100,0),100),d=[b.container,b[a]].filter(Boolean).join(" "),c=[b.bar,b[s],r&&b.animated].filter(Boolean).join(" ");return i.jsxs("div",{className:d,children:[i.jsx("div",{className:b.track,role:"progressbar","aria-valuenow":e,"aria-valuemin":0,"aria-valuemax":t,children:i.jsx("div",{className:c,style:{width:`${o}%`}})}),n&&i.jsxs("span",{className:b.label,children:[Math.round(o),"%"]})]})});x.displayName="ProgressBar";const f={container:"_container_axvbv_1",fullScreen:"_fullScreen_axvbv_11",content:"_content_axvbv_20",message:"_message_axvbv_29"},v=s.memo(({message:e="Loading...",fullScreen:t=!0})=>{const s=[f.container,t&&f.fullScreen].filter(Boolean).join(" ");return i.jsx("div",{className:s,role:"status","aria-live":"polite",children:i.jsxs("div",{className:f.content,children:[i.jsx(a,{size:"large",variant:"primary"}),i.jsx("p",{className:f.message,children:e})]})})});v.displayName="LoadingScreen";const w={type:"spring",stiffness:300,damping:30,mass:.8},C={unselected:{scale:1,borderColor:"var(--border-color)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",filter:"brightness(1)",y:0,transition:w},selected:{scale:1.02,borderColor:"var(--primary-main)",boxShadow:"0 6px 20px rgba(74, 144, 226, 0.25)",filter:"brightness(1.05)",y:-2,transition:w},hover:{scale:1.01,y:-1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",transition:w}},S={initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{duration:.3,staggerChildren:.05,delayChildren:.1}},exit:{opacity:0,scale:.95,transition:{duration:.2,staggerChildren:.03,staggerDirection:-1}}},k={initial:{opacity:0,backdropFilter:"blur(0px)"},animate:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.2,ease:"easeIn"}}},j=(e,t=!1)=>t?Object.entries(e).reduce((e,[t,s])=>{if("object"==typeof s&&null!==s){const i={...s};if("filter"in i&&delete i.filter,"boxShadow"in i&&Array.isArray(i.boxShadow)&&(i.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"),"scale"in i&&Array.isArray(i.scale)){const e=i.scale;i.scale=[e[0],e[e.length-1]]}e[t]=i}else e[t]=s;return e},{}):e,T=e=>Object.entries(e).reduce((e,[t,s])=>{if("object"==typeof s&&null!==s){const i={...s};"scale"in i&&(i.scale=1),"rotate"in i&&(i.rotate=0),"rotateY"in i&&(i.rotateY=0);const a=["opacity","x","y","backgroundColor","borderColor"];Object.keys(i).forEach(e=>{a.includes(e)||"transition"===e||delete i[e]}),i.transition&&(i.transition={duration:.1}),e[t]=i}else e[t]=s;return e},{}),N={card:"_card_1js0h_2",touchTarget:"_touchTarget_1js0h_29",matched:"_matched_1js0h_37",selected:"_selected_1js0h_60",content:"_content_1js0h_83",selectionIndicator:"_selectionIndicator_1js0h_98",matchIndicator:"_matchIndicator_1js0h_119"},M=s.memo(({card:e,isSelected:t,isMatched:a,isAnimating:r,isCurrentlyAnimating:o=!1,onSelect:d,position:c,isMobile:l=!1,prefersReducedMotion:u=!1})=>{const m=s.useCallback(()=>{a||r||d(e.id)},[e.id,a,r,d]),h=s.useCallback(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),m())},[m]),_=(()=>{let e=C;return u?e=T(e):l&&(e=j(e,!0)),e})(),g=o?a?"removing":"matching":a?"matched":t?"selected":"unselected";return i.jsxs(n.div,{className:`${N.card} ${t?N.selected:""} ${a?N.matched:""} ${o?N.animating:""}`,style:{gridRow:c.row+1,gridColumn:c.col+1},onClick:m,onKeyDown:h,role:"button",tabIndex:a?-1:0,"aria-label":`Match card: ${e.content}`,"aria-pressed":t,"aria-disabled":a,"data-testid":`match-card-${e.id}`,variants:_,initial:"unselected",animate:g,exit:"exit",whileHover:a||u?void 0:"hover",whileTap:a||u?void 0:{scale:.98},layout:!0,layoutId:e.id,children:[i.jsx("div",{className:N.content,children:e.content}),t&&i.jsx(n.div,{className:N.selectionIndicator,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{duration:.2}}),a&&i.jsx(n.div,{className:N.matchIndicator,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.1},children:"‚úì"}),i.jsx("div",{className:N.touchTarget})]})});M.displayName="MatchCard";const I="_grid_7b6bw_2",A=s.memo(({cards:e,onCardSelect:t,selectedCards:s,matchedCards:a,gridSize:o,isAnimating:d,animatingCards:c=[],isMobile:l=!1})=>{const u=new Set(a.flat()),m=window.matchMedia("(prefers-reduced-motion: reduce)").matches;let h=S;return m?h=T(S):l&&(h=j(S,!0)),i.jsx(n.div,{className:I,style:{gridTemplateRows:`repeat(${o.rows}, 1fr)`,gridTemplateColumns:`repeat(${o.cols}, 1fr)`},variants:h,initial:"initial",animate:"animate",exit:"exit",role:"grid","aria-label":"Match game grid","data-testid":"match-grid",children:i.jsx(r,{mode:"popLayout",children:e.map(e=>i.jsx(M,{card:e,isSelected:s.includes(e.id),isMatched:u.has(e.id),isAnimating:d,isCurrentlyAnimating:c.includes(e.id),onSelect:t,position:e.position,isMobile:l,prefersReducedMotion:m},e.id))})})});A.displayName="MatchGrid";const B={sessionComplete:"_sessionComplete_ubk4w_1",container:"_container_ubk4w_14",header:"_header_ubk4w_25",emoji:"_emoji_ubk4w_30",title:"_title_ubk4w_36",excellent:"_excellent_ubk4w_43",great:"_great_ubk4w_47",good:"_good_ubk4w_51",fair:"_fair_ubk4w_55",subtitle:"_subtitle_ubk4w_59",resultsGrid:"_resultsGrid_ubk4w_66",resultCard:"_resultCard_ubk4w_73",resultValue:"_resultValue_ubk4w_89",resultLabel:"_resultLabel_ubk4w_96",achievementSection:"_achievementSection_ubk4w_104",missedSection:"_missedSection_ubk4w_105",achievementItem:"_achievementItem_ubk4w_121",missedItem:"_missedItem_ubk4w_122",achievementIcon:"_achievementIcon_ubk4w_129",missedIcon:"_missedIcon_ubk4w_130",newBest:"_newBest_ubk4w_139",pulse:"_pulse_ubk4w_1",review:"_review_ubk4w_143","gentle-bounce":"_gentle-bounce_ubk4w_1",achievementText:"_achievementText_ubk4w_147",missedText:"_missedText_ubk4w_148",actions:"_actions_ubk4w_154",actionButton:"_actionButton_ubk4w_160",primary:"_primary_ubk4w_176",secondary:"_secondary_ubk4w_186",tertiary:"_tertiary_ubk4w_197",keyHint:"_keyHint_ubk4w_208",motivationalMessage:"_motivationalMessage_ubk4w_227"},$=s.memo(({visible:e,results:t,onContinueWithMissed:a,onStartNewRound:r,onBackToDeck:d})=>{const c=o(),{updateBestTime:l,getBestTime:u}=y(),[m,h]=s.useState(!1),[_,g]=s.useState(null);if(s.useEffect(()=>{if(!t||!e)return;const s=u(t.deckId),i=l(t.deckId,t.totalTime,{rows:3,cols:4},"two_way",t.totalMatches);h(i),g(s?p(s.bestTimeMs):null)},[t,e,l,u]),s.useEffect(()=>{if(!e)return;const s=e=>{const s=e.target;s&&("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable)||("1"===e.key?(e.preventDefault(),t?.missedCardIndices&&t.missedCardIndices.length>0?a():r()):"2"===e.key?(e.preventDefault(),d()):"3"===e.key&&(e.preventDefault(),c("/")))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[e,t,a,r,d,c]),!e||!t)return null;const b=(()=>{const e=t.totalTime/t.totalMatches;return m?{message:"New Best Time!",emoji:"üèÜ",color:"excellent"}:e<3e3?{message:"Lightning Fast!",emoji:"‚ö°",color:"excellent"}:e<5e3?{message:"Great Speed!",emoji:"üåü",color:"great"}:e<8e3?{message:"Good Work!",emoji:"üëç",color:"good"}:{message:"Complete!",emoji:"üéâ",color:"fair"}})(),x=p(t.totalTime),f=t.missedCardIndices&&t.missedCardIndices.length>0;return i.jsx(n.div,{className:B.sessionComplete,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},"data-testid":"match-results",children:i.jsxs("div",{className:B.container,children:[i.jsxs("header",{className:B.header,children:[i.jsx(n.div,{className:B.emoji,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:b.emoji}),i.jsx("h1",{className:`${B.title} ${B[b.color]}`,children:b.message}),i.jsxs("p",{className:B.subtitle,children:["You completed Round ",t.roundNumber," of matching!"]})]}),i.jsxs("div",{className:B.resultsGrid,children:[i.jsxs(n.div,{className:B.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},children:[i.jsx("div",{className:B.resultValue,children:x}),i.jsx("div",{className:B.resultLabel,children:"Time"})]}),i.jsxs(n.div,{className:B.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:[i.jsx("div",{className:B.resultValue,children:t.totalMatches}),i.jsx("div",{className:B.resultLabel,children:"Matches"})]}),i.jsxs(n.div,{className:B.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},children:[i.jsx("div",{className:B.resultValue,children:t.roundNumber}),i.jsx("div",{className:B.resultLabel,children:"Round"})]}),_&&i.jsxs(n.div,{className:B.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},children:[i.jsx("div",{className:B.resultValue,children:m?_:p(u(t.deckId)?.bestTimeMs||0)}),i.jsx("div",{className:B.resultLabel,children:m?"Previous Best":"Your Best"})]})]}),m&&_&&i.jsx(n.div,{className:B.achievementSection,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.7},children:i.jsxs("div",{className:B.achievementItem,children:[i.jsx("span",{className:`${B.achievementIcon} ${B.newBest}`,children:"üèÜ"}),i.jsxs("span",{className:B.achievementText,children:["New personal best! You beat your previous time by"," ",i.jsx("strong",{children:p(u(t.deckId)?.bestTimeMs-t.totalTime)})]})]})}),f&&i.jsx(n.div,{className:B.missedSection,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.8},children:i.jsxs("div",{className:B.missedItem,children:[i.jsx("span",{className:`${B.missedIcon} ${B.review}`,children:"üìö"}),i.jsxs("span",{className:B.missedText,children:[i.jsx("strong",{children:t.missedCardIndices.length})," cards need more practice"]})]})}),i.jsxs(n.div,{className:B.actions,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.9},children:[f?i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`${B.actionButton} ${B.primary}`,onClick:a,"data-testid":"practice-missed-button",children:"Practice Missed Cards"}),i.jsx("button",{className:`${B.actionButton} ${B.secondary}`,onClick:r,"data-testid":"new-round-button",children:"New Full Round"})]}):i.jsx("button",{className:`${B.actionButton} ${B.primary}`,onClick:r,"data-testid":"play-again-button",children:"Play Again"}),i.jsx("button",{className:`${B.actionButton} ${B.secondary}`,onClick:d,"data-testid":"back-button",children:"Back to Deck"}),i.jsx("button",{className:`${B.actionButton} ${B.tertiary}`,onClick:()=>c("/"),"data-testid":"home-button",children:"Home"})]}),t.totalTime/t.totalMatches>8e3&&i.jsx(n.p,{className:B.motivationalMessage,initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:"Tip: Try to improve your speed with each round. The more you practice, the faster you'll get!"})]})})});$.displayName="MatchResults";const q={match_success:{frequency:523.25,duration:.3,type:"sine",volume:.6,envelope:{attack:.01,decay:.1,sustain:.3,release:.2}},match_failure:{frequency:146.83,duration:.2,type:"sawtooth",volume:.4,envelope:{attack:.01,decay:.05,sustain:.1,release:.05}},card_select:{frequency:659.25,duration:.1,type:"triangle",volume:.3,envelope:{attack:.01,decay:.02,sustain:.1,release:.05}},card_flip:{frequency:440,duration:.15,type:"square",volume:.25,envelope:{attack:.01,decay:.05,sustain:.05,release:.05}},game_complete:{frequency:783.99,duration:.8,type:"sine",volume:.8,envelope:{attack:.1,decay:.2,sustain:.4,release:.3}},timer_tick:{frequency:1e3,duration:.05,type:"square",volume:.2,envelope:{attack:.001,decay:.01,sustain:.01,release:.02}},button_click:{frequency:400,duration:.1,type:"triangle",volume:.3,envelope:{attack:.01,decay:.02,sustain:.02,release:.05}},notification:{frequency:800,duration:.2,type:"sine",volume:.5,envelope:{attack:.05,decay:.1,sustain:.05,release:.1}}};const P=new class{audioContext=null;audioPool=new Map;settings={enabled:!0,volume:.7,soundEffects:!0,backgroundMusic:!1};constructor(){this.initializeAudioContext()}async initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),"suspended"===this.audioContext.state&&(document.addEventListener("click",this.resumeAudioContext.bind(this),{once:!0}),document.addEventListener("touchstart",this.resumeAudioContext.bind(this),{once:!0}))}catch(e){this.audioContext=null}}async resumeAudioContext(){if(this.audioContext&&"suspended"===this.audioContext.state)try{await this.audioContext.resume()}catch(e){}}updateSettings(e){this.settings={...this.settings,...e}}getSettings(){return{...this.settings}}async playSound(e,t=1){if(this.settings.enabled&&this.settings.soundEffects&&this.audioContext)try{const s=q[e],i=Math.min(1,this.settings.volume*t*s.volume);await this.synthesizeAndPlay(s,i)}catch(s){}}async synthesizeAndPlay(e,t){if(!this.audioContext)return;const{frequency:s=440,duration:i,type:a,envelope:n}=e,r=this.audioContext,o=r.currentTime,d=r.createOscillator(),c=r.createGain();if(d.type=a,d.frequency.setValueAtTime(s,o),n){const{attack:e,decay:s,sustain:a,release:r}=n,d=t*a,l=o+e,u=l+s,m=o+i-r;c.gain.setValueAtTime(0,o),c.gain.linearRampToValueAtTime(t,l),c.gain.linearRampToValueAtTime(d,u),c.gain.setValueAtTime(d,m),c.gain.linearRampToValueAtTime(0,o+i)}else c.gain.setValueAtTime(t,o),c.gain.linearRampToValueAtTime(0,o+i);d.connect(c),c.connect(r.destination),d.start(o),d.stop(o+i),d.addEventListener("ended",()=>{d.disconnect(),c.disconnect()})}async playMatchSuccess(e=1){if(this.settings.enabled&&this.settings.soundEffects)try{const t=[523.25,659.25,783.99],s=[0,.1,.2];for(let i=0;i<t.length;i++)setTimeout(()=>{this.synthesizeAndPlay({frequency:t[i],duration:.4,type:"sine",volume:.6*e,envelope:{attack:.02,decay:.1,sustain:.4,release:.3}},this.settings.volume)},1e3*s[i])}catch(t){}}async playMatchFailure(){if(this.settings.enabled&&this.settings.soundEffects)try{await this.synthesizeAndPlay({frequency:220,duration:.3,type:"sawtooth",volume:.4,envelope:{attack:.01,decay:.1,sustain:.1,release:.2}},this.settings.volume)}catch(e){}}async playGameComplete(){if(this.settings.enabled&&this.settings.soundEffects)try{[{freq:523.25,delay:0},{freq:659.25,delay:.2},{freq:783.99,delay:.4},{freq:1046.5,delay:.6}].forEach(({freq:e,delay:t})=>{setTimeout(()=>{this.synthesizeAndPlay({frequency:e,duration:.5,type:"sine",volume:.8,envelope:{attack:.05,decay:.2,sustain:.5,release:.3}},this.settings.volume)},1e3*t)})}catch(e){}}vibrate(e=50){if("vibrate"in navigator&&this.settings.enabled)try{navigator.vibrate(e)}catch(t){}}async preload(){}cleanup(){this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null),this.audioPool.clear()}},E=(e=50)=>P.vibrate(e);"undefined"!=typeof window&&P.preload();const R="_container_1fbjo_2",z="_gameStats_1fbjo_12",D="_progressSection_1fbjo_22",L="_progressBar_1fbjo_29",V="_progressFill_1fbjo_36",O="_statsText_1fbjo_43",G="_gameControls_1fbjo_79",F="_clearButton_1fbjo_86",J="_resumeButton_1fbjo_87",H="_gridContainer_1fbjo_121",Y="_pausedOverlay_1fbjo_247",U="_pausedContent_1fbjo_257",W="_selectionFeedback_1fbjo_272",K=s.memo(({deck:e,onBackClick:t})=>{const a=o(),{getMasteredCards:h}=c(),{updateBestTime:_}=y(),{showNotification:p}=d(),{session:b,startSession:x,pauseSession:f,resumeSession:w,selectCard:C,clearSelection:S,processMatch:j,generateGrid:T,loadSession:N,startNewRound:M}=g(),[I,B]=s.useState(!1),[q,K]=s.useState(!1),[X,Q]=s.useState(null),[Z,ee]=s.useState(!1),[te,se]=s.useState([]),[ie,ae]=s.useState(!1),[ne,re]=s.useState(!1),oe=b?.settings.enableAudio??!1;s.useEffect(()=>{if(!e||I)return;const t=N(e.id);if(t){const e=t.grid.every(e=>e.isMatched);if(e&&t.grid.length>0){const e=Date.now()-t.roundStartTime,s={deckId:t.deckId,totalTime:e,bestTime:null,isNewBest:!1,totalMatches:t.matchedPairs.length,missedCardIndices:t.missedCardIndices,roundNumber:t.currentRound,startTime:t.roundStartTime,endTime:Date.now()};Q(s),K(!0),B(!0)}else B(!0)}else{const t=h(e.id),s={...m,includeMastered:0===t.length};x(e.id,s),setTimeout(()=>{T(e.content,s),B(!0)},100)}},[e,I,N,x,T,h]),s.useEffect(()=>{const e=()=>{const e=window.innerWidth<768||"ontouchstart"in window;re(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{var e;void 0!==b?.settings.enableAudio&&(e={enabled:b.settings.enableAudio,soundEffects:b.settings.enableAudio},P.updateSettings(e))},[b?.settings.enableAudio]);const de=s.useCallback(async e=>{if(!b||te.length>0||ie)return;oe&&(((e,t=1)=>{P.playSound(e,t)})("card_select",.8),E(30)),C(e);const t="three_way"===b.settings.matchType?3:2;b.selectedCards.length+1===t&&setTimeout(async()=>{const e=j();e.isMatch&&e.matchedCards?(oe&&(await((e=1)=>P.playMatchSuccess(e))(1.2),E([50,50,50])),p({message:"Match found! üéâ",type:"success",duration:1500}),se(e.matchedCards),setTimeout(()=>{se([]);const t=b.grid.filter(t=>!t.isMatched&&!e.matchedCards?.includes(t.id));0===t.length&&ce()},600)):(oe&&(await P.playMatchFailure(),E(100)),p({message:"No match! Try again.",type:"error",duration:1500}),setTimeout(()=>{S()},800))},150)},[b,C,j,S,te,ie,p]),ce=s.useCallback(async()=>{if(!b||ie)return;ae(!0),oe&&(await P.playGameComplete(),E([100,50,100,50,200]));const e=Date.now()-b.roundStartTime,t=Date.now(),s=_(b.deckId,e,b.settings.gridSize,b.settings.matchType,b.matchedPairs.length),i={deckId:b.deckId,totalTime:e,bestTime:null,isNewBest:s,totalMatches:b.matchedPairs.length,missedCardIndices:b.missedCardIndices,roundNumber:b.currentRound,startTime:b.roundStartTime,endTime:t};Q(i),ae(!1),K(!0)},[b,ie,_]),le=s.useCallback(()=>{b?.isPaused?w():f()},[b,f,w]),ue=s.useCallback(()=>{t?t():a(`/deck/${e.id}`)},[a,e.id,t]),me=s.useCallback(()=>{b&&X&&(K(!1),Q(null),M(X.missedCardIndices))},[b,X,M]),he=s.useCallback(()=>{b&&e&&(K(!1),Q(null),M(),setTimeout(()=>{T(e.content,b.settings)},100))},[b,e,M,T]),_e=s.useCallback(()=>{K(!1),Q(null)},[]),ge=s.useCallback(()=>{ee(!0)},[]),pe=s.useCallback(()=>{ee(!1)},[]),ye=s.useCallback(t=>{const s=t;if(!b)return;const i=b.settings.gridSize.rows!==s.gridSize.rows||b.settings.gridSize.cols!==s.gridSize.cols,a=JSON.stringify(b.settings.cardSides)!==JSON.stringify(s.cardSides);i||a?(b.settings=s,T(e.content,s)):b.settings=s},[b,e,T]),be=s.useMemo(()=>{if(!b||!b.grid.length)return{totalCards:0,matchedCards:0,progressPercentage:0,selectedCount:b?.selectedCards.length||0};const e=b.grid.length,t=b.grid.filter(e=>e.isMatched).length;return{totalCards:e,matchedCards:t,progressPercentage:t/e*100,selectedCount:b.selectedCards.length}},[b]),xe=s.useMemo(()=>b?b.matchedPairs:[],[b]);return I&&b?i.jsxs("div",{className:R,children:[i.jsx(l,{deckName:e.metadata.deck_name,currentCard:be.matchedCards,totalCards:be.totalCards,onBackClick:ue,onSettingsClick:ge,showSettings:!0,subtitle:b.currentRound>1?`Round ${b.currentRound}`:void 0}),i.jsxs("div",{className:z,children:[i.jsxs("div",{className:D,children:[i.jsx("div",{className:L,children:i.jsx(n.div,{className:V,initial:{width:0},animate:{width:`${be.progressPercentage}%`},transition:{duration:.3}})}),i.jsx("div",{className:O,children:i.jsxs("span",{children:[be.matchedCards," / ",be.totalCards," matched"]})})]}),i.jsx("div",{className:G,children:b.selectedCards.length>0&&i.jsx("button",{className:F,onClick:S,"aria-label":"Clear selection",children:"Clear Selection"})})]}),i.jsx("main",{className:H,children:i.jsx(r,{mode:"wait",children:b.isPaused?i.jsx(n.div,{className:Y,variants:k,initial:"initial",animate:"animate",exit:"exit",children:i.jsxs("div",{className:U,children:[i.jsx("h2",{children:"Game Paused"}),i.jsx("button",{className:J,onClick:le,children:"Resume Game"})]})},"paused"):i.jsx(A,{cards:b.grid,onCardSelect:de,selectedCards:b.selectedCards,matchedCards:xe,gridSize:b.settings.gridSize,isAnimating:te.length>0,animatingCards:te,isMobile:ne},"grid")})}),be.selectedCount>0&&i.jsxs(n.div,{className:W,initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},children:[be.selectedCount," card",be.selectedCount>1?"s":""," selected"]}),i.jsx($,{visible:q,results:X,onContinueWithMissed:me,onStartNewRound:he,onBackToDeck:ue,onClose:_e}),i.jsx(u,{visible:Z,onClose:pe,deck:e,mode:"match",settings:b?.settings||m,onUpdateSettings:ye})]}):i.jsx(v,{})});K.displayName="MatchContainer";const X={container:"_container_1b1xe_2",errorContainer:"_errorContainer_1b1xe_10",errorContent:"_errorContent_1b1xe_19",errorButton:"_errorButton_1b1xe_51"};export{K as M,X as s};
