import{e,p as s,j as t,m as r,r as a,A as n,c as i,u as c,b as d}from"./index-K5uqA-3n.js";import{u as o}from"./cardMasteryStore-z-5vmz49.js";import{u as l}from"./progressStore-DPupY7fl.js";import{u,U as m}from"./UnifiedSettings-HzgFl0jR.js";import{S as h}from"./SharedModeHeader-DRg3hh5Z.js";import"./SettingsIcon-BSlFCqwD.js";const _=["side_a"],f=["side_b"],g=6048e5,p=e()(s((e,s)=>({sessions:new Map,getSession:e=>{const t=s().sessions.get(e);if(t)return Date.now()-t.lastAccessed>g?void s().clearSession(e):t},saveSession:s=>{e(e=>{const t=new Map(e.sessions);return t.set(s.deckId,{...s,lastAccessed:Date.now()}),{sessions:t}})},clearSession:s=>{e(e=>{const t=new Map(e.sessions);return t.delete(s),{sessions:t}})},clearOldSessions:()=>{e(e=>{const s=new Map,t=Date.now();return e.sessions.forEach((e,r)=>{t-e.lastAccessed<=g&&s.set(r,e)}),{sessions:s}})},startNewRound:(e,t)=>{const r=s().getSession(e),a={deckId:e,currentCardIndex:0,progress:{},frontSides:r?.frontSides||_,backSides:r?.backSides||f,lastAccessed:Date.now(),roundNumber:(r?.roundNumber||0)+1,cardOrder:Array.from({length:t},(e,s)=>s),startTime:Date.now(),isMissedCardsRound:!1,progressionMode:r?.progressionMode||"shuffle",includeMastered:void 0===r?.includeMastered||r.includeMastered};return s().saveSession(a),a},startMissedCardsRound:(e,t)=>{const r=s().getSession(e),a=[...t].sort(()=>Math.random()-.5),n={deckId:e,currentCardIndex:0,progress:{},frontSides:r?.frontSides||_,backSides:r?.backSides||f,lastAccessed:Date.now(),roundNumber:(r?.roundNumber||0)+1,cardOrder:a,startTime:Date.now(),isMissedCardsRound:!0,progressionMode:r?.progressionMode||"shuffle",includeMastered:void 0===r?.includeMastered||r.includeMastered};return s().saveSession(n),n},getMissedCardIndices:e=>{const s=[];return e.isMissedCardsRound?e.cardOrder.forEach((t,r)=>{"incorrect"!==e.progress[r]&&e.progress[r]||s.push(t)}):Object.entries(e.progress).forEach(([e,t])=>{"incorrect"===t&&s.push(parseInt(e))}),s}}),{name:"flashcard-session-store",storage:{getItem:e=>{const s=localStorage.getItem(e);if(!s)return null;const{state:t}=JSON.parse(s);return{state:{...t,sessions:new Map(t.sessions||[])}}},setItem:(e,s)=>{const{state:t}=s,r={state:{...t,sessions:Array.from(t.sessions.entries())}};localStorage.setItem(e,JSON.stringify(r))},removeItem:e=>localStorage.removeItem(e)}})),b="_cardContainer_i21pm_1",v="_card_i21pm_1",N="_cardFace_i21pm_17",j="_cardFront_i21pm_33",x="_cardBack_i21pm_37",C="_cardContent_i21pm_43",S="_contentItem_i21pm_53",k="_text_i21pm_76",M="_level_i21pm_90",w=({card:e,isFlipped:s,onFlip:a,frontSides:n=["side_a"],backSides:i=["side_b"]})=>{const c=n.filter(s=>e[s]).map(s=>({content:e[s]})),d=i.filter(s=>e[s]).map(s=>({content:e[s]}));return t.jsx("div",{className:b,onClick:a,children:t.jsxs(r.div,{className:v,animate:{rotateY:s?180:0},transition:{duration:.6,type:"spring",stiffness:100},style:{transformStyle:"preserve-3d"},children:[t.jsxs("div",{className:`${N} ${j}`,children:[t.jsx("div",{className:C,children:c.map((e,s)=>t.jsx("div",{className:S,children:t.jsx("div",{className:k,children:e.content})},s))}),e.level&&t.jsxs("div",{className:M,children:["Level ",e.level]})]}),t.jsxs("div",{className:`${N} ${x}`,children:[t.jsx("div",{className:C,children:d.map((e,s)=>t.jsx("div",{className:S,children:t.jsx("div",{className:k,children:e.content})},s))}),e.level&&t.jsxs("div",{className:M,children:["Level ",e.level]})]})]})})},y="_overlay_a7afi_2",I="_modal_a7afi_14",$="_performanceHeader_a7afi_31",D="_performanceEmoji_a7afi_36",R="_performanceMessage_a7afi_52",A="_roundMessage_a7afi_59",T="_mainScore_a7afi_67",E="_accuracyDisplay_a7afi_72",O="_accuracyNumber_a7afi_79",B="_accuracyPercent_a7afi_86",F="_accuracyLabel_a7afi_93",L="_statsGrid_a7afi_100",P="_statCard_a7afi_107",U="_statValue_a7afi_114",W="_statLabel_a7afi_121",G="_roundInfo_a7afi_127",H="_roundBadge_a7afi_136",Y="_missedCardsInfo_a7afi_145",J="_actionButtons_a7afi_157",X="_actionButton_a7afi_157",q="_primaryButton_a7afi_178",K="_secondaryButton_a7afi_194",V="_tertiaryButton_a7afi_209",z=({visible:e,results:s,onContinueWithMissed:i,onStartNewRound:c,onBackToDeck:d,onClose:o})=>{const l=s?Math.round(s.accuracy):0,u=s?s.endTime-s.startTime:0,m=Math.round(u/1e3),h=Math.floor(m/60),_=m%60,f=!!s&&s.missedCardIndices.length>0;return a.useEffect(()=>{if(!e||!s)return;const t=e=>{const t=e.target;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable))return;const r=s.missedCardIndices.length>0;"1"===e.key?(e.preventDefault(),r?i():c()):"2"===e.key&&r?(e.preventDefault(),c()):"3"===e.key&&(e.preventDefault(),d())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,s,i,c,d]),s?t.jsx(n,{children:e&&t.jsxs(t.Fragment,{children:[t.jsx(r.div,{className:y,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o}),t.jsxs(r.div,{className:I,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},children:[t.jsxs("div",{className:$,children:[t.jsx("div",{className:D,children:100===l?"🏆":l>=90?"🌟":l>=75?"✨":l>=60?"👍":"💪"}),t.jsx("h2",{className:R,children:100===l?"Perfect Round!":l>=90?"Outstanding!":l>=75?"Great job!":l>=60?"Good effort!":"Keep practicing!"}),t.jsx("p",{className:A,children:s?1===s.roundNumber?f?`You completed Round ${s.roundNumber} with ${s.incorrectCards} card${1===s.incorrectCards?"":"s"} to review.`:`You completed Round ${s.roundNumber} perfectly!`:f?`Round ${s.roundNumber} complete! ${s.incorrectCards} card${1===s.incorrectCards?"":"s"} still need review.`:`Round ${s.roundNumber} complete! All cards mastered!`:""})]}),t.jsxs("div",{className:T,children:[t.jsxs("div",{className:E,children:[t.jsx("span",{className:O,children:l}),t.jsx("span",{className:B,children:"%"})]}),t.jsx("p",{className:F,children:"Accuracy"})]}),t.jsxs("div",{className:L,children:[t.jsxs("div",{className:P,children:[t.jsx("div",{className:U,children:s.correctCards}),t.jsx("div",{className:W,children:"Correct"})]}),t.jsxs("div",{className:P,children:[t.jsx("div",{className:U,children:s.incorrectCards}),t.jsx("div",{className:W,children:"Incorrect"})]}),t.jsxs("div",{className:P,children:[t.jsx("div",{className:U,children:s.totalCards}),t.jsx("div",{className:W,children:"Total Cards"})]}),t.jsxs("div",{className:P,children:[t.jsxs("div",{className:U,children:[h,":",_.toString().padStart(2,"0")]}),t.jsx("div",{className:W,children:"Time"})]})]}),t.jsxs("div",{className:G,children:[t.jsxs("div",{className:H,children:["Round ",s.roundNumber]}),f&&t.jsxs("div",{className:Y,children:[s.incorrectCards," card",1===s.incorrectCards?"":"s"," to review"]})]}),t.jsxs("div",{className:J,children:[f?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:i,className:`${X} ${q}`,title:"Press 1 to continue",children:["Continue with Missed Cards (",s.incorrectCards,")"]}),t.jsx("button",{onClick:c,className:`${X} ${K}`,title:"Press 2 to start again",children:"Start Full Deck Again"})]}):t.jsx(t.Fragment,{children:t.jsx("button",{onClick:c,className:`${X} ${q}`,title:"Press 1 to start new round",children:"Start New Round"})}),t.jsx("button",{onClick:d,className:`${X} ${V}`,title:"Press 3 to go back",children:"Back to Deck"})]})]})]})}):null},Q="_container_rgbh6_1",Z="_progressSection_rgbh6_24",ee="_progressBar_rgbh6_30",se="_progressFill_rgbh6_38",te="_progressStats_rgbh6_44",re="_incorrectStat_rgbh6_51",ae="_correctStat_rgbh6_55",ne="_main_rgbh6_59",ie="_cardWrapper_rgbh6_71",ce="_swipeIndicator_rgbh6_87",de="_incorrect_rgbh6_51",oe="_correct_rgbh6_55",le="_controls_rgbh6_108",ue="_navButton_rgbh6_119",me="_actionButtons_rgbh6_144",he="_flipButton_rgbh6_149",_e="_markButton_rgbh6_150",fe=()=>{const{deckId:e}=i(),s=c(),{decks:g,activeDeck:b,selectDeck:v}=d(),{getSession:N,saveSession:j,startNewRound:x,startMissedCardsRound:C,getMissedCardIndices:S}=p(),{updateDeckProgress:k}=l(),{updateSettings:M}=u(),y=a.useRef(!0),[I,$]=a.useState(0),[D,R]=a.useState(!1),[A,T]=a.useState(_),[E,O]=a.useState(f),[B,F]=a.useState({}),[L,P]=a.useState(!1),[U,W]=a.useState(null),[G,H]=a.useState(1),[Y,J]=a.useState([]),[X,q]=a.useState(Date.now()),[K,V]=a.useState(!1),[fe,ge]=a.useState(!1),[pe,be]=a.useState(null),[ve,Ne]=a.useState("shuffle"),[je,xe]=a.useState(!0);a.useEffect(()=>{if(e){const t=g.find(s=>s.id===e);if(t){if(v(e),y.current){const s=N(e);if(s){$(s.currentCardIndex),F(s.progress),T(s.frontSides),O(s.backSides),H(s.roundNumber||1),q(s.startTime||Date.now()),V(s.isMissedCardsRound||!1),Ne(s.progressionMode||"shuffle");const r=void 0===s.includeMastered||s.includeMastered;if(xe(r),s.cardOrder&&!s.isMissedCardsRound){const{getMasteredCards:t}=o.getState(),a=t(e);if(!r&&a.length>0){const e=s.cardOrder.filter(e=>!a.includes(e));J(e.length>0?e:s.cardOrder)}else J(s.cardOrder)}else J(s.cardOrder||Array.from({length:t.content.length},(e,s)=>s))}else{const{getMasteredCards:s}=o.getState(),r=s(e);let a=Array.from({length:t.content.length},(e,s)=>s);r.length>0&&(a=a.filter(e=>!r.includes(e)),xe(!1));const n=[...a];for(let e=n.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[n[e],n[s]]=[n[s],n[e]]}J(n),q(Date.now())}y.current=!1}}else s("/")}},[e,g,v,s,N]),a.useEffect(()=>(document.body.classList.add("no-scroll"),()=>{document.body.classList.remove("no-scroll")}),[]),a.useEffect(()=>{e&&!y.current&&j({deckId:e,currentCardIndex:I,progress:B,frontSides:A,backSides:E,lastAccessed:Date.now(),roundNumber:G,cardOrder:Y,startTime:X,isMissedCardsRound:K,progressionMode:ve,includeMastered:je})},[e,I,B,A,E,j,G,Y,X,K,ve,je]);const Ce=a.useCallback((s,t,r=!1)=>{if(!s||!e)return[];let a=Array.from({length:s.content.length},(e,s)=>s);if(r){const{getMasteredCards:s}=o.getState(),t=s(e);a=a.filter(e=>!t.includes(e))}switch(t){case"sequential":default:return a;case"shuffle":const e=[...a];for(let s=e.length-1;s>0;s--){const t=Math.floor(Math.random()*(s+1));[e[s],e[t]]=[e[t],e[s]]}return e;case"level":return a.sort((e,t)=>{const r=s.content[e].level-s.content[t].level;return 0!==r?r:e-t})}},[e]),Se=a.useCallback(()=>{if(!b||!e)return;const s={deckId:e,currentCardIndex:I,progress:B,frontSides:A,backSides:E,lastAccessed:Date.now(),roundNumber:G,cardOrder:Y,startTime:X,isMissedCardsRound:K},t=S(s),r=Y.length>0?Y.length:b.content.length,a=Object.values(B).filter(e=>"correct"===e).length,n=Object.values(B).filter(e=>"incorrect"===e).length,i=a+n,c={deckId:e,totalCards:r,correctCards:a,incorrectCards:n,accuracy:i>0?a/i*100:0,roundNumber:G,isComplete:0===n,missedCardIndices:t,startTime:X,endTime:Date.now()};be(c),ge(!0),e&&k(e,"flashcards",i,a,i)},[b,e,I,B,A,E,G,Y,X,K,S,k]),ke=a.useCallback(()=>{if(!b)return;const e=Y.length>0?Y.length:b.content.length;I<e-1?($(e=>e+1),R(!1)):Se()},[b,I,K,Y,Se]),Me=a.useCallback(()=>{I>0&&($(e=>e-1),R(!1))},[I]),we=a.useCallback(()=>{R(e=>!e)},[]),ye=a.useCallback(e=>{F(s=>({...s,[I]:e})),W("correct"===e?"right":"left"),setTimeout(()=>{ke(),W(null)},400)},[I,ke]),Ie=a.useCallback(()=>{if(!pe||!e||!b)return;const s=pe.missedCardIndices;let t;if("shuffle"===ve){t=[...s];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}else t="level"===ve?[...s].sort((e,s)=>{const t=b.content[e].level-b.content[s].level;return 0!==t?t:e-s}):s;const r=C(e,t);$(0),R(!1),F({}),H(r.roundNumber),J(t),q(r.startTime),V(!0),ge(!1),be(null)},[pe,e,b,C,ve]),$e=a.useCallback(()=>{if(!e||!b)return;const s=x(e,b.content.length),t=Ce(b,ve,!je);$(0),R(!1),F({}),H(s.roundNumber),J(t),q(s.startTime),V(!1),ge(!1),be(null)},[e,b,x,Ce,ve,je]),De=a.useCallback(()=>{s(`/deck/${e}`)},[s,e]),Re=a.useCallback((e,s)=>{Math.abs(s.offset.x)>100&&(s.offset.x>0?ye("correct"):ye("incorrect"))},[ye]),Ae=a.useCallback(s=>{const t=s.frontSides||A,r=s.backSides||E,a=s.progressionMode||ve,n=void 0!==s.includeMastered?s.includeMastered:je;T(t),O(r),R(!1);if((a!==ve||n!==je)&&b&&!K){Ne(a),xe(n);const e=Ce(b,a,!n);J(e),$(0),F({})}else Ne(a),xe(n);e&&M(e,"flashcards",s)},[ve,je,b,K,Ce,A,E,e,M]),Te=a.useCallback(e=>{const s=e.target;if(!s||"INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName&&!s.isContentEditable)switch(e.key){case" ":e.preventDefault(),we();break;case"ArrowRight":ke();break;case"ArrowLeft":Me();break;case"1":ye("incorrect");break;case"2":ye("correct")}},[we,ke,Me,ye]);if(a.useEffect(()=>(window.addEventListener("keydown",Te),()=>window.removeEventListener("keydown",Te)),[Te]),!b)return null;const Ee=Y.length>0?Y[I]:I,Oe=b.content[Ee],Be=Y.length>0?Y.length:b.content.length,Fe=Object.keys(B).length/Be*100,Le=Object.values(B).filter(e=>"correct"===e).length,Pe=Object.values(B).filter(e=>"incorrect"===e).length;return t.jsxs("div",{className:Q,children:[t.jsx(h,{deckName:b.metadata.deck_name,currentCard:I+1,totalCards:Be,onBackClick:()=>{s(`/deck/${e}`)},onSettingsClick:()=>P(!0),showSettings:!0,subtitle:[K?"Review":null,G>1?`Round ${G}`:null].filter(Boolean).join(" ")}),t.jsxs("div",{className:Z,children:[t.jsx("div",{className:ee,children:t.jsx("div",{className:se,style:{width:`${Fe}%`}})}),t.jsxs("div",{className:te,children:[t.jsxs("span",{className:re,children:["✗ ",Pe]}),t.jsxs("span",{className:ae,children:["✓ ",Le]})]})]}),t.jsx("main",{className:ne,children:t.jsx(n,{mode:"wait",children:t.jsxs(r.div,{className:ie,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:Re,initial:{y:window.innerHeight,opacity:0},animate:{y:0,opacity:1,x:"right"===U?window.innerWidth:"left"===U?-window.innerWidth:0,rotate:"right"===U?20:"left"===U?-20:0},exit:{opacity:0,transition:{duration:.2}},transition:{type:"spring",stiffness:300,damping:30},children:[t.jsx(w,{card:Oe,isFlipped:D,onFlip:we,frontSides:A,backSides:E}),t.jsx("div",{className:`${ce} ${de}`,style:{opacity:"left"===U?1:0},children:"✗"}),t.jsx("div",{className:`${ce} ${oe}`,style:{opacity:"right"===U?1:0},children:"✓"})]},I)})}),t.jsxs("div",{className:le,children:[t.jsx("button",{className:ue,onClick:Me,disabled:0===I,"aria-label":"Previous card",children:"←"}),t.jsxs("div",{className:me,children:[t.jsx("button",{className:`${_e} ${de}`,onClick:()=>ye("incorrect"),"aria-label":"Mark as incorrect",children:"✗ Incorrect"}),t.jsx("button",{className:he,onClick:we,"aria-label":"Flip card",children:"Flip"}),t.jsx("button",{className:`${_e} ${oe}`,onClick:()=>ye("correct"),"aria-label":"Mark as correct",children:"✓ Correct"})]}),t.jsx("button",{className:ue,onClick:ke,disabled:I===Be-1,"aria-label":"Next card",children:"→"})]}),t.jsx(m,{visible:L,onClose:()=>P(!1),deck:b,mode:"flashcards",settings:{frontSides:A,backSides:E,progressionMode:ve,includeMastered:je,enableTimer:!1,timerSeconds:30,enableAudio:!1,groupSides:{}},onUpdateSettings:e=>{Ae(e)}}),t.jsx(z,{visible:fe,results:pe,onContinueWithMissed:Ie,onStartNewRound:$e,onBackToDeck:De,onClose:()=>ge(!1)})]})};export{fe as default};
