import{u as e,d as t,r as a,j as s,A as r,m as c}from"./index-CoElTYbf.js";import{u as i}from"./deckVisibilityStore-mfeGq4eu.js";import{s as n,F as l}from"./Flashcards.module-BzR01kDM.js";import{S as o}from"./SharedModeHeader-CqmUSN6k.js";import"./SettingsIcon-CGtfF6CW.js";const d=["side_a"],h=["side_b","side_c"],u=()=>{const u=e(),{decks:m,isLoading:b}=t(),{hiddenDeckIds:f}=i(),[g,k]=a.useState(0),[p,j]=a.useState(!1),[x]=a.useState(d),[N]=a.useState(h),[v,w]=a.useState({}),[y,S]=a.useState(null),[C,E]=a.useState([]),$=a.useRef(!0),A=a.useMemo(()=>{const e=[];return m.filter(e=>!f.includes(e.id)).forEach(t=>{t.content.forEach(a=>{e.push({...a,deckName:t.metadata.deck_name,deckId:t.id,abbreviatedTitle:t.metadata.abbreviated_title})})}),e},[m,f]);a.useEffect(()=>{if(A.length>0&&$.current){const e=Array.from({length:A.length},(e,t)=>t);for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}E(e),$.current=!1}},[A.length]),a.useEffect(()=>(document.body.classList.add("no-scroll"),()=>{document.body.classList.remove("no-scroll")}),[]);const B=a.useCallback(()=>{const e=C.length;g<e-1&&(k(e=>e+1),j(!1))},[g,C.length]),F=a.useCallback(()=>{g>0&&(k(e=>e-1),j(!1))},[g]),I=a.useCallback(()=>{j(e=>!e)},[]),M=a.useCallback(e=>{w(t=>({...t,[g]:e})),S("correct"===e?"right":"left"),setTimeout(()=>{B(),S(null)},400)},[g,B]),T=a.useCallback((e,t)=>{Math.abs(t.offset.x)>100&&(t.offset.x>0?M("correct"):M("incorrect"))},[M]),L=a.useCallback(e=>{const t=e.target;if(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)switch(e.key){case" ":e.preventDefault(),I();break;case"ArrowRight":B();break;case"ArrowLeft":F();break;case"1":M("incorrect");break;case"2":M("correct")}},[I,B,F,M]);if(a.useEffect(()=>(window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)),[L]),b||0===A.length)return null;const _=C.length>0?C[g]:g,D=A[_],O=C.length>0?C.length:A.length,R=Object.keys(v).length/O*100,W=Object.values(v).filter(e=>"correct"===e).length,H=Object.values(v).filter(e=>"incorrect"===e).length;return s.jsxs("div",{className:n.container,children:[s.jsx(o,{deckName:"All Decks",currentCard:g+1,totalCards:O,onBackClick:()=>u("/"),showSettings:!1,subtitle:D?D.deckName:void 0}),s.jsxs("div",{className:n.progressSection,children:[s.jsx("div",{className:n.progressBar,children:s.jsx("div",{className:n.progressFill,style:{width:`${R}%`}})}),s.jsxs("div",{className:n.progressStats,children:[s.jsxs("span",{className:n.incorrectStat,children:["✗ ",H]}),s.jsxs("span",{className:n.correctStat,children:["✓ ",W]})]})]}),s.jsx("main",{className:n.main,children:s.jsx(r,{mode:"wait",children:s.jsxs(c.div,{className:n.cardWrapper,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:T,style:{touchAction:"none"},initial:{y:window.innerHeight,opacity:0},animate:{y:0,opacity:1,x:"right"===y?window.innerWidth:"left"===y?-window.innerWidth:0,rotate:"right"===y?20:"left"===y?-20:0},exit:{opacity:0,transition:{duration:.2}},transition:{type:"spring",stiffness:300,damping:30},children:[s.jsx(l,{card:D,isFlipped:p,onFlip:I,frontSides:x,backSides:N,badgeText:D?.abbreviatedTitle}),s.jsx("div",{className:`${n.swipeIndicator} ${n.incorrect}`,style:{opacity:"left"===y?1:0},children:"✗"}),s.jsx("div",{className:`${n.swipeIndicator} ${n.correct}`,style:{opacity:"right"===y?1:0},children:"✓"})]},g)})}),s.jsxs("div",{className:n.controls,children:[s.jsx("button",{className:n.navButton,onClick:F,disabled:0===g,"aria-label":"Previous card",children:"←"}),s.jsxs("div",{className:n.actionButtons,children:[s.jsx("button",{className:`${n.markButton} ${n.incorrect}`,onClick:()=>M("incorrect"),"aria-label":"Mark as incorrect",children:"✗ Incorrect"}),s.jsx("button",{className:n.flipButton,onClick:I,"aria-label":"Flip card",children:"Flip"}),s.jsx("button",{className:`${n.markButton} ${n.correct}`,onClick:()=>M("correct"),"aria-label":"Mark as correct",children:"✓ Correct"})]}),s.jsx("button",{className:n.navButton,onClick:B,disabled:g===O-1,"aria-label":"Next card",children:"→"})]})]})};export{u as default};
