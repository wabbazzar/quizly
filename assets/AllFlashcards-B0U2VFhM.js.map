{"version":3,"file":"AllFlashcards-B0U2VFhM.js","sources":["../../src/pages/AllFlashcards.tsx"],"sourcesContent":["import { FC, useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { motion, PanInfo, AnimatePresence } from 'framer-motion';\nimport { useDeckStore } from '@/store/deckStore';\nimport { useDeckVisibilityStore } from '@/store/deckVisibilityStore';\nimport { Card } from '@/types';\nimport FlashCard from '@/components/FlashCard';\nimport { SharedModeHeader } from '@/components/common/SharedModeHeader';\nimport styles from './Flashcards.module.css';\n\n// Default side configuration\nconst DEFAULT_FRONT_SIDES = ['side_a'];\nconst DEFAULT_BACK_SIDES = ['side_b', 'side_c'];\n\nconst AllFlashcards: FC = () => {\n  const navigate = useNavigate();\n  const { decks, isLoading } = useDeckStore();\n  const { hiddenDeckIds } = useDeckVisibilityStore();\n\n  // State\n  const [currentCardIndex, setCurrentCardIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [frontSides] = useState(DEFAULT_FRONT_SIDES);\n  const [backSides] = useState(DEFAULT_BACK_SIDES);\n  const [progress, setProgress] = useState<{ [key: number]: 'correct' | 'incorrect' | null }>({});\n  const [swipeDirection, setSwipeDirection] = useState<'left' | 'right' | null>(null);\n  const [cardOrder, setCardOrder] = useState<number[]>([]);\n  const isInitialMount = useRef(true);\n\n  // Create aggregated cards from visible decks\n  const allCards = useMemo(() => {\n    const cards: Array<Card & { deckName: string; deckId: string; abbreviatedTitle?: string }> = [];\n    const visibleDecks = decks.filter(d => !hiddenDeckIds.includes(d.id));\n    visibleDecks.forEach((deck) => {\n      deck.content.forEach((card) => {\n        cards.push({\n          ...card,\n          deckName: deck.metadata.deck_name,\n          deckId: deck.id,\n          abbreviatedTitle: deck.metadata.abbreviated_title,\n        });\n      });\n    });\n    return cards;\n  }, [decks, hiddenDeckIds]);\n\n  // Initialize shuffled card order\n  useEffect(() => {\n    if (allCards.length > 0 && isInitialMount.current) {\n      const indices = Array.from({ length: allCards.length }, (_, i) => i);\n      // Fisher-Yates shuffle\n      for (let i = indices.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [indices[i], indices[j]] = [indices[j], indices[i]];\n      }\n      setCardOrder(indices);\n      isInitialMount.current = false;\n    }\n  }, [allCards.length]);\n\n  // Prevent body scrolling on mobile\n  useEffect(() => {\n    document.body.classList.add('no-scroll');\n    return () => {\n      document.body.classList.remove('no-scroll');\n    };\n  }, []);\n\n  const handleNext = useCallback(() => {\n    const totalCards = cardOrder.length;\n    if (currentCardIndex < totalCards - 1) {\n      setCurrentCardIndex((prev) => prev + 1);\n      setIsFlipped(false);\n    }\n  }, [currentCardIndex, cardOrder.length]);\n\n  const handlePrevious = useCallback(() => {\n    if (currentCardIndex > 0) {\n      setCurrentCardIndex((prev) => prev - 1);\n      setIsFlipped(false);\n    }\n  }, [currentCardIndex]);\n\n  const handleFlip = useCallback(() => {\n    setIsFlipped((prev) => !prev);\n  }, []);\n\n  const markCard = useCallback(\n    (status: 'correct' | 'incorrect') => {\n      setProgress((prev) => ({\n        ...prev,\n        [currentCardIndex]: status,\n      }));\n      setSwipeDirection(status === 'correct' ? 'right' : 'left');\n      setTimeout(() => {\n        handleNext();\n        setSwipeDirection(null);\n      }, 400);\n    },\n    [currentCardIndex, handleNext]\n  );\n\n  const handleDragEnd = useCallback(\n    (_event: MouseEvent | TouchEvent | PointerEvent, info: PanInfo) => {\n      const threshold = 100;\n      if (Math.abs(info.offset.x) > threshold) {\n        if (info.offset.x > 0) {\n          markCard('correct');\n        } else {\n          markCard('incorrect');\n        }\n      }\n    },\n    [markCard]\n  );\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement | null;\n      if (\n        target &&\n        (target.tagName === 'INPUT' ||\n          target.tagName === 'TEXTAREA' ||\n          (target as HTMLElement).isContentEditable)\n      ) {\n        return;\n      }\n\n      switch (e.key) {\n        case ' ':\n          e.preventDefault();\n          handleFlip();\n          break;\n        case 'ArrowRight':\n          handleNext();\n          break;\n        case 'ArrowLeft':\n          handlePrevious();\n          break;\n        case '1':\n          markCard('incorrect');\n          break;\n        case '2':\n          markCard('correct');\n          break;\n      }\n    },\n    [handleFlip, handleNext, handlePrevious, markCard]\n  );\n\n  useEffect(() => {\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [handleKeyDown]);\n\n  if (isLoading || allCards.length === 0) {\n    return null;\n  }\n\n  const actualCardIndex = cardOrder.length > 0 ? cardOrder[currentCardIndex] : currentCardIndex;\n  const currentCard = allCards[actualCardIndex];\n  const totalCards = cardOrder.length > 0 ? cardOrder.length : allCards.length;\n  const progressPercentage = (Object.keys(progress).length / totalCards) * 100;\n  const correctCount = Object.values(progress).filter((p) => p === 'correct').length;\n  const incorrectCount = Object.values(progress).filter((p) => p === 'incorrect').length;\n\n  return (\n    <div className={styles.container}>\n      <SharedModeHeader\n        deckName=\"All Decks\"\n        currentCard={currentCardIndex + 1}\n        totalCards={totalCards}\n        onBackClick={() => navigate('/')}\n        showSettings={false}\n        subtitle={currentCard ? currentCard.deckName : undefined}\n      />\n\n      <div className={styles.progressSection}>\n        <div className={styles.progressBar}>\n          <div className={styles.progressFill} style={{ width: `${progressPercentage}%` }} />\n        </div>\n        <div className={styles.progressStats}>\n          <span className={styles.incorrectStat}>✗ {incorrectCount}</span>\n          <span className={styles.correctStat}>✓ {correctCount}</span>\n        </div>\n      </div>\n\n      <main className={styles.main}>\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={currentCardIndex}\n            className={styles.cardWrapper}\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0 }}\n            dragElastic={1}\n            onDragEnd={handleDragEnd}\n            style={{ touchAction: 'none' }}\n            initial={{ y: window.innerHeight, opacity: 0 }}\n            animate={{\n              y: 0,\n              opacity: 1,\n              x:\n                swipeDirection === 'right'\n                  ? window.innerWidth\n                  : swipeDirection === 'left'\n                    ? -window.innerWidth\n                    : 0,\n              rotate: swipeDirection === 'right' ? 20 : swipeDirection === 'left' ? -20 : 0,\n            }}\n            exit={{\n              opacity: 0,\n              transition: { duration: 0.2 },\n            }}\n            transition={{\n              type: 'spring',\n              stiffness: 300,\n              damping: 30,\n            }}\n          >\n            <FlashCard\n              card={currentCard}\n              isFlipped={isFlipped}\n              onFlip={handleFlip}\n              frontSides={frontSides}\n              backSides={backSides}\n              badgeText={currentCard?.abbreviatedTitle}\n            />\n\n            <div\n              className={`${styles.swipeIndicator} ${styles.incorrect}`}\n              style={{ opacity: swipeDirection === 'left' ? 1 : 0 }}\n            >\n              ✗\n            </div>\n            <div\n              className={`${styles.swipeIndicator} ${styles.correct}`}\n              style={{ opacity: swipeDirection === 'right' ? 1 : 0 }}\n            >\n              ✓\n            </div>\n          </motion.div>\n        </AnimatePresence>\n      </main>\n\n      <div className={styles.controls}>\n        <button\n          className={styles.navButton}\n          onClick={handlePrevious}\n          disabled={currentCardIndex === 0}\n          aria-label=\"Previous card\"\n        >\n          ←\n        </button>\n\n        <div className={styles.actionButtons}>\n          <button\n            className={`${styles.markButton} ${styles.incorrect}`}\n            onClick={() => markCard('incorrect')}\n            aria-label=\"Mark as incorrect\"\n          >\n            ✗ Incorrect\n          </button>\n          <button className={styles.flipButton} onClick={handleFlip} aria-label=\"Flip card\">\n            Flip\n          </button>\n          <button\n            className={`${styles.markButton} ${styles.correct}`}\n            onClick={() => markCard('correct')}\n            aria-label=\"Mark as correct\"\n          >\n            ✓ Correct\n          </button>\n        </div>\n\n        <button\n          className={styles.navButton}\n          onClick={handleNext}\n          disabled={currentCardIndex === totalCards - 1}\n          aria-label=\"Next card\"\n        >\n          →\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default AllFlashcards;\n"],"names":["DEFAULT_FRONT_SIDES","DEFAULT_BACK_SIDES","AllFlashcards","navigate","useNavigate","decks","isLoading","useDeckStore","hiddenDeckIds","useDeckVisibilityStore","currentCardIndex","setCurrentCardIndex","useState","isFlipped","setIsFlipped","frontSides","backSides","progress","setProgress","swipeDirection","setSwipeDirection","cardOrder","setCardOrder","isInitialMount","useRef","allCards","useMemo","cards","filter","d","includes","id","forEach","deck","content","card","push","deckName","metadata","deck_name","deckId","abbreviatedTitle","abbreviated_title","useEffect","length","current","indices","Array","from","_","i","j","Math","floor","random","document","body","classList","add","remove","handleNext","useCallback","totalCards","prev","handlePrevious","handleFlip","markCard","status","setTimeout","handleDragEnd","_event","info","abs","offset","x","handleKeyDown","e","target","tagName","isContentEditable","key","preventDefault","window","addEventListener","removeEventListener","actualCardIndex","currentCard","progressPercentage","Object","keys","correctCount","values","p","incorrectCount","jsxs","className","styles","container","children","jsx","SharedModeHeader","onBackClick","showSettings","subtitle","progressSection","progressBar","progressFill","style","width","progressStats","incorrectStat","correctStat","main","AnimatePresence","mode","motion","div","cardWrapper","drag","dragConstraints","left","right","dragElastic","onDragEnd","touchAction","initial","y","innerHeight","opacity","animate","innerWidth","rotate","exit","transition","duration","type","stiffness","damping","FlashCard","onFlip","badgeText","swipeIndicator","incorrect","correct","controls","navButton","onClick","disabled","actionButtons","markButton","flipButton"],"mappings":"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"}