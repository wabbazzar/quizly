import{r as e,j as a,m as s,a as t,f as d,u as i,d as r,F as n,L as c,M as l,R as o}from"./index-CoElTYbf.js";import{u as m}from"./cardMasteryStore-DLoKfaPt.js";import{P as _}from"./PageHeader-DBfiEiyF.js";import{B as h,T as x,D as u,R as p,C as g,u as j,U as k}from"./UnifiedSettings-T8dbAibN.js";import{h as f}from"./transcriptService-BCIO_PIi.js";import"./SettingsIcon-CGtfF6CW.js";const b=e.memo(({deck:e,onBackClick:s,onSettingsClick:t})=>{if(!e||!e.content||!e.metadata)return null;const d=`${e.content.length} cards${e.metadata.difficulty?` • ${e.metadata.difficulty.replace("_"," ")}`:""}${e.metadata.tags&&e.metadata.tags.length>0?` • ${e.metadata.tags.slice(0,2).join(", ")}`:""}`;return a.jsx(_,{title:e.metadata.deck_name,subtitle:e.metadata.deck_subtitle||e.metadata.description||d,onBackClick:s,backLabel:"Home",onSettingsClick:t,showSettings:!0})});b.displayName="DeckHeader";const v={modesSection:"_modesSection_1s1ky_1",sectionTitle:"_sectionTitle_1s1ky_6",modesGrid:"_modesGrid_1s1ky_14",modeCard:"_modeCard_1s1ky_22",primary:"_primary_1s1ky_46",secondary:"_secondary_1s1ky_55",purple:"_purple_1s1ky_64",orange:"_orange_1s1ky_73",modeIconWrapper:"_modeIconWrapper_1s1ky_82",modeIcon:"_modeIcon_1s1ky_82",modeName:"_modeName_1s1ky_117",modeDescription:"_modeDescription_1s1ky_124",modeAction:"_modeAction_1s1ky_131",startText:"_startText_1s1ky_137"},N=e.memo(({modes:e,onModeClick:t})=>a.jsx("section",{className:v.modesSection,children:a.jsx(s.div,{className:v.modesGrid,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.map(e=>a.jsxs(s.div,{className:`${v.modeCard} ${v[e.color]}`,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>t(e),children:[a.jsx("div",{className:v.modeIconWrapper,children:a.jsx(e.icon,{className:v.modeIcon,size:32})}),a.jsx("h3",{className:v.modeName,children:e.label}),a.jsx("p",{className:v.modeDescription,children:e.description}),a.jsx("div",{className:v.modeAction,children:a.jsx("span",{className:v.startText,children:"Start →"})})]},e.id))})}));N.displayName="ModeSelector";const C="_cardsSection_1fdxt_1",y="_sectionHeader_1fdxt_18",S="_sectionTitle_1fdxt_25",M="_cardActions_1fdxt_32",D="_dragHint_1fdxt_38",T="_cardsManagement_1fdxt_44",$="_cardCategory_1fdxt_61",w="_dragOver_1fdxt_75",A="_learningSection_1fdxt_80",B="_masteredSection_1fdxt_84",I="_categoryTitle_1fdxt_89",z="_categoryIcon_1fdxt_99",L="_cardsList_1fdxt_111",P="_emptyState_1fdxt_125",U="_cardItem_1fdxt_167",H="_masteredCard_1fdxt_185",R="_dragging_1fdxt_189",E="_cardDragHandle_1fdxt_211",F="_cardNumber_1fdxt_229",O="_cardContent_1fdxt_238",G="_cardSide_1fdxt_248",W="_sideLabel_1fdxt_256",q="_sideText_1fdxt_262",J="_masterButton_1fdxt_272",K="_unmasterButton_1fdxt_273",Q=e.memo(({deck:s,learningCards:d,masteredCards:i,onCardClick:r,onToggleMastered:n})=>{const{showNotification:c}=t(),{markCardMastered:l,unmarkCardMastered:o}=m(),[_,j]=e.useState(null),[k,f]=e.useState(null),b=e.useRef(null);if(!s||!s.content||!s.metadata)return null;const v=()=>{j(null),b.current=null,f(null)},N=e=>a=>{a.preventDefault(),f(e)},Q=()=>{f(null)},V=e=>a=>{a.preventDefault();const t=b.current,d=s.metadata.deck_name;if(null===t||!d)return;const r=i.some(e=>e.idx===t);"mastered"!==e||r?"learning"===e&&r&&(o(d,t),c({message:"Card moved back to learning",type:"info",duration:2e3})):(l(d,t,s.content.length),c({message:"Card marked as mastered!",type:"success",duration:2e3})),f(null),v()},X="ontouchstart"in window||navigator.maxTouchPoints>0,Y=s.metadata.side_labels?.side_a||"Side A",Z=s.metadata.side_labels?.side_b||"Side B",ee=(e,s)=>a.jsxs("div",{className:`${U} ${s?H:""} ${_===e.idx?R:""}`,draggable:!X,onDragStart:X?void 0:()=>{return a=e.idx,j(a),void(b.current=a);var a},onDragEnd:X?void 0:v,onClick:()=>r(e),children:[!X&&a.jsx(u,{className:E,size:20}),a.jsx("div",{className:F,children:e.idx+1}),a.jsxs("div",{className:O,children:[a.jsxs("div",{className:G,children:[a.jsxs("span",{className:W,children:[Y,":"]}),a.jsx("span",{className:q,children:e.side_a})]}),a.jsxs("div",{className:G,children:[a.jsxs("span",{className:W,children:[Z,":"]}),a.jsx("span",{className:q,children:e.side_b})]})]}),a.jsx("button",{className:s?K:J,onClick:a=>{a.stopPropagation(),n(e.idx)},title:s?"Move back to learning":"Mark as mastered",children:s?a.jsx(p,{size:16}):a.jsx(g,{size:16})})]},e.idx);return a.jsxs("section",{className:C,children:[a.jsxs("div",{className:y,children:[a.jsxs("h2",{className:S,children:["Cards Management (",s.content.length," total)"]}),a.jsx("div",{className:M,children:"ontouchstart"in window||navigator.maxTouchPoints>0?null:a.jsx("span",{className:D,children:"Drag cards to categorize them"})})]}),a.jsxs("div",{className:T,children:[a.jsxs("div",{className:`${$} ${A} ${"learning"===k?w:""}`,onDragOver:N("learning"),onDrop:V("learning"),onDragLeave:Q,children:[a.jsxs("h3",{className:I,children:[a.jsx(h,{size:20,className:z}),"Learning (",d.length,")"]}),a.jsx("div",{className:L,children:d.length>0?d.map(e=>ee(e,!1)):a.jsxs("div",{className:P,children:[a.jsx("p",{children:"No cards in learning"}),a.jsx("span",{children:"ontouchstart"in window||navigator.maxTouchPoints>0?"Tap cards to categorize them":"Drag cards here to start learning"})]})})]}),a.jsxs("div",{className:`${$} ${B} ${"mastered"===k?w:""}`,onDragOver:N("mastered"),onDrop:V("mastered"),onDragLeave:Q,children:[a.jsxs("h3",{className:I,children:[a.jsx(x,{size:20,className:z}),"Mastered (",i.length,")"]}),a.jsx("div",{className:L,children:i.length>0?i.map(e=>ee(e,!0)):a.jsxs("div",{className:P,children:[a.jsx("p",{children:"No mastered cards"}),a.jsx("span",{children:"ontouchstart"in window||navigator.maxTouchPoints>0?"Cards appear here when marked as mastered":"Cards auto-populate here during learn mode or drag to mark as mastered"})]})})]})]})]})});Q.displayName="CardManagement";const V="_deckPage_vtcob_1",X="_backButton_vtcob_19",Y="_errorContainer_vtcob_96",Z="_modalOverlay_vtcob_322",ee="_modalContent_vtcob_336",ae="_closeButton_vtcob_348",se="_modalTitle_vtcob_371",te="_modalCard_vtcob_378",de="_modalSide_vtcob_384",ie=()=>{const{deckId:_}=d(),h=i(),x=r(e=>e.currentDeck),u=r(e=>e.loadDeck),p=r(e=>e.isLoading),g=r(e=>e.error),v=m(e=>e.mastery[_??""]?.lastUpdated?.getTime()??0),C=m(e=>e.getMasteredCards),y=m(e=>e.resetDeckMastery),{showNotification:S}=t(),{getSettingsForMode:M}=j(),[D,T]=e.useState(null),[$,w]=e.useState(!1),[A,B]=e.useState(!1),[I,z]=e.useState(!1);e.useEffect(()=>{_&&(u(_),f(_).then(z))},[_,u]);const L=e.useMemo(()=>_?C(_):[],[_,C,v]),P=e.useMemo(()=>x?.content?x.content.filter(e=>!L.includes(e.idx)):[],[x,L]),U=e.useMemo(()=>x?.content?x.content.filter(e=>L.includes(e.idx)):[],[x,L]),H=e.useMemo(()=>[{id:"flashcards",label:"Flashcards",icon:n,color:"primary",description:"Classic flip cards for memorization",route:`/flashcards/${_}`},{id:"learn",label:"Learn",icon:c,color:"secondary",description:"Interactive questions with smart scheduling",route:`/learn/${_}`},{id:"match",label:"Match",icon:l,color:"purple",description:"Memory game to match terms and definitions",route:`/match/${_}`},{id:"read",label:"Read",icon:o,color:"orange",description:"Structured reading with line-by-line translation",route:`/read/${_}`}],[_]),R=e.useCallback(e=>{if("read"===e.id){if(!(x?.reading&&Object.keys(x.reading.dialogues).length>0)&&!I)return void S({message:"No reading content available for this deck",type:"info",duration:3e3})}h(e.route)},[h,S,x,I]),E=e.useCallback(e=>{T(e),w(!0)},[]),F=e.useCallback(()=>{w(!1),setTimeout(()=>T(null),300)},[]),O=e.useCallback(e=>{if(!_||!x)return;const{markCardMastered:a,unmarkCardMastered:s}=m.getState(),t=L.includes(e);t?s(_,e):a(_,e,x.content.length),S({message:t?"Card moved back to learning":"Card marked as mastered!",type:t?"info":"success",duration:2e3})},[_,L,x,S]);return p?null:g||!x?a.jsxs("div",{className:Y,children:[a.jsx("h2",{children:"Error Loading Deck"}),a.jsx("p",{children:g||"Deck not found"}),a.jsx("button",{onClick:()=>h("/"),className:X,children:"Back to Home"})]}):a.jsxs("div",{className:V,children:[a.jsx(b,{deck:x,onBackClick:()=>h("/"),onSettingsClick:()=>B(!0)}),a.jsx(N,{modes:H,onModeClick:R}),a.jsx(Q,{deck:x,learningCards:P,masteredCards:U,onCardClick:E,onToggleMastered:O}),$&&D&&a.jsx(s.div,{className:Z,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:F,children:a.jsxs(s.div,{className:ee,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[a.jsx("button",{className:ae,onClick:F,children:"×"}),a.jsx("h3",{className:se,children:"Card Details"}),a.jsxs("div",{className:te,children:[a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_a?x.metadata.side_labels.side_a.charAt(0).toUpperCase()+x.metadata.side_labels.side_a.slice(1):"Side A (Front)"}),a.jsx("p",{children:D.side_a})]}),a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_b?x.metadata.side_labels.side_b.charAt(0).toUpperCase()+x.metadata.side_labels.side_b.slice(1):"Side B (Back)"}),a.jsx("p",{children:D.side_b})]}),D.side_c&&a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_c?x.metadata.side_labels.side_c.charAt(0).toUpperCase()+x.metadata.side_labels.side_c.slice(1):"Side C (Extra)"}),a.jsx("p",{children:D.side_c})]}),D.side_d&&a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_d?x.metadata.side_labels.side_d.charAt(0).toUpperCase()+x.metadata.side_labels.side_d.slice(1):"Side D"}),a.jsx("p",{children:D.side_d})]}),D.side_e&&a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_e?x.metadata.side_labels.side_e.charAt(0).toUpperCase()+x.metadata.side_labels.side_e.slice(1):"Side E"}),a.jsx("p",{children:D.side_e})]}),D.side_f&&a.jsxs("div",{className:de,children:[a.jsx("h4",{children:x?.metadata?.side_labels?.side_f?x.metadata.side_labels.side_f.charAt(0).toUpperCase()+x.metadata.side_labels.side_f.slice(1):"Side F"}),a.jsx("p",{children:D.side_f})]})]})]})}),a.jsx(k,{visible:A,onClose:()=>B(!1),deck:x,mode:"deck",settings:_?M(_,"deck"):{frontSides:[],backSides:[],cardsPerRound:10,enableTimer:!1,enableAudio:!1,randomize:!1,progressionMode:"sequential"},onUpdateSettings:()=>{},onResetMastery:()=>{_&&(y(_),S({message:"Mastered cards reset for this deck.",type:"info",duration:2e3}))}})]})};export{ie as default};
