import{e,p as t,r as s,f as a,j as i,B as n,S as r,m as o,A as d,u as l,a as c,c as u,b as m}from"./index-K5uqA-3n.js";import{u as h}from"./cardMasteryStore-z-5vmz49.js";import{S as _}from"./SharedModeHeader-DRg3hh5Z.js";import{U as p}from"./UnifiedSettings-HzgFl0jR.js";import"./SettingsIcon-BSlFCqwD.js";const g={gridSize:{rows:3,cols:4},matchType:"two_way",cardSides:[{sides:["side_a"],label:"Front",count:6},{sides:["side_b"],label:"Back",count:6}],enableTimer:!0,includeMastered:!1,enableAudio:!1,timerSeconds:0},y=(e,t,s)=>`${e}-${t}-${s}`,x=e=>{const t=[...e];for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}return t},b=e()(t((e,t)=>({session:null,startSession:(t,s=g)=>{const a=Date.now();e({session:{deckId:t,currentRound:1,startTime:a,pausedTime:0,isPaused:!1,grid:[],selectedCards:[],matchedPairs:[],missedCardIndices:[],roundStartTime:a,bestTime:null,settings:s}})},pauseSession:()=>{const{session:s}=t();s&&!s.isPaused&&e({session:{...s,isPaused:!0,pausedTime:Date.now()}})},resumeSession:()=>{const{session:s}=t();if(s&&s.isPaused){const t=Date.now()-s.pausedTime;e({session:{...s,isPaused:!1,pausedTime:0,roundStartTime:s.roundStartTime+t}})}},endSession:()=>{e({session:null})},selectCard:s=>{const{session:a}=t();if(!a||a.isPaused)return;const i=a.grid.find(e=>e.id===s);if(!i||i.isMatched)return;let n,r=[...a.grid];a.selectedCards.includes(s)?(n=a.selectedCards.filter(e=>e!==s),r=r.map(e=>e.id===s?{...e,isSelected:!1}:e)):(n=[...a.selectedCards,s],r=r.map(e=>e.id===s?{...e,isSelected:!0}:e)),e({session:{...a,selectedCards:n,grid:r}})},clearSelection:()=>{const{session:s}=t();if(!s)return;const a=s.grid.map(e=>({...e,isSelected:!1}));e({session:{...s,selectedCards:[],grid:a}})},processMatch:()=>{const{session:s}=t();if(!s||0===s.selectedCards.length)return{isMatch:!1};const a=s.grid.filter(e=>s.selectedCards.includes(e.id)),i=((e,t)=>{if(e.length<2)return{isValid:!1,matchedCards:[],matchType:t};const s=e[0].groupId,a=e.every(e=>e.groupId===s);let i=!1;switch(t){case"two_way":i=2===e.length;break;case"three_way":i=3===e.length;break;case"custom":i=e.length>=2}const n=a&&i,r=n?e.map(e=>e.id):[];return{isValid:n,matchedCards:r,matchType:t}})(a,s.settings.matchType);if(i.isValid){const t=s.grid.map(e=>i.matchedCards.includes(e.id)?{...e,isMatched:!0,isSelected:!1}:{...e,isSelected:!1}),a=[...s.matchedPairs,i.matchedCards];return e({session:{...s,grid:t,selectedCards:[],matchedPairs:a}}),{isMatch:!0,matchedCards:i.matchedCards}}return t().clearSelection(),{isMatch:!1}},startNewRound:s=>{const{session:a}=t();a&&e({session:{...a,currentRound:a.currentRound+1,roundStartTime:Date.now(),grid:[],selectedCards:[],matchedPairs:[],missedCardIndices:s||[]}})},generateGrid:(s,a)=>{const{session:i}=t();if(!i)return[];const n=((e,t,s=!1,a=[])=>{const{gridSize:i,matchType:n}=t,r=i.rows*i.cols;let o=s?e.filter((e,t)=>!a.includes(t)):e,d=2;"three_way"===n&&(d=3);const l=Math.floor(r/d);if(o.length<l){const e=l-o.length,t=x(o).slice(0,e);o=[...o,...t]}const c=x(o).slice(0,l),u=[];c.forEach(e=>{const s=`group-${e.idx}`;"two_way"===n?(u.push({id:y(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:y(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})):"three_way"===n?(u.push({id:y(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:y(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:y(e.idx,"side_c",2),cardIndex:e.idx,displaySides:["side_c"],content:(e.side_c||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})):t.cardSides&&t.cardSides.length>0?t.cardSides.forEach((t,a)=>{const i=t.sides[0],n=e[i]||"";u.push({id:y(e.idx,i,a),cardIndex:e.idx,displaySides:[i],content:n.trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}})}):(u.push({id:y(e.idx,"side_a",0),cardIndex:e.idx,displaySides:["side_a"],content:(e.side_a||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}),u.push({id:y(e.idx,"side_b",1),cardIndex:e.idx,displaySides:["side_b"],content:(e.side_b||"").trim(),groupId:s,isMatched:!1,isSelected:!1,position:{row:0,col:0}}))});const m=x(u);return m.forEach((e,t)=>{const s=Math.floor(t/i.cols),a=t%i.cols;e.position={row:s,col:a}}),m.slice(0,r)})(s,a);return e({session:{...i,grid:n}}),n},saveSession:()=>{},loadSession:s=>{const{session:a}=t();return a&&a.deckId===s?Date.now()-a.startTime>6048e5?(e({session:null}),null):a:null}}),{name:"match-session-store",storage:{getItem:e=>{const t=localStorage.getItem(e);if(!t)return null;try{const{state:e}=JSON.parse(t);return{state:e}}catch(s){return null}},setItem:(e,t)=>{try{const{state:s}=t;localStorage.setItem(e,JSON.stringify({state:s}))}catch(s){}},removeItem:e=>localStorage.removeItem(e)},partialize:e=>({session:e.session})})),v=e=>{const t=Math.floor(e/1e3),s=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},f=e()(t((e,t)=>({bestTimes:{},updateBestTime:(s,a,i,n,r)=>{const o=t().bestTimes[s];return!(o&&!(a<o.bestTimeMs))&&(e(e=>({bestTimes:{...e.bestTimes,[s]:{deckId:s,bestTimeMs:a,achievedAt:new Date,gridSize:{...i},matchType:n,totalMatches:r}}})),!0)},getBestTime:e=>t().bestTimes[e]||null,hasBestTime:e=>e in t().bestTimes,clearBestTime:t=>{e(e=>{const s={...e.bestTimes};return delete s[t],{bestTimes:s}})},clearAllBestTimes:()=>{e({bestTimes:{}})},getAllBestTimes:()=>Object.values(t().bestTimes),getDeckStats:e=>{const s=t().bestTimes[e]||null;return{bestTime:s,formattedTime:s?v(s.bestTimeMs):"--:--",hasRecord:!!s}}}),{name:"match-best-times-store",storage:{getItem:e=>{const t=localStorage.getItem(e);if(!t)return null;const s=JSON.parse(t);return s.state&&s.state.bestTimes&&Object.keys(s.state.bestTimes).forEach(e=>{const t=s.state.bestTimes[e];t.achievedAt&&(t.achievedAt=new Date(t.achievedAt))}),s},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{localStorage.removeItem(e)}}})),C={overlay:"_overlay_hgkvz_1",fadeIn:"_fadeIn_hgkvz_1",modal:"_modal_hgkvz_15",slideUp:"_slideUp_hgkvz_1",small:"_small_hgkvz_32",medium:"_medium_hgkvz_36",large:"_large_hgkvz_40",fullscreen:"_fullscreen_hgkvz_44",header:"_header_hgkvz_52",title:"_title_hgkvz_61",closeButton:"_closeButton_hgkvz_68",content:"_content_hgkvz_74",footer:"_footer_hgkvz_81"},j=s.memo(({isOpen:e,onClose:t,title:r,children:o,size:d="medium",showCloseButton:l=!0,closeOnOverlayClick:c=!0,className:u="",footer:m})=>{const h=s.useRef(null),_=s.useRef(null),p=s.useCallback(e=>{"Escape"===e.key&&t()},[t]),g=s.useCallback(e=>{c&&e.target===e.currentTarget&&t()},[c,t]);if(s.useEffect(()=>{if(e)return _.current=document.activeElement,document.addEventListener("keydown",p),document.body.style.overflow="hidden",h.current&&h.current.focus(),()=>{document.removeEventListener("keydown",p),document.body.style.overflow="",_.current instanceof HTMLElement&&_.current.focus()}},[e,p]),!e)return null;const y=[C.modal,C[d],u].filter(Boolean).join(" "),x=i.jsx("div",{className:C.overlay,onClick:g,"aria-modal":"true",role:"dialog",children:i.jsxs("div",{className:y,ref:h,tabIndex:-1,role:"document","aria-labelledby":r?"modal-title":void 0,children:[(r||l)&&i.jsxs("header",{className:C.header,children:[r&&i.jsx("h2",{id:"modal-title",className:C.title,children:r}),l&&i.jsx(n,{variant:"tertiary",size:"small",onClick:t,className:C.closeButton,"aria-label":"Close modal",children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:i.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),i.jsx("div",{className:C.content,children:o}),m&&i.jsx("footer",{className:C.footer,children:m})]})});return a.createPortal(x,document.body)});j.displayName="Modal";const S={container:"_container_ep13h_1",fullWidth:"_fullWidth_ep13h_10",label:"_label_ep13h_14",inputWrapper:"_inputWrapper_ep13h_21",default:"_default_ep13h_30",filled:"_filled_ep13h_35",outlined:"_outlined_ep13h_40",input:"_input_ep13h_21",withIcon:"_withIcon_ep13h_59",startIcon:"_startIcon_ep13h_65",endIcon:"_endIcon_ep13h_66",error:"_error_ep13h_106",errorText:"_errorText_ep13h_114",helperText:"_helperText_ep13h_122"},k=s.memo(s.forwardRef(({label:e,error:t,helperText:s,variant:a="default",fullWidth:n=!1,startIcon:r,endIcon:o,className:d="",id:l,...c},u)=>{const m=l||`input-${Math.random().toString(36).substr(2,9)}`,h=[S.container,n&&S.fullWidth,d].filter(Boolean).join(" "),_=[S.inputWrapper,S[a],t&&S.error,(r||o)&&S.withIcon].filter(Boolean).join(" ");return i.jsxs("div",{className:h,children:[e&&i.jsx("label",{htmlFor:m,className:S.label,children:e}),i.jsxs("div",{className:_,children:[r&&i.jsx("span",{className:S.startIcon,"aria-hidden":"true",children:r}),i.jsx("input",{ref:u,id:m,className:S.input,"aria-invalid":!!t,"aria-describedby":t?`${m}-error`:s?`${m}-helper`:void 0,...c}),o&&i.jsx("span",{className:S.endIcon,"aria-hidden":"true",children:o})]}),t&&i.jsx("span",{id:`${m}-error`,className:S.errorText,role:"alert",children:t}),s&&!t&&i.jsx("span",{id:`${m}-helper`,className:S.helperText,children:s})]})}));k.displayName="Input";const w={container:"_container_giqme_1",track:"_track_giqme_8",small:"_small_giqme_17",medium:"_medium_giqme_21",large:"_large_giqme_25",bar:"_bar_giqme_30",animated:"_animated_giqme_39","progress-animation":"_progress-animation_giqme_1",default:"_default_giqme_70",success:"_success_giqme_74",warning:"_warning_giqme_78",error:"_error_giqme_82",label:"_label_giqme_87"},T=s.memo(({value:e,max:t=100,variant:s="default",size:a="medium",showLabel:n=!1,animated:r=!0})=>{const o=Math.min(Math.max(e/t*100,0),100),d=[w.container,w[a]].filter(Boolean).join(" "),l=[w.bar,w[s],r&&w.animated].filter(Boolean).join(" ");return i.jsxs("div",{className:d,children:[i.jsx("div",{className:w.track,role:"progressbar","aria-valuenow":e,"aria-valuemin":0,"aria-valuemax":t,children:i.jsx("div",{className:l,style:{width:`${o}%`}})}),n&&i.jsxs("span",{className:w.label,children:[Math.round(o),"%"]})]})});T.displayName="ProgressBar";const N={container:"_container_axvbv_1",fullScreen:"_fullScreen_axvbv_11",content:"_content_axvbv_20",message:"_message_axvbv_29"},I=s.memo(({message:e="Loading...",fullScreen:t=!0})=>{const s=[N.container,t&&N.fullScreen].filter(Boolean).join(" ");return i.jsx("div",{className:s,role:"status","aria-live":"polite",children:i.jsxs("div",{className:N.content,children:[i.jsx(r,{size:"large",variant:"primary"}),i.jsx("p",{className:N.message,children:e})]})})});I.displayName="LoadingScreen";const M={type:"spring",stiffness:300,damping:30,mass:.8},B={unselected:{scale:1,borderColor:"var(--border-color)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",filter:"brightness(1)",y:0,transition:M},selected:{scale:1.02,borderColor:"var(--primary-main)",boxShadow:"0 6px 20px rgba(74, 144, 226, 0.25)",filter:"brightness(1.05)",y:-2,transition:M},hover:{scale:1.01,y:-1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",transition:M}},A={initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{duration:.3,staggerChildren:.05,delayChildren:.1}},exit:{opacity:0,scale:.95,transition:{duration:.2,staggerChildren:.03,staggerDirection:-1}}},$={initial:{opacity:0,backdropFilter:"blur(0px)"},animate:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.2,ease:"easeIn"}}},z=(e,t=!1)=>t?Object.entries(e).reduce((e,[t,s])=>{if("object"==typeof s&&null!==s){const a={...s};if("filter"in a&&delete a.filter,"boxShadow"in a&&Array.isArray(a.boxShadow)&&(a.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"),"scale"in a&&Array.isArray(a.scale)){const e=a.scale;a.scale=[e[0],e[e.length-1]]}e[t]=a}else e[t]=s;return e},{}):e,E=e=>Object.entries(e).reduce((e,[t,s])=>{if("object"==typeof s&&null!==s){const a={...s};"scale"in a&&(a.scale=1),"rotate"in a&&(a.rotate=0),"rotateY"in a&&(a.rotateY=0);const i=["opacity","x","y","backgroundColor","borderColor"];Object.keys(a).forEach(e=>{i.includes(e)||"transition"===e||delete a[e]}),a.transition&&(a.transition={duration:.1}),e[t]=a}else e[t]=s;return e},{}),q={card:"_card_1js0h_2",touchTarget:"_touchTarget_1js0h_29",matched:"_matched_1js0h_37",selected:"_selected_1js0h_60",content:"_content_1js0h_83",selectionIndicator:"_selectionIndicator_1js0h_98",matchIndicator:"_matchIndicator_1js0h_119"},P=s.memo(({card:e,isSelected:t,isMatched:a,isAnimating:n,isCurrentlyAnimating:r=!1,onSelect:d,position:l,isMobile:c=!1,prefersReducedMotion:u=!1})=>{const m=s.useCallback(()=>{a||n||d(e.id)},[e.id,a,n,d]),h=s.useCallback(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),m())},[m]),_=(()=>{let e=B;return u?e=E(e):c&&(e=z(e,!0)),e})(),p=r?a?"removing":"matching":a?"matched":t?"selected":"unselected";return i.jsxs(o.div,{className:`${q.card} ${t?q.selected:""} ${a?q.matched:""} ${r?q.animating:""}`,style:{gridRow:l.row+1,gridColumn:l.col+1},onClick:m,onKeyDown:h,role:"button",tabIndex:a?-1:0,"aria-label":`Match card: ${e.content}`,"aria-pressed":t,"aria-disabled":a,"data-testid":`match-card-${e.id}`,variants:_,initial:"unselected",animate:p,exit:"exit",whileHover:a||u?void 0:"hover",whileTap:a||u?void 0:{scale:.98},layout:!0,layoutId:e.id,children:[i.jsx("div",{className:q.content,children:e.content}),t&&i.jsx(o.div,{className:q.selectionIndicator,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{duration:.2}}),a&&i.jsx(o.div,{className:q.matchIndicator,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.1},children:"✓"}),i.jsx("div",{className:q.touchTarget})]})});P.displayName="MatchCard";const R="_grid_1wrky_2",L=s.memo(({cards:e,onCardSelect:t,selectedCards:s,matchedCards:a,gridSize:n,isAnimating:r,animatingCards:l=[],isMobile:c=!1})=>{const u=new Set(a.flat()),m=window.matchMedia("(prefers-reduced-motion: reduce)").matches;let h=A;return m?h=E(A):c&&(h=z(A,!0)),i.jsx(o.div,{className:R,style:{gridTemplateRows:`repeat(${n.rows}, 1fr)`,gridTemplateColumns:`repeat(${n.cols}, 1fr)`},variants:h,initial:"initial",animate:"animate",exit:"exit",role:"grid","aria-label":"Match game grid","data-testid":"match-grid",children:i.jsx(d,{mode:"popLayout",children:e.map(e=>i.jsx(P,{card:e,isSelected:s.includes(e.id),isMatched:u.has(e.id),isAnimating:r,isCurrentlyAnimating:l.includes(e.id),onSelect:t,position:e.position,isMobile:c,prefersReducedMotion:m},e.id))})})});L.displayName="MatchGrid";const D={sessionComplete:"_sessionComplete_lxnr3_1",container:"_container_lxnr3_13",header:"_header_lxnr3_23",emoji:"_emoji_lxnr3_28",title:"_title_lxnr3_34",excellent:"_excellent_lxnr3_41",great:"_great_lxnr3_45",good:"_good_lxnr3_49",fair:"_fair_lxnr3_53",subtitle:"_subtitle_lxnr3_57",resultsGrid:"_resultsGrid_lxnr3_64",resultCard:"_resultCard_lxnr3_71",resultValue:"_resultValue_lxnr3_86",resultLabel:"_resultLabel_lxnr3_93",achievementSection:"_achievementSection_lxnr3_101",missedSection:"_missedSection_lxnr3_102",achievementItem:"_achievementItem_lxnr3_118",missedItem:"_missedItem_lxnr3_119",achievementIcon:"_achievementIcon_lxnr3_126",missedIcon:"_missedIcon_lxnr3_127",newBest:"_newBest_lxnr3_136",pulse:"_pulse_lxnr3_1",review:"_review_lxnr3_140","gentle-bounce":"_gentle-bounce_lxnr3_1",achievementText:"_achievementText_lxnr3_144",missedText:"_missedText_lxnr3_145",actions:"_actions_lxnr3_151",actionButton:"_actionButton_lxnr3_157",primary:"_primary_lxnr3_173",secondary:"_secondary_lxnr3_183",tertiary:"_tertiary_lxnr3_194",keyHint:"_keyHint_lxnr3_205",motivationalMessage:"_motivationalMessage_lxnr3_224"},O=s.memo(({visible:e,results:t,onContinueWithMissed:a,onStartNewRound:n,onBackToDeck:r})=>{const d=l(),{updateBestTime:c,getBestTime:u}=f(),[m,h]=s.useState(!1),[_,p]=s.useState(null);if(s.useEffect(()=>{if(!t||!e)return;const s=u(t.deckId),a=c(t.deckId,t.totalTime,{rows:3,cols:4},"two_way",t.totalMatches);h(a),p(s?v(s.bestTimeMs):null)},[t,e,c,u]),s.useEffect(()=>{if(!e)return;const s=e=>{const s=e.target;s&&("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable)||("1"===e.key?(e.preventDefault(),t?.missedCardIndices&&t.missedCardIndices.length>0?a():n()):"2"===e.key?(e.preventDefault(),r()):"3"===e.key&&(e.preventDefault(),d("/")))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[e,t,a,n,r,d]),!e||!t)return null;const g=(()=>{const e=t.totalTime/t.totalMatches;return m?{message:"New Best Time!",emoji:"🏆",color:"excellent"}:e<3e3?{message:"Lightning Fast!",emoji:"⚡",color:"excellent"}:e<5e3?{message:"Great Speed!",emoji:"🌟",color:"great"}:e<8e3?{message:"Good Work!",emoji:"👍",color:"good"}:{message:"Complete!",emoji:"🎉",color:"fair"}})(),y=v(t.totalTime),x=t.missedCardIndices&&t.missedCardIndices.length>0;return i.jsx(o.div,{className:D.sessionComplete,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},"data-testid":"match-results",children:i.jsxs("div",{className:D.container,children:[i.jsxs("header",{className:D.header,children:[i.jsx(o.div,{className:D.emoji,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:g.emoji}),i.jsx("h1",{className:`${D.title} ${D[g.color]}`,children:g.message}),i.jsxs("p",{className:D.subtitle,children:["You completed Round ",t.roundNumber," of matching!"]})]}),i.jsxs("div",{className:D.resultsGrid,children:[i.jsxs(o.div,{className:D.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},children:[i.jsx("div",{className:D.resultValue,children:y}),i.jsx("div",{className:D.resultLabel,children:"Time"})]}),i.jsxs(o.div,{className:D.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:[i.jsx("div",{className:D.resultValue,children:t.totalMatches}),i.jsx("div",{className:D.resultLabel,children:"Matches"})]}),i.jsxs(o.div,{className:D.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},children:[i.jsx("div",{className:D.resultValue,children:t.roundNumber}),i.jsx("div",{className:D.resultLabel,children:"Round"})]}),_&&i.jsxs(o.div,{className:D.resultCard,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},children:[i.jsx("div",{className:D.resultValue,children:m?_:v(u(t.deckId)?.bestTimeMs||0)}),i.jsx("div",{className:D.resultLabel,children:m?"Previous Best":"Your Best"})]})]}),m&&_&&i.jsx(o.div,{className:D.achievementSection,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.7},children:i.jsxs("div",{className:D.achievementItem,children:[i.jsx("span",{className:`${D.achievementIcon} ${D.newBest}`,children:"🏆"}),i.jsxs("span",{className:D.achievementText,children:["New personal best! You beat your previous time by"," ",i.jsx("strong",{children:v(u(t.deckId)?.bestTimeMs-t.totalTime)})]})]})}),x&&i.jsx(o.div,{className:D.missedSection,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.8},children:i.jsxs("div",{className:D.missedItem,children:[i.jsx("span",{className:`${D.missedIcon} ${D.review}`,children:"📚"}),i.jsxs("span",{className:D.missedText,children:[i.jsx("strong",{children:t.missedCardIndices.length})," cards need more practice"]})]})}),i.jsxs(o.div,{className:D.actions,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.9},children:[x?i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`${D.actionButton} ${D.primary}`,onClick:a,"data-testid":"practice-missed-button",children:"Practice Missed Cards"}),i.jsx("button",{className:`${D.actionButton} ${D.secondary}`,onClick:n,"data-testid":"new-round-button",children:"New Full Round"})]}):i.jsx("button",{className:`${D.actionButton} ${D.primary}`,onClick:n,"data-testid":"play-again-button",children:"Play Again"}),i.jsx("button",{className:`${D.actionButton} ${D.secondary}`,onClick:r,"data-testid":"back-button",children:"Back to Deck"}),i.jsx("button",{className:`${D.actionButton} ${D.tertiary}`,onClick:()=>d("/"),"data-testid":"home-button",children:"Home"})]}),t.totalTime/t.totalMatches>8e3&&i.jsx(o.p,{className:D.motivationalMessage,initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:"Tip: Try to improve your speed with each round. The more you practice, the faster you'll get!"})]})})});O.displayName="MatchResults";const V={match_success:{frequency:523.25,duration:.3,type:"sine",volume:.6,envelope:{attack:.01,decay:.1,sustain:.3,release:.2}},match_failure:{frequency:146.83,duration:.2,type:"sawtooth",volume:.4,envelope:{attack:.01,decay:.05,sustain:.1,release:.05}},card_select:{frequency:659.25,duration:.1,type:"triangle",volume:.3,envelope:{attack:.01,decay:.02,sustain:.1,release:.05}},card_flip:{frequency:440,duration:.15,type:"square",volume:.25,envelope:{attack:.01,decay:.05,sustain:.05,release:.05}},game_complete:{frequency:783.99,duration:.8,type:"sine",volume:.8,envelope:{attack:.1,decay:.2,sustain:.4,release:.3}},timer_tick:{frequency:1e3,duration:.05,type:"square",volume:.2,envelope:{attack:.001,decay:.01,sustain:.01,release:.02}},button_click:{frequency:400,duration:.1,type:"triangle",volume:.3,envelope:{attack:.01,decay:.02,sustain:.02,release:.05}},notification:{frequency:800,duration:.2,type:"sine",volume:.5,envelope:{attack:.05,decay:.1,sustain:.05,release:.1}}};const G=new class{audioContext=null;audioPool=new Map;settings={enabled:!0,volume:.7,soundEffects:!0,backgroundMusic:!1};constructor(){this.initializeAudioContext()}async initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),"suspended"===this.audioContext.state&&(document.addEventListener("click",this.resumeAudioContext.bind(this),{once:!0}),document.addEventListener("touchstart",this.resumeAudioContext.bind(this),{once:!0}))}catch(e){this.audioContext=null}}async resumeAudioContext(){if(this.audioContext&&"suspended"===this.audioContext.state)try{await this.audioContext.resume()}catch(e){}}updateSettings(e){this.settings={...this.settings,...e}}getSettings(){return{...this.settings}}async playSound(e,t=1){if(this.settings.enabled&&this.settings.soundEffects&&this.audioContext)try{const s=V[e],a=Math.min(1,this.settings.volume*t*s.volume);await this.synthesizeAndPlay(s,a)}catch(s){}}async synthesizeAndPlay(e,t){if(!this.audioContext)return;const{frequency:s=440,duration:a,type:i,envelope:n}=e,r=this.audioContext,o=r.currentTime,d=r.createOscillator(),l=r.createGain();if(d.type=i,d.frequency.setValueAtTime(s,o),n){const{attack:e,decay:s,sustain:i,release:r}=n,d=t*i,c=o+e,u=c+s,m=o+a-r;l.gain.setValueAtTime(0,o),l.gain.linearRampToValueAtTime(t,c),l.gain.linearRampToValueAtTime(d,u),l.gain.setValueAtTime(d,m),l.gain.linearRampToValueAtTime(0,o+a)}else l.gain.setValueAtTime(t,o),l.gain.linearRampToValueAtTime(0,o+a);d.connect(l),l.connect(r.destination),d.start(o),d.stop(o+a),d.addEventListener("ended",()=>{d.disconnect(),l.disconnect()})}async playMatchSuccess(e=1){if(this.settings.enabled&&this.settings.soundEffects)try{const t=[523.25,659.25,783.99],s=[0,.1,.2];for(let a=0;a<t.length;a++)setTimeout(()=>{this.synthesizeAndPlay({frequency:t[a],duration:.4,type:"sine",volume:.6*e,envelope:{attack:.02,decay:.1,sustain:.4,release:.3}},this.settings.volume)},1e3*s[a])}catch(t){}}async playMatchFailure(){if(this.settings.enabled&&this.settings.soundEffects)try{await this.synthesizeAndPlay({frequency:220,duration:.3,type:"sawtooth",volume:.4,envelope:{attack:.01,decay:.1,sustain:.1,release:.2}},this.settings.volume)}catch(e){}}async playGameComplete(){if(this.settings.enabled&&this.settings.soundEffects)try{[{freq:523.25,delay:0},{freq:659.25,delay:.2},{freq:783.99,delay:.4},{freq:1046.5,delay:.6}].forEach(({freq:e,delay:t})=>{setTimeout(()=>{this.synthesizeAndPlay({frequency:e,duration:.5,type:"sine",volume:.8,envelope:{attack:.05,decay:.2,sustain:.5,release:.3}},this.settings.volume)},1e3*t)})}catch(e){}}vibrate(e=50){if("vibrate"in navigator&&this.settings.enabled)try{navigator.vibrate(e)}catch(t){}}async preload(){}cleanup(){this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null),this.audioPool.clear()}},F=(e=50)=>G.vibrate(e);"undefined"!=typeof window&&G.preload();const W="_container_15jb6_2",H="_gameStats_15jb6_12",J="_progressSection_15jb6_22",U="_progressBar_15jb6_29",Y="_progressFill_15jb6_36",K="_statsText_15jb6_43",X="_gameControls_15jb6_79",Q="_clearButton_15jb6_86",Z="_resumeButton_15jb6_87",ee="_gridContainer_15jb6_121",te="_pausedOverlay_15jb6_245",se="_pausedContent_15jb6_255",ae="_selectionFeedback_15jb6_270",ie=s.memo(({deck:e})=>{const t=l(),{getMasteredCards:a}=h(),{updateBestTime:n}=f(),{showNotification:r}=c(),{session:u,startSession:m,pauseSession:y,resumeSession:x,selectCard:v,clearSelection:C,processMatch:j,generateGrid:S,loadSession:k,startNewRound:w}=b(),[T,N]=s.useState(!1),[M,B]=s.useState(!1),[A,z]=s.useState(null),[E,q]=s.useState(!1),[P,R]=s.useState([]),[D,V]=s.useState(!1),[ie,ne]=s.useState(!1),re=u?.settings.enableAudio??!1;s.useEffect(()=>{if(!e||T)return;const t=k(e.id);if(t){const e=t.grid.every(e=>e.isMatched);if(e&&t.grid.length>0){const e=Date.now()-t.roundStartTime,s={deckId:t.deckId,totalTime:e,bestTime:null,isNewBest:!1,totalMatches:t.matchedPairs.length,missedCardIndices:t.missedCardIndices,roundNumber:t.currentRound,startTime:t.roundStartTime,endTime:Date.now()};z(s),B(!0),N(!0)}else N(!0)}else{const t=a(e.id),s={...g,includeMastered:0===t.length};m(e.id,s),setTimeout(()=>{S(e.content,s),N(!0)},100)}},[e,T,k,m,S,a]),s.useEffect(()=>{const e=()=>{const e=window.innerWidth<768||"ontouchstart"in window;ne(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{var e;void 0!==u?.settings.enableAudio&&(e={enabled:u.settings.enableAudio,soundEffects:u.settings.enableAudio},G.updateSettings(e))},[u?.settings.enableAudio]);const oe=s.useCallback(async e=>{if(!u||P.length>0||D)return;re&&(((e,t=1)=>{G.playSound(e,t)})("card_select",.8),F(30)),v(e);const t="three_way"===u.settings.matchType?3:2;u.selectedCards.length+1===t&&setTimeout(async()=>{const e=j();e.isMatch&&e.matchedCards?(re&&(await((e=1)=>G.playMatchSuccess(e))(1.2),F([50,50,50])),r({message:"Match found! 🎉",type:"success",duration:1500}),R(e.matchedCards),setTimeout(()=>{R([]);const t=u.grid.filter(t=>!t.isMatched&&!e.matchedCards?.includes(t.id));0===t.length&&de()},600)):(re&&(await G.playMatchFailure(),F(100)),r({message:"No match! Try again.",type:"error",duration:1500}),setTimeout(()=>{C()},800))},150)},[u,v,j,C,P,D,r]),de=s.useCallback(async()=>{if(!u||D)return;V(!0),re&&(await G.playGameComplete(),F([100,50,100,50,200]));const e=Date.now()-u.roundStartTime,t=Date.now(),s=n(u.deckId,e,u.settings.gridSize,u.settings.matchType,u.matchedPairs.length),a={deckId:u.deckId,totalTime:e,bestTime:null,isNewBest:s,totalMatches:u.matchedPairs.length,missedCardIndices:u.missedCardIndices,roundNumber:u.currentRound,startTime:u.roundStartTime,endTime:t};z(a),V(!1),B(!0)},[u,D,n]),le=s.useCallback(()=>{u?.isPaused?x():y()},[u,y,x]),ce=s.useCallback(()=>{t(`/deck/${e.id}`)},[t,e.id]),ue=s.useCallback(()=>{u&&A&&(B(!1),z(null),w(A.missedCardIndices))},[u,A,w]),me=s.useCallback(()=>{u&&e&&(B(!1),z(null),w(),setTimeout(()=>{S(e.content,u.settings)},100))},[u,e,w,S]),he=s.useCallback(()=>{B(!1),z(null)},[]),_e=s.useCallback(()=>{q(!0)},[]),pe=s.useCallback(()=>{q(!1)},[]),ge=s.useCallback(t=>{const s=t;if(!u)return;const a=u.settings.gridSize.rows!==s.gridSize.rows||u.settings.gridSize.cols!==s.gridSize.cols,i=JSON.stringify(u.settings.cardSides)!==JSON.stringify(s.cardSides);a||i?(u.settings=s,S(e.content,s)):u.settings=s},[u,e,S]),ye=s.useMemo(()=>{if(!u||!u.grid.length)return{totalCards:0,matchedCards:0,progressPercentage:0,selectedCount:u?.selectedCards.length||0};const e=u.grid.length,t=u.grid.filter(e=>e.isMatched).length;return{totalCards:e,matchedCards:t,progressPercentage:t/e*100,selectedCount:u.selectedCards.length}},[u]),xe=s.useMemo(()=>u?u.matchedPairs:[],[u]);return T&&u?i.jsxs("div",{className:W,children:[i.jsx(_,{deckName:e.metadata.deck_name,currentCard:ye.matchedCards,totalCards:ye.totalCards,onBackClick:ce,onSettingsClick:_e,showSettings:!0,subtitle:u.currentRound>1?`Round ${u.currentRound}`:void 0}),i.jsxs("div",{className:H,children:[i.jsxs("div",{className:J,children:[i.jsx("div",{className:U,children:i.jsx(o.div,{className:Y,initial:{width:0},animate:{width:`${ye.progressPercentage}%`},transition:{duration:.3}})}),i.jsx("div",{className:K,children:i.jsxs("span",{children:[ye.matchedCards," / ",ye.totalCards," matched"]})})]}),i.jsx("div",{className:X,children:u.selectedCards.length>0&&i.jsx("button",{className:Q,onClick:C,"aria-label":"Clear selection",children:"Clear Selection"})})]}),i.jsx("main",{className:ee,children:i.jsx(d,{mode:"wait",children:u.isPaused?i.jsx(o.div,{className:te,variants:$,initial:"initial",animate:"animate",exit:"exit",children:i.jsxs("div",{className:se,children:[i.jsx("h2",{children:"Game Paused"}),i.jsx("button",{className:Z,onClick:le,children:"Resume Game"})]})},"paused"):i.jsx(L,{cards:u.grid,onCardSelect:oe,selectedCards:u.selectedCards,matchedCards:xe,gridSize:u.settings.gridSize,isAnimating:P.length>0,animatingCards:P,isMobile:ie},"grid")})}),ye.selectedCount>0&&i.jsxs(o.div,{className:ae,initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},children:[ye.selectedCount," card",ye.selectedCount>1?"s":""," selected"]}),i.jsx(O,{visible:M,results:A,onContinueWithMissed:ue,onStartNewRound:me,onBackToDeck:ce,onClose:he}),i.jsx(p,{visible:E,onClose:pe,deck:e,mode:"match",settings:u?.settings||g,onUpdateSettings:ge})]}):i.jsx(I,{})});ie.displayName="MatchContainer";const ne="_container_1b1xe_2",re="_errorContainer_1b1xe_10",oe="_errorContent_1b1xe_19",de="_errorButton_1b1xe_51",le=()=>{const{deckId:e}=u(),t=l(),{decks:a,activeDeck:n,selectDeck:r,isLoading:o}=m(),{getMasteredCards:d}=h(),[c,_]=s.useState(!1),[p,g]=s.useState(null);s.useEffect(()=>{if(!e)return void g("No deck ID provided");a.find(t=>t.id===e)?(r(e),_(!0),g(null)):o||g("Deck not found")},[e,a,r,o]),s.useEffect(()=>(document.body.classList.add("no-scroll"),()=>{document.body.classList.remove("no-scroll")}),[]);const y=s.useCallback(()=>{t(e?`/deck/${e}`:"/")},[t,e]);if(p)return i.jsx("div",{className:re,children:i.jsxs("div",{className:oe,children:[i.jsx("h1",{children:"Match Mode Error"}),i.jsx("p",{children:p}),i.jsx("button",{onClick:()=>t("/"),className:de,children:"Return to Home"})]})});if(o||!c||!n)return null;if(n.content.length<2)return i.jsx("div",{className:re,children:i.jsxs("div",{className:oe,children:[i.jsx("h1",{children:"Insufficient Cards"}),i.jsxs("p",{children:["This deck needs at least 2 cards to play Match mode. Current deck has ",n.content.length," card",1===n.content.length?"":"s","."]}),i.jsx("button",{onClick:y,className:de,children:"Back to Deck"})]})});const x=d(e),b=n.content.length-x.length;return b<2&&x.length>0?i.jsx("div",{className:re,children:i.jsxs("div",{className:oe,children:[i.jsx("h1",{children:"All Cards Mastered"}),i.jsxs("p",{children:["You've mastered most cards in this deck! Only ",b," unmastered card",1===b?"":"s"," remaining."]}),i.jsx("p",{children:'Enable "Include Mastered Cards" in settings to continue playing.'}),i.jsx("button",{onClick:y,className:de,children:"Back to Deck"})]})}):i.jsx("div",{className:ne,children:i.jsx(ie,{deck:n})})};export{le as default};
